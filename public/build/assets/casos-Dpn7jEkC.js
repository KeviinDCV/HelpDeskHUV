import{R as n,j as e,H as He,L as me,r as x}from"./app-B7siNQR0.js";import{G as Ie,S as Me,c as qe,a as Be}from"./glpi-footer-CHEC6ulq.js";import{F as he,e as Ue,a as Ge,b as B,T as d,d as Ke,c as o}from"./table-Bqn-3apE.js";import{B as i}from"./button-OvnWlFUu.js";import{I as O}from"./input-DxEZeIQA.js";import{e as U,d as G,b as K,D as Q,a as ge,c as pe}from"./dialog-BVp3NUU5.js";import{S as C,a as _,b as D,c as T,d as l}from"./select-f1qugEMT.js";import{X as ue}from"./index-DPNkVjW6.js";import{S as P}from"./square-check-big-BAy_4Afv.js";import{S as Qe}from"./square-pen-Dx_H6SMB.js";import{C as Xe,A as Ye,a as Je}from"./chevron-left-DfKCWTtz.js";import{a as We,C as Ze}from"./chevrons-up-down-D-aJjXzJ.js";import{L as je}from"./loader-circle-AjDdJXrs.js";/* empty css            */import"./file-text-DOneZLY7.js";import"./monitor-BCriiqBo.js";import"./index-BcgG_CCx.js";import"./index-D7EFhc1j.js";import"./index-R1mMT9rT.js";import"./check-CKFTAqpf.js";function Ns({tickets:m,categories:ve,technicians:ye,filters:a,auth:j}){const[f,X]=n.useState(a.search||""),[Ne,F]=n.useState(!1),[E,Y]=n.useState(null),[be,w]=n.useState(!1),[r,fe]=n.useState(null),[S,J]=n.useState(null),[we,W]=n.useState(!1),[Z,Se]=n.useState(!1),[Ce,L]=n.useState(!1),[A,V]=n.useState(null),[z,R]=n.useState(""),[ee,$]=n.useState(""),[H,I]=n.useState(!1),[h,se]=n.useState(a.status||"all"),[g,ae]=n.useState(a.priority||"all"),[p,te]=n.useState(a.category||"all"),[u,re]=n.useState(a.assigned||"all"),[N,le]=n.useState(a.date_from||""),[b,ne]=n.useState(a.date_to||""),M=h&&h!=="all"||g&&g!=="all"||p&&p!=="all"||u&&u!=="all"||N||b||a.filter,ie=()=>{switch(a.filter){case"unassigned":return"Sin asignar";case"my_cases":return"Mis casos";case"my_pending":return"Sin resolver";case"my_resolved":return"Resueltos";default:return null}},_e=()=>{x.get("/soporte/casos",{per_page:a.per_page,sort:a.sort,direction:a.direction},{preserveState:!1})},De=s=>j.user.role==="Administrador"?!0:j.user.role==="Técnico"?s.assigned_user_id===j.user.id||s.requester_user_id===j.user.id:!1,k=()=>j.user.role==="Administrador"||j.user.role==="Técnico",ce=s=>j.user.role==="Administrador"?!0:s.assigned_user_id===j.user.id&&s.status!==5&&s.status!==6,oe=s=>{V(s),R("");const t=new Date,c=t.getFullYear(),$e=String(t.getMonth()+1).padStart(2,"0"),ke=String(t.getDate()).padStart(2,"0"),Oe=String(t.getHours()).padStart(2,"0"),Pe=String(t.getMinutes()).padStart(2,"0"),Ve=`${c}-${$e}-${ke}T${Oe}:${Pe}`;$(Ve),L(!0)},Te=()=>{!A||!z.trim()||(I(!0),x.post(`/dashboard/solve-ticket/${A.id}`,{solution:z.trim(),solve_date:ee||void 0},{preserveScroll:!0,onSuccess:()=>{I(!1),L(!1),V(null),R(""),$("")},onError:()=>{I(!1)}}))},Fe=s=>{Y(s),F(!0)},Ee=()=>{E&&x.delete(`/soporte/casos/${E.id}`,{preserveScroll:!0,onSuccess:()=>{F(!1),Y(null)}})},v=s=>{const t=a.sort===s&&a.direction==="asc"?"desc":"asc",c={per_page:a.per_page,sort:s,direction:t};a.search&&(c.search=a.search),a.status&&(c.status=a.status),a.priority&&(c.priority=a.priority),a.category&&(c.category=a.category),a.assigned&&(c.assigned=a.assigned),a.date_from&&(c.date_from=a.date_from),a.date_to&&(c.date_to=a.date_to),a.filter&&(c.filter=a.filter),x.get("/soporte/casos",c,{preserveState:!1,preserveScroll:!0})},q=s=>{s&&x.visit(s,{preserveScroll:!0})},de=()=>{const s={per_page:a.per_page,sort:a.sort,direction:a.direction,page:1};f&&(s.search=f),h&&h!=="all"&&(s.status=h),g&&g!=="all"&&(s.priority=g),p&&p!=="all"&&(s.category=p),u&&u!=="all"&&(s.assigned=u),N&&(s.date_from=N),b&&(s.date_to=b),x.get("/soporte/casos",s,{preserveState:!1,preserveScroll:!1,replace:!0})},Le=s=>{const t={per_page:s,sort:a.sort,direction:a.direction,page:1};a.search&&(t.search=a.search),a.status&&(t.status=a.status),a.priority&&(t.priority=a.priority),a.category&&(t.category=a.category),a.assigned&&(t.assigned=a.assigned),a.date_from&&(t.date_from=a.date_from),a.date_to&&(t.date_to=a.date_to),a.filter&&(t.filter=a.filter),x.get("/soporte/casos",t,{preserveState:!1,preserveScroll:!0})},Ae=()=>{const s={per_page:a.per_page,sort:a.sort,direction:a.direction,page:1};f&&(s.search=f),h&&h!=="all"&&(s.status=h),g&&g!=="all"&&(s.priority=g),p&&p!=="all"&&(s.category=p),u&&u!=="all"&&(s.assigned=u),N&&(s.date_from=N),b&&(s.date_to=b),console.log("Applying filters:",s),x.get("/soporte/casos",s,{preserveState:!1,preserveScroll:!1,replace:!0})},ze=()=>{se("all"),ae("all"),te("all"),re("all"),le(""),ne(""),X(""),x.get("/soporte/casos",{per_page:a.per_page,sort:a.sort,direction:a.direction,page:1},{preserveState:!1,preserveScroll:!1,replace:!0})},Re=()=>{const s=new URLSearchParams;s.append("sort",a.sort),s.append("direction",a.direction),a.search&&s.append("search",a.search),a.status&&a.status!=="all"&&s.append("status",a.status),a.priority&&a.priority!=="all"&&s.append("priority",a.priority),a.category&&a.category!=="all"&&s.append("category",a.category),a.assigned&&a.assigned!=="all"&&s.append("assigned",a.assigned),a.date_from&&s.append("date_from",a.date_from),a.date_to&&s.append("date_to",a.date_to),a.filter&&s.append("filter",a.filter),window.location.href=`/soporte/casos/export?${s}`},y=s=>a.sort!==s?e.jsx(Ze,{className:"h-3 w-3 ml-1 text-gray-400"}):a.direction==="asc"?e.jsx(Ye,{className:"h-3 w-3 ml-1 text-[#2c4370]"}):e.jsx(Je,{className:"h-3 w-3 ml-1 text-[#2c4370]"}),xe=s=>{switch(s){case 1:return"bg-blue-100 text-blue-800";case 2:return"bg-yellow-100 text-yellow-800";case 3:return"bg-yellow-100 text-yellow-800";case 4:return"bg-orange-100 text-orange-800";case 5:return"bg-green-100 text-green-800";case 6:return"bg-gray-100 text-gray-800";default:return"bg-gray-100 text-gray-800"}};return e.jsxs(e.Fragment,{children:[e.jsx(He,{title:"HelpDesk HUV - Casos"}),e.jsxs("div",{className:"min-h-screen flex flex-col bg-gray-50",children:[e.jsx(Ie,{breadcrumb:e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(me,{href:"/dashboard",className:"text-gray-600 hover:text-[#2c4370] hover:underline",children:"Inicio"}),e.jsx("span",{className:"text-gray-400",children:"/"}),e.jsx(me,{href:"/soporte/casos",className:"text-gray-600 hover:text-[#2c4370] hover:underline",children:"Soporte"}),e.jsx("span",{className:"text-gray-400",children:"/"}),e.jsx("span",{className:"font-medium text-gray-900",children:"Casos"})]})}),e.jsxs("main",{className:"flex-1 px-3 sm:px-6 py-4 sm:py-6",children:[a.filter&&e.jsxs("div",{className:"mb-4 bg-[#2c4370] text-white px-3 sm:px-4 py-2 sm:py-3 flex flex-col sm:flex-row items-start sm:items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm sm:text-base",children:[e.jsx(he,{className:"w-4 h-4 shrink-0"}),e.jsx("span",{className:"font-medium",children:ie()}),e.jsxs("span",{className:"text-white/70",children:["(",m.total,")"]})]}),e.jsxs("button",{onClick:_e,className:"flex items-center gap-1 hover:bg-white/20 px-2 py-1 transition-colors text-sm",children:[e.jsx(ue,{className:"w-4 h-4"}),e.jsx("span",{children:"Quitar"})]})]}),e.jsxs("div",{className:"bg-white shadow border border-gray-200",children:[e.jsx("div",{className:"px-3 sm:px-6 py-3 sm:py-4 border-b",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[e.jsx("h1",{className:"text-lg sm:text-xl font-semibold text-gray-900",children:a.filter?ie():"Casos"}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center gap-2 sm:gap-3",children:[e.jsxs("div",{className:"relative flex-1 sm:flex-initial",children:[e.jsx(O,{type:"text",placeholder:"Buscar...",className:"w-full sm:w-64 pr-10 h-9",value:f,onChange:s=>X(s.target.value),onKeyDown:s=>{s.key==="Enter"&&de()}}),e.jsx(i,{size:"sm",variant:"ghost",className:"absolute right-0 top-0 h-full px-3",onClick:de,children:e.jsx(Me,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(i,{variant:"outline",size:"sm",onClick:()=>Se(!Z),className:`h-9 flex-1 sm:flex-initial ${M?"border-[#2c4370] text-[#2c4370]":""}`,children:[e.jsx(he,{className:"h-4 w-4 sm:mr-1"}),e.jsx("span",{className:"hidden sm:inline",children:"Filtros"}),M&&e.jsx("span",{className:"ml-1 bg-[#2c4370] text-white text-xs w-5 h-5 flex items-center justify-center",children:"!"})]}),e.jsxs(i,{size:"sm",className:"bg-[#2c4370] hover:bg-[#3d5583] text-white h-9 flex-1 sm:flex-initial",onClick:Re,children:[e.jsx("span",{className:"hidden sm:inline",children:"Exportar"}),e.jsx("span",{className:"sm:hidden",children:"Excel"})]})]})]})]})}),Z&&e.jsxs("div",{className:"px-3 sm:px-6 py-3 sm:py-4 bg-gray-50 border-b",children:[e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-6 gap-2 sm:gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600 mb-1 block",children:"Estado"}),e.jsxs(C,{value:h,onValueChange:se,children:[e.jsx(_,{className:"h-8 text-xs",children:e.jsx(D,{placeholder:"Todos"})}),e.jsxs(T,{children:[e.jsx(l,{value:"all",children:"Todos"}),e.jsx(l,{value:"1",children:"Nuevo"}),e.jsx(l,{value:"2",children:"En curso (asignado)"}),e.jsx(l,{value:"3",children:"En curso (planificado)"}),e.jsx(l,{value:"4",children:"En espera"}),e.jsx(l,{value:"5",children:"Resuelto"}),e.jsx(l,{value:"6",children:"Cerrado"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600 mb-1 block",children:"Prioridad"}),e.jsxs(C,{value:g,onValueChange:ae,children:[e.jsx(_,{className:"h-8 text-xs",children:e.jsx(D,{placeholder:"Todas"})}),e.jsxs(T,{children:[e.jsx(l,{value:"all",children:"Todas"}),e.jsx(l,{value:"1",children:"Muy baja"}),e.jsx(l,{value:"2",children:"Baja"}),e.jsx(l,{value:"3",children:"Media"}),e.jsx(l,{value:"4",children:"Alta"}),e.jsx(l,{value:"5",children:"Muy alta"}),e.jsx(l,{value:"6",children:"Urgente"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600 mb-1 block",children:"Asignado a"}),e.jsxs(C,{value:u,onValueChange:re,children:[e.jsx(_,{className:"h-8 text-xs",children:e.jsx(D,{placeholder:"Todos"})}),e.jsxs(T,{children:[e.jsx(l,{value:"all",children:"Todos"}),ye.map(s=>e.jsx(l,{value:s.id.toString(),children:s.fullname},s.id))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600 mb-1 block",children:"Categoría"}),e.jsxs(C,{value:p,onValueChange:te,children:[e.jsx(_,{className:"h-8 text-xs",children:e.jsx(D,{placeholder:"Todas"})}),e.jsxs(T,{children:[e.jsx(l,{value:"all",children:"Todas"}),ve.map(s=>e.jsx(l,{value:s.id.toString(),children:s.completename},s.id))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600 mb-1 block",children:"Desde"}),e.jsx(O,{type:"date",value:N,onChange:s=>le(s.target.value),className:"h-8 text-xs"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600 mb-1 block",children:"Hasta"}),e.jsx(O,{type:"date",value:b,onChange:s=>ne(s.target.value),className:"h-8 text-xs"})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-end gap-2 mt-3",children:[M&&e.jsxs(i,{variant:"ghost",size:"sm",onClick:ze,className:"h-8 text-xs text-gray-600",children:[e.jsx(ue,{className:"h-3 w-3 mr-1"}),"Limpiar"]}),e.jsx(i,{size:"sm",onClick:Ae,className:"bg-[#2c4370] hover:bg-[#3d5583] text-white h-8 text-xs",children:"Aplicar"})]})]}),e.jsxs("div",{className:"px-3 sm:px-6 py-2 sm:py-3 bg-gray-50 border-b flex flex-col sm:flex-row items-start sm:items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[e.jsx("span",{className:"text-xs sm:text-sm text-gray-600",children:"Mostrar"}),e.jsxs(C,{value:a.per_page.toString(),onValueChange:Le,children:[e.jsx(_,{className:"w-16 sm:w-20 h-7 sm:h-8 text-xs sm:text-sm",children:e.jsx(D,{placeholder:"15"})}),e.jsxs(T,{children:[e.jsx(l,{value:"15",children:"15"}),e.jsx(l,{value:"20",children:"20"}),e.jsx(l,{value:"50",children:"50"}),e.jsx(l,{value:"100",children:"100"})]})]}),e.jsx("span",{className:"text-xs sm:text-sm text-gray-600 hidden sm:inline",children:"elementos"})]}),e.jsxs("p",{className:"text-xs sm:text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:m.data.length})," de"," ",e.jsx("span",{className:"font-medium",children:m.total})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Ue,{children:[e.jsx(Ge,{children:e.jsxs(B,{className:"bg-gray-50",children:[e.jsx(d,{className:"font-semibold text-gray-900 text-xs cursor-pointer hover:bg-gray-100 w-16",onClick:()=>v("id"),children:e.jsxs("div",{className:"flex items-center",children:["ID",y("id")]})}),e.jsx(d,{className:"font-semibold text-gray-900 text-xs cursor-pointer hover:bg-gray-100",onClick:()=>v("name"),children:e.jsxs("div",{className:"flex items-center",children:["Título",y("name")]})}),e.jsx(d,{className:"font-semibold text-gray-900 text-xs cursor-pointer hover:bg-gray-100",onClick:()=>v("status"),children:e.jsxs("div",{className:"flex items-center",children:["Estado",y("status")]})}),e.jsx(d,{className:"font-semibold text-gray-900 text-xs cursor-pointer hover:bg-gray-100",onClick:()=>v("priority"),children:e.jsxs("div",{className:"flex items-center",children:["Prioridad",y("priority")]})}),e.jsx(d,{className:"font-semibold text-gray-900 text-xs cursor-pointer hover:bg-gray-100",onClick:()=>v("entity_name"),children:e.jsxs("div",{className:"flex items-center",children:["Entidad",y("entity_name")]})}),e.jsx(d,{className:"font-semibold text-gray-900 text-xs cursor-pointer hover:bg-gray-100",onClick:()=>v("date"),children:e.jsxs("div",{className:"flex items-center",children:["Fecha de apertura",y("date")]})}),e.jsx(d,{className:"font-semibold text-gray-900 text-xs cursor-pointer hover:bg-gray-100",onClick:()=>v("date_mod"),children:e.jsxs("div",{className:"flex items-center",children:["Última actualización",y("date_mod")]})}),e.jsx(d,{className:"font-semibold text-gray-900 text-xs",children:"Solicitante"}),e.jsx(d,{className:"font-semibold text-gray-900 text-xs",children:"Asignado a"}),e.jsx(d,{className:"font-semibold text-gray-900 text-xs",children:"Categoría"}),e.jsx(d,{className:"font-semibold text-gray-900 text-xs",children:"Elemento"}),k()&&e.jsx(d,{className:"font-semibold text-gray-900 text-xs text-center w-24",children:"Acciones"})]})}),e.jsxs(Ke,{children:[m.data.map(s=>e.jsxs(B,{className:"hover:bg-gray-50",children:[e.jsx(o,{className:"text-xs font-medium",children:s.id}),e.jsx(o,{className:"font-medium text-xs",children:e.jsx("button",{onClick:async()=>{if(fe(s),J(null),w(!0),s.status===5||s.status===6){W(!0);try{const t=await fetch(`/dashboard/ticket/${s.id}`);if(t.ok){const c=await t.json();c.solution&&J(c.solution)}}catch(t){console.error("Error fetching solution:",t)}finally{W(!1)}}},className:"text-[#2c4370] hover:underline block truncate max-w-md text-left",title:s.name,children:s.name||"(Sin título)"})}),e.jsx(o,{className:"text-xs",children:e.jsx("span",{className:`px-2 py-1 text-[10px] font-semibold ${xe(s.status)}`,children:s.status_name})}),e.jsx(o,{className:"text-xs",children:s.priority_name}),e.jsx(o,{className:"text-xs",children:s.entity_name||"-"}),e.jsx(o,{className:"text-xs text-gray-600",children:s.date?new Date(s.date).toLocaleDateString("es-CO",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"-"}),e.jsx(o,{className:"text-xs text-gray-600",children:s.date_mod?new Date(s.date_mod).toLocaleDateString("es-CO",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"-"}),e.jsx(o,{className:"text-xs",children:s.requester_name||"-"}),e.jsx(o,{className:"text-xs",children:s.assigned_name||"-"}),e.jsx(o,{className:"text-xs",children:s.category_name||"-"}),e.jsx(o,{className:"text-xs text-gray-600",children:s.item_name||"-"}),k()&&e.jsx(o,{className:"text-xs",children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[ce(s)&&s.status!==5&&s.status!==6&&e.jsx(i,{variant:"ghost",size:"sm",className:"h-7 w-7 p-0 text-green-600 hover:text-green-800 hover:bg-green-50",onClick:()=>oe(s),title:"Resolver",children:e.jsx(P,{className:"h-3.5 w-3.5"})}),e.jsx(i,{variant:"ghost",size:"sm",className:"h-7 w-7 p-0 text-blue-600 hover:text-blue-800 hover:bg-blue-50",onClick:()=>x.visit(`/soporte/casos/${s.id}/editar`),title:"Editar",children:e.jsx(Qe,{className:"h-3.5 w-3.5"})}),De(s)&&e.jsx(i,{variant:"ghost",size:"sm",className:"h-7 w-7 p-0 text-red-600 hover:text-red-800 hover:bg-red-50",onClick:()=>Fe(s),title:"Eliminar",children:e.jsx(qe,{className:"h-3.5 w-3.5"})})]})})]},s.id)),m.data.length===0&&e.jsx(B,{children:e.jsx(o,{colSpan:k()?12:11,className:"text-center py-8 text-gray-500",children:"No se encontraron casos"})})]})]})}),e.jsxs("div",{className:"px-3 sm:px-6 py-3 sm:py-4 border-t flex flex-col sm:flex-row items-center justify-between gap-3",children:[e.jsxs("div",{className:"text-xs sm:text-sm text-gray-600 order-2 sm:order-1",children:["Página ",m.current_page," de ",m.last_page]}),e.jsx("div",{className:"flex items-center gap-1 sm:gap-2 order-1 sm:order-2 flex-wrap justify-center",children:m.links.map((s,t)=>{const c=t===0||t===m.links.length-1||s.active;return t===0?e.jsx(i,{variant:"outline",size:"sm",disabled:!s.url,className:"border-[#2c4370] text-[#2c4370] hover:!bg-[#2c4370] hover:!text-white disabled:opacity-50 h-8 w-8 p-0",onClick:()=>s.url&&q(s.url),children:e.jsx(Xe,{className:"h-4 w-4"})},t):t===m.links.length-1?e.jsx(i,{variant:"outline",size:"sm",disabled:!s.url,className:"border-[#2c4370] text-[#2c4370] hover:!bg-[#2c4370] hover:!text-white disabled:opacity-50 h-8 w-8 p-0",onClick:()=>s.url&&q(s.url),children:e.jsx(We,{className:"h-4 w-4"})},t):e.jsx(i,{variant:s.active?"default":"outline",size:"sm",disabled:!s.url,className:`${c?"":"hidden sm:inline-flex"} h-8 min-w-[32px] px-2 text-xs sm:text-sm ${s.active?"bg-[#2c4370] hover:!bg-[#3d5583] text-white border-[#2c4370]":"border-[#2c4370] text-[#2c4370] hover:!bg-[#2c4370] hover:!text-white"}`,onClick:()=>s.url&&q(s.url),children:e.jsx("span",{dangerouslySetInnerHTML:{__html:s.label}})},t)})})]})]})]}),e.jsx(Be,{})]}),e.jsx(U,{open:Ne,onOpenChange:F,children:e.jsxs(G,{className:"sm:max-w-[425px]",children:[e.jsxs(K,{children:[e.jsx(Q,{children:"Eliminar Caso"}),e.jsxs(ge,{children:["¿Está seguro que desea eliminar el caso ",e.jsxs("strong",{children:["#",E?.id]}),"?",e.jsx("br",{}),e.jsx("span",{className:"text-gray-600",children:E?.name})]})]}),e.jsxs(pe,{className:"gap-2",children:[e.jsx(i,{variant:"outline",onClick:()=>F(!1),children:"Cancelar"}),e.jsx(i,{variant:"destructive",onClick:Ee,className:"bg-red-600 hover:bg-red-700",children:"Eliminar"})]})]})}),e.jsx(U,{open:be,onOpenChange:w,children:e.jsxs(G,{className:"sm:max-w-[600px] max-h-[90vh] overflow-y-auto",children:[e.jsx(K,{children:e.jsxs(Q,{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-[#2c4370]",children:["Caso #",r?.id]}),e.jsx("span",{className:`px-2 py-0.5 text-[10px] font-semibold ${r?xe(r.status):""}`,children:r?.status_name})]})}),r&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{children:e.jsx("h3",{className:"text-sm font-semibold text-gray-900",children:r.name})}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-xs",children:[e.jsxs("div",{className:"bg-gray-50 p-2",children:[e.jsx("span",{className:"text-gray-500 block",children:"Prioridad"}),e.jsx("span",{className:"font-medium",children:r.priority_name})]}),e.jsxs("div",{className:"bg-gray-50 p-2",children:[e.jsx("span",{className:"text-gray-500 block",children:"Entidad"}),e.jsx("span",{className:"font-medium",children:r.entity_name||"-"})]}),e.jsxs("div",{className:"bg-gray-50 p-2",children:[e.jsx("span",{className:"text-gray-500 block",children:"Fecha de Apertura"}),e.jsx("span",{className:"font-medium",children:r.date?new Date(r.date).toLocaleDateString("es-CO",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"-"})]}),e.jsxs("div",{className:"bg-gray-50 p-2",children:[e.jsx("span",{className:"text-gray-500 block",children:"Última Actualización"}),e.jsx("span",{className:"font-medium",children:r.date_mod?new Date(r.date_mod).toLocaleDateString("es-CO",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"-"})]}),e.jsxs("div",{className:"bg-gray-50 p-2",children:[e.jsx("span",{className:"text-gray-500 block",children:"Solicitante"}),e.jsx("span",{className:"font-medium",children:r.requester_name||"-"})]}),e.jsxs("div",{className:"bg-gray-50 p-2",children:[e.jsx("span",{className:"text-gray-500 block",children:"Asignado a"}),e.jsx("span",{className:"font-medium",children:r.assigned_name||"-"})]}),e.jsxs("div",{className:"bg-gray-50 p-2 col-span-2",children:[e.jsx("span",{className:"text-gray-500 block",children:"Categoría"}),e.jsx("span",{className:"font-medium",children:r.category_name||"-"})]})]}),(r.status===5||r.status===6)&&e.jsxs("div",{className:"pt-3 border-t",children:[e.jsx("span",{className:"text-xs font-semibold text-green-700 block mb-2",children:"Solución"}),we?e.jsxs("div",{className:"bg-green-50 p-3 border border-green-200 flex items-center justify-center",children:[e.jsx(je,{className:"h-4 w-4 animate-spin text-green-600"}),e.jsx("span",{className:"ml-2 text-xs text-green-600",children:"Cargando solución..."})]}):S?e.jsxs("div",{className:"bg-green-50 p-3 border border-green-200",children:[e.jsx("div",{className:"text-xs text-gray-700 whitespace-pre-wrap",dangerouslySetInnerHTML:{__html:S.content}}),e.jsxs("div",{className:"mt-2 pt-2 border-t border-green-200 flex items-center justify-between text-[10px] text-green-700",children:[e.jsxs("span",{children:["Resuelto por: ",e.jsx("strong",{children:S.solved_by||"Usuario del sistema"})]}),e.jsx("span",{children:S.date_creation?new Date(S.date_creation).toLocaleString("es-CO"):"-"})]})]}):e.jsx("div",{className:"bg-gray-50 p-3 border border-gray-200 text-xs text-gray-500",children:"No se encontró solución registrada"})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2 border-t",children:[e.jsx(i,{variant:"outline",size:"sm",onClick:()=>w(!1),className:"h-8 text-xs",children:"Cerrar"}),ce(r)&&r.status!==5&&r.status!==6&&e.jsxs(i,{size:"sm",onClick:()=>{w(!1),oe(r)},className:"bg-green-600 hover:bg-green-700 text-white h-8 text-xs",children:[e.jsx(P,{className:"h-3.5 w-3.5 mr-1"}),"Resolver"]}),k()&&e.jsx(i,{size:"sm",onClick:()=>{w(!1),x.visit(`/soporte/casos/${r.id}/editar`)},className:"bg-[#2c4370] hover:bg-[#3d5583] text-white h-8 text-xs",children:"Editar Caso"})]})]})]})}),e.jsx(U,{open:Ce,onOpenChange:L,children:e.jsxs(G,{className:"sm:max-w-[500px]",children:[e.jsxs(K,{children:[e.jsxs(Q,{className:"flex items-center gap-2",children:[e.jsx(P,{className:"h-5 w-5 text-green-600"}),"Resolver Caso"]}),e.jsxs(ge,{children:["Resolver el caso ",e.jsxs("strong",{children:["#",A?.id]}),": ",A?.name]})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Descripción de la solución ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{value:z,onChange:s=>R(s.target.value),placeholder:"Describe cómo se resolvió el problema...",className:"w-full px-3 py-2 border focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500 min-h-[120px] text-sm",autoFocus:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Fecha y hora de solución"}),e.jsx(O,{type:"datetime-local",value:ee,onChange:s=>$(s.target.value),className:"w-full"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Por defecto se usa la fecha y hora actual. Puede modificarla si la solución fue en otro momento."})]})]}),e.jsxs(pe,{className:"gap-2",children:[e.jsx(i,{variant:"outline",onClick:()=>{L(!1),V(null),R(""),$("")},disabled:H,children:"Cancelar"}),e.jsx(i,{onClick:Te,disabled:!z.trim()||H,className:"bg-green-600 hover:bg-green-700 text-white",children:H?e.jsxs(e.Fragment,{children:[e.jsx(je,{className:"h-4 w-4 mr-1 animate-spin"}),"Resolviendo..."]}):e.jsxs(e.Fragment,{children:[e.jsx(P,{className:"h-4 w-4 mr-1"}),"Resolver"]})})]})]})})]})}export{Ns as default};
