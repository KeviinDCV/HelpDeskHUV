import{R as n,j as e,H as He,L as B,r as d}from"./app-B-3mdpCZ.js";import{G as Ie,S as Me,c as qe,a as Be}from"./glpi-footer-CxVLxKMt.js";import{F as he,e as Ue,a as Ge,b as U,T as x,d as Ke,c}from"./table-CRV9mkeu.js";import{B as i}from"./button-C-2xMiZf.js";import{I as O}from"./input-D9kT-WZY.js";import{e as G,d as K,b as Q,D as X,a as ge,c as pe}from"./dialog-BGDwtDUr.js";import{S as D,a as T,b as F,c as E,d as l}from"./select-DU7zVJin.js";import{X as ue}from"./index-DUeTwRCv.js";import{P as Qe}from"./plus-BI_rTfxv.js";import{S as V}from"./square-check-big-DOpEqYTx.js";import{S as Xe}from"./square-pen-BGn6iG77.js";import{C as Ye,A as Je,a as We}from"./chevron-left-CzyIeVZ4.js";import{a as Ze,C as es}from"./chevrons-up-down-CWNeiNth.js";import{L as je}from"./loader-circle-ihKYp1fU.js";/* empty css            */import"./file-text-fR3Txawv.js";import"./monitor-DVaNyOG1.js";import"./index-D8V3gSGy.js";import"./index-d44ZnRfi.js";import"./index-DbFVeY8o.js";import"./check-BnfLItEe.js";function fs({tickets:m,categories:ve,technicians:ye,filters:a,auth:j}){const[f,Y]=n.useState(a.search||""),[Ne,L]=n.useState(!1),[z,J]=n.useState(null),[be,w]=n.useState(!1),[r,fe]=n.useState(null),[S,W]=n.useState(null),[we,Z]=n.useState(!1),[ee,Se]=n.useState(!1),[Ce,A]=n.useState(!1),[C,H]=n.useState(null),[_,P]=n.useState(""),[se,R]=n.useState(""),[I,$]=n.useState(!1),[h,ae]=n.useState(a.status||"all"),[g,te]=n.useState(a.priority||"all"),[p,re]=n.useState(a.category||"all"),[u,le]=n.useState(a.assigned||"all"),[N,ne]=n.useState(a.date_from||""),[b,ie]=n.useState(a.date_to||""),M=h&&h!=="all"||g&&g!=="all"||p&&p!=="all"||u&&u!=="all"||N||b||a.filter,oe=()=>{switch(a.filter){case"unassigned":return"Sin asignar";case"my_cases":return"Mis casos";case"my_pending":return"Sin resolver";case"my_resolved":return"Resueltos";default:return null}},_e=()=>{d.get("/soporte/casos",{per_page:a.per_page,sort:a.sort,direction:a.direction},{preserveState:!1})},De=s=>j.user.role==="Administrador"?!0:j.user.role==="Técnico"?s.assigned_user_id===j.user.id||s.requester_user_id===j.user.id:!1,k=()=>j.user.role==="Administrador"||j.user.role==="Técnico",ce=s=>j.user.role==="Administrador"?!0:s.assigned_user_id===j.user.id&&s.status!==5&&s.status!==6,de=s=>{H(s),P("");const t=new Date,o=t.getFullYear(),Re=String(t.getMonth()+1).padStart(2,"0"),$e=String(t.getDate()).padStart(2,"0"),ke=String(t.getHours()).padStart(2,"0"),Oe=String(t.getMinutes()).padStart(2,"0"),Ve=`${o}-${Re}-${$e}T${ke}:${Oe}`;R(Ve),A(!0)},Te=()=>{if(!C||!_.trim()){console.log("confirmSolve blocked:",{ticketToSolve:C,solution:_.trim()});return}$(!0),d.post(`/dashboard/solve-ticket/${C.id}`,{solution:_.trim(),solve_date:se||void 0},{preserveScroll:!0,onSuccess:()=>{$(!1),A(!1),H(null),P(""),R(""),d.reload()},onError:s=>{$(!1),console.error("Error al resolver:",s)},onFinish:()=>{$(!1)}})},Fe=s=>{J(s),L(!0)},Ee=()=>{z&&d.delete(`/soporte/casos/${z.id}`,{preserveScroll:!0,onSuccess:()=>{L(!1),J(null)}})},v=s=>{const t=a.sort===s&&a.direction==="asc"?"desc":"asc",o={per_page:a.per_page,sort:s,direction:t};a.search&&(o.search=a.search),a.status&&(o.status=a.status),a.priority&&(o.priority=a.priority),a.category&&(o.category=a.category),a.assigned&&(o.assigned=a.assigned),a.date_from&&(o.date_from=a.date_from),a.date_to&&(o.date_to=a.date_to),a.filter&&(o.filter=a.filter),d.get("/soporte/casos",o,{preserveState:!1,preserveScroll:!0})},q=s=>{s&&d.visit(s,{preserveScroll:!0})},xe=()=>{const s={per_page:a.per_page,sort:a.sort,direction:a.direction,page:1};f&&(s.search=f),h&&h!=="all"&&(s.status=h),g&&g!=="all"&&(s.priority=g),p&&p!=="all"&&(s.category=p),u&&u!=="all"&&(s.assigned=u),N&&(s.date_from=N),b&&(s.date_to=b),d.get("/soporte/casos",s,{preserveState:!1,preserveScroll:!1,replace:!0})},Le=s=>{const t={per_page:s,sort:a.sort,direction:a.direction,page:1};a.search&&(t.search=a.search),a.status&&(t.status=a.status),a.priority&&(t.priority=a.priority),a.category&&(t.category=a.category),a.assigned&&(t.assigned=a.assigned),a.date_from&&(t.date_from=a.date_from),a.date_to&&(t.date_to=a.date_to),a.filter&&(t.filter=a.filter),d.get("/soporte/casos",t,{preserveState:!1,preserveScroll:!0})},ze=()=>{const s={per_page:a.per_page,sort:a.sort,direction:a.direction,page:1};f&&(s.search=f),h&&h!=="all"&&(s.status=h),g&&g!=="all"&&(s.priority=g),p&&p!=="all"&&(s.category=p),u&&u!=="all"&&(s.assigned=u),N&&(s.date_from=N),b&&(s.date_to=b),console.log("Applying filters:",s),d.get("/soporte/casos",s,{preserveState:!1,preserveScroll:!1,replace:!0})},Ae=()=>{ae("all"),te("all"),re("all"),le("all"),ne(""),ie(""),Y(""),d.get("/soporte/casos",{per_page:a.per_page,sort:a.sort,direction:a.direction,page:1},{preserveState:!1,preserveScroll:!1,replace:!0})},Pe=()=>{const s=new URLSearchParams;s.append("sort",a.sort),s.append("direction",a.direction),a.search&&s.append("search",a.search),a.status&&a.status!=="all"&&s.append("status",a.status),a.priority&&a.priority!=="all"&&s.append("priority",a.priority),a.category&&a.category!=="all"&&s.append("category",a.category),a.assigned&&a.assigned!=="all"&&s.append("assigned",a.assigned),a.date_from&&s.append("date_from",a.date_from),a.date_to&&s.append("date_to",a.date_to),a.filter&&s.append("filter",a.filter),window.location.href=`/soporte/casos/export?${s}`},y=s=>a.sort!==s?e.jsx(es,{className:"h-3 w-3 ml-1 text-gray-400"}):a.direction==="asc"?e.jsx(Je,{className:"h-3 w-3 ml-1 text-[#2c4370]"}):e.jsx(We,{className:"h-3 w-3 ml-1 text-[#2c4370]"}),me=s=>{switch(s){case 1:return"bg-blue-100 text-blue-800";case 2:return"bg-yellow-100 text-yellow-800";case 3:return"bg-yellow-100 text-yellow-800";case 4:return"bg-orange-100 text-orange-800";case 5:return"bg-green-100 text-green-800";case 6:return"bg-gray-100 text-gray-800";default:return"bg-gray-100 text-gray-800"}};return e.jsxs(e.Fragment,{children:[e.jsx(He,{title:"HelpDesk HUV - Casos"}),e.jsxs("div",{className:"min-h-screen flex flex-col bg-gray-50",children:[e.jsx(Ie,{breadcrumb:e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(B,{href:"/dashboard",className:"text-gray-600 hover:text-[#2c4370] hover:underline",children:"Inicio"}),e.jsx("span",{className:"text-gray-400",children:"/"}),e.jsx(B,{href:"/soporte/casos",className:"text-gray-600 hover:text-[#2c4370] hover:underline",children:"Soporte"}),e.jsx("span",{className:"text-gray-400",children:"/"}),e.jsx("span",{className:"font-medium text-gray-900",children:"Casos"})]})}),e.jsxs("main",{className:"flex-1 px-3 sm:px-6 py-4 sm:py-6",children:[a.filter&&e.jsxs("div",{className:"mb-4 bg-[#2c4370] text-white px-3 sm:px-4 py-2 sm:py-3 flex flex-col sm:flex-row items-start sm:items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm sm:text-base",children:[e.jsx(he,{className:"w-4 h-4 shrink-0"}),e.jsx("span",{className:"font-medium",children:oe()}),e.jsxs("span",{className:"text-white/70",children:["(",m.total,")"]})]}),e.jsxs("button",{onClick:_e,className:"flex items-center gap-1 hover:bg-white/20 px-2 py-1 transition-colors text-sm",children:[e.jsx(ue,{className:"w-4 h-4"}),e.jsx("span",{children:"Quitar"})]})]}),e.jsxs("div",{className:"bg-white shadow border border-gray-200",children:[e.jsx("div",{className:"px-3 sm:px-6 py-3 sm:py-4 border-b",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[e.jsx("h1",{className:"text-lg sm:text-xl font-semibold text-gray-900",children:a.filter?oe():"Casos"}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center gap-2 sm:gap-3",children:[e.jsxs("div",{className:"relative flex-1 sm:flex-initial",children:[e.jsx(O,{type:"text",placeholder:"Buscar...",className:"w-full sm:w-64 pr-10 h-9",value:f,onChange:s=>Y(s.target.value),onKeyDown:s=>{s.key==="Enter"&&xe()}}),e.jsx(i,{size:"sm",variant:"ghost",className:"absolute right-0 top-0 h-full px-3",onClick:xe,children:e.jsx(Me,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(i,{variant:"outline",size:"sm",onClick:()=>Se(!ee),className:`h-9 flex-1 sm:flex-initial ${M?"border-[#2c4370] text-[#2c4370]":""}`,children:[e.jsx(he,{className:"h-4 w-4 sm:mr-1"}),e.jsx("span",{className:"hidden sm:inline",children:"Filtros"}),M&&e.jsx("span",{className:"ml-1 bg-[#2c4370] text-white text-xs w-5 h-5 flex items-center justify-center",children:"!"})]}),e.jsxs(i,{size:"sm",className:"bg-[#2c4370] hover:bg-[#3d5583] text-white h-9 flex-1 sm:flex-initial",onClick:Pe,children:[e.jsx("span",{className:"hidden sm:inline",children:"Exportar"}),e.jsx("span",{className:"sm:hidden",children:"Excel"})]}),e.jsx(B,{href:"/soporte/crear-caso",children:e.jsxs(i,{size:"sm",className:"bg-green-600 hover:bg-green-700 text-white h-9 flex-1 sm:flex-initial",children:[e.jsx(Qe,{className:"h-4 w-4 sm:mr-1"}),e.jsx("span",{className:"hidden sm:inline",children:"Crear Caso"})]})})]})]})]})}),ee&&e.jsxs("div",{className:"px-3 sm:px-6 py-3 sm:py-4 bg-gray-50 border-b",children:[e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-6 gap-2 sm:gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600 mb-1 block",children:"Estado"}),e.jsxs(D,{value:h,onValueChange:ae,children:[e.jsx(T,{className:"h-8 text-xs",children:e.jsx(F,{placeholder:"Todos"})}),e.jsxs(E,{children:[e.jsx(l,{value:"all",children:"Todos"}),e.jsx(l,{value:"1",children:"Nuevo"}),e.jsx(l,{value:"2",children:"En curso (asignado)"}),e.jsx(l,{value:"3",children:"En curso (planificado)"}),e.jsx(l,{value:"4",children:"En espera"}),e.jsx(l,{value:"5",children:"Resuelto"}),e.jsx(l,{value:"6",children:"Cerrado"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600 mb-1 block",children:"Prioridad"}),e.jsxs(D,{value:g,onValueChange:te,children:[e.jsx(T,{className:"h-8 text-xs",children:e.jsx(F,{placeholder:"Todas"})}),e.jsxs(E,{children:[e.jsx(l,{value:"all",children:"Todas"}),e.jsx(l,{value:"1",children:"Muy baja"}),e.jsx(l,{value:"2",children:"Baja"}),e.jsx(l,{value:"3",children:"Media"}),e.jsx(l,{value:"4",children:"Alta"}),e.jsx(l,{value:"5",children:"Muy alta"}),e.jsx(l,{value:"6",children:"Urgente"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600 mb-1 block",children:"Asignado a"}),e.jsxs(D,{value:u,onValueChange:le,children:[e.jsx(T,{className:"h-8 text-xs",children:e.jsx(F,{placeholder:"Todos"})}),e.jsxs(E,{children:[e.jsx(l,{value:"all",children:"Todos"}),ye.map(s=>e.jsx(l,{value:s.id.toString(),children:s.fullname},s.id))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600 mb-1 block",children:"Categoría"}),e.jsxs(D,{value:p,onValueChange:re,children:[e.jsx(T,{className:"h-8 text-xs",children:e.jsx(F,{placeholder:"Todas"})}),e.jsxs(E,{children:[e.jsx(l,{value:"all",children:"Todas"}),ve.map(s=>e.jsx(l,{value:s.id.toString(),children:s.completename},s.id))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600 mb-1 block",children:"Desde"}),e.jsx(O,{type:"date",value:N,onChange:s=>ne(s.target.value),className:"h-8 text-xs"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600 mb-1 block",children:"Hasta"}),e.jsx(O,{type:"date",value:b,onChange:s=>ie(s.target.value),className:"h-8 text-xs"})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-end gap-2 mt-3",children:[M&&e.jsxs(i,{variant:"ghost",size:"sm",onClick:Ae,className:"h-8 text-xs text-gray-600",children:[e.jsx(ue,{className:"h-3 w-3 mr-1"}),"Limpiar"]}),e.jsx(i,{size:"sm",onClick:ze,className:"bg-[#2c4370] hover:bg-[#3d5583] text-white h-8 text-xs",children:"Aplicar"})]})]}),e.jsxs("div",{className:"px-3 sm:px-6 py-2 sm:py-3 bg-gray-50 border-b flex flex-col sm:flex-row items-start sm:items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[e.jsx("span",{className:"text-xs sm:text-sm text-gray-600",children:"Mostrar"}),e.jsxs(D,{value:a.per_page.toString(),onValueChange:Le,children:[e.jsx(T,{className:"w-16 sm:w-20 h-7 sm:h-8 text-xs sm:text-sm",children:e.jsx(F,{placeholder:"15"})}),e.jsxs(E,{children:[e.jsx(l,{value:"15",children:"15"}),e.jsx(l,{value:"20",children:"20"}),e.jsx(l,{value:"50",children:"50"}),e.jsx(l,{value:"100",children:"100"})]})]}),e.jsx("span",{className:"text-xs sm:text-sm text-gray-600 hidden sm:inline",children:"elementos"})]}),e.jsxs("p",{className:"text-xs sm:text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:m.data.length})," de"," ",e.jsx("span",{className:"font-medium",children:m.total})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Ue,{children:[e.jsx(Ge,{children:e.jsxs(U,{className:"bg-gray-50",children:[e.jsx(x,{className:"font-semibold text-gray-900 text-xs cursor-pointer hover:bg-gray-100 w-16",onClick:()=>v("id"),children:e.jsxs("div",{className:"flex items-center",children:["ID",y("id")]})}),e.jsx(x,{className:"font-semibold text-gray-900 text-xs cursor-pointer hover:bg-gray-100",onClick:()=>v("name"),children:e.jsxs("div",{className:"flex items-center",children:["Título",y("name")]})}),e.jsx(x,{className:"font-semibold text-gray-900 text-xs cursor-pointer hover:bg-gray-100",onClick:()=>v("status"),children:e.jsxs("div",{className:"flex items-center",children:["Estado",y("status")]})}),e.jsx(x,{className:"font-semibold text-gray-900 text-xs cursor-pointer hover:bg-gray-100",onClick:()=>v("priority"),children:e.jsxs("div",{className:"flex items-center",children:["Prioridad",y("priority")]})}),e.jsx(x,{className:"font-semibold text-gray-900 text-xs cursor-pointer hover:bg-gray-100",onClick:()=>v("entity_name"),children:e.jsxs("div",{className:"flex items-center",children:["Entidad",y("entity_name")]})}),e.jsx(x,{className:"font-semibold text-gray-900 text-xs cursor-pointer hover:bg-gray-100",onClick:()=>v("date"),children:e.jsxs("div",{className:"flex items-center",children:["Fecha de apertura",y("date")]})}),e.jsx(x,{className:"font-semibold text-gray-900 text-xs cursor-pointer hover:bg-gray-100",onClick:()=>v("date_mod"),children:e.jsxs("div",{className:"flex items-center",children:["Última actualización",y("date_mod")]})}),e.jsx(x,{className:"font-semibold text-gray-900 text-xs",children:"Solicitante"}),e.jsx(x,{className:"font-semibold text-gray-900 text-xs",children:"Asignado a"}),e.jsx(x,{className:"font-semibold text-gray-900 text-xs",children:"Categoría"}),e.jsx(x,{className:"font-semibold text-gray-900 text-xs",children:"Elemento"}),k()&&e.jsx(x,{className:"font-semibold text-gray-900 text-xs text-center w-24",children:"Acciones"})]})}),e.jsxs(Ke,{children:[m.data.map(s=>e.jsxs(U,{className:"hover:bg-gray-50",children:[e.jsx(c,{className:"text-xs font-medium",children:s.id}),e.jsx(c,{className:"font-medium text-xs",children:e.jsx("button",{onClick:async()=>{if(fe(s),W(null),w(!0),s.status===5||s.status===6){Z(!0);try{const t=await fetch(`/dashboard/ticket/${s.id}`);if(t.ok){const o=await t.json();o.solution&&W(o.solution)}}catch(t){console.error("Error fetching solution:",t)}finally{Z(!1)}}},className:"text-[#2c4370] hover:underline block truncate max-w-md text-left",title:s.name,children:s.name||"(Sin título)"})}),e.jsx(c,{className:"text-xs",children:e.jsx("span",{className:`px-2 py-1 text-[10px] font-semibold ${me(s.status)}`,children:s.status_name})}),e.jsx(c,{className:"text-xs",children:s.priority_name}),e.jsx(c,{className:"text-xs",children:s.entity_name||"-"}),e.jsx(c,{className:"text-xs text-gray-600",children:s.date?new Date(s.date).toLocaleDateString("es-CO",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"-"}),e.jsx(c,{className:"text-xs text-gray-600",children:s.date_mod?new Date(s.date_mod).toLocaleDateString("es-CO",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"-"}),e.jsx(c,{className:"text-xs",children:s.requester_name||"-"}),e.jsx(c,{className:"text-xs",children:s.assigned_name||"-"}),e.jsx(c,{className:"text-xs",children:s.category_name||"-"}),e.jsx(c,{className:"text-xs text-gray-600",children:s.item_name||"-"}),k()&&e.jsx(c,{className:"text-xs",children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[ce(s)&&s.status!==5&&s.status!==6&&e.jsx(i,{variant:"ghost",size:"sm",className:"h-7 w-7 p-0 text-green-600 hover:text-green-800 hover:bg-green-50",onClick:()=>de(s),title:"Resolver",children:e.jsx(V,{className:"h-3.5 w-3.5"})}),e.jsx(i,{variant:"ghost",size:"sm",className:"h-7 w-7 p-0 text-blue-600 hover:text-blue-800 hover:bg-blue-50",onClick:()=>d.visit(`/soporte/casos/${s.id}/editar`),title:"Editar",children:e.jsx(Xe,{className:"h-3.5 w-3.5"})}),De(s)&&e.jsx(i,{variant:"ghost",size:"sm",className:"h-7 w-7 p-0 text-red-600 hover:text-red-800 hover:bg-red-50",onClick:()=>Fe(s),title:"Eliminar",children:e.jsx(qe,{className:"h-3.5 w-3.5"})})]})})]},s.id)),m.data.length===0&&e.jsx(U,{children:e.jsx(c,{colSpan:k()?12:11,className:"text-center py-8 text-gray-500",children:"No se encontraron casos"})})]})]})}),e.jsxs("div",{className:"px-3 sm:px-6 py-3 sm:py-4 border-t flex flex-col sm:flex-row items-center justify-between gap-3",children:[e.jsxs("div",{className:"text-xs sm:text-sm text-gray-600 order-2 sm:order-1",children:["Página ",m.current_page," de ",m.last_page]}),e.jsx("div",{className:"flex items-center gap-1 sm:gap-2 order-1 sm:order-2 flex-wrap justify-center",children:m.links.map((s,t)=>{const o=t===0||t===m.links.length-1||s.active;return t===0?e.jsx(i,{variant:"outline",size:"sm",disabled:!s.url,className:"border-[#2c4370] text-[#2c4370] hover:!bg-[#2c4370] hover:!text-white disabled:opacity-50 h-8 w-8 p-0",onClick:()=>s.url&&q(s.url),children:e.jsx(Ye,{className:"h-4 w-4"})},t):t===m.links.length-1?e.jsx(i,{variant:"outline",size:"sm",disabled:!s.url,className:"border-[#2c4370] text-[#2c4370] hover:!bg-[#2c4370] hover:!text-white disabled:opacity-50 h-8 w-8 p-0",onClick:()=>s.url&&q(s.url),children:e.jsx(Ze,{className:"h-4 w-4"})},t):e.jsx(i,{variant:s.active?"default":"outline",size:"sm",disabled:!s.url,className:`${o?"":"hidden sm:inline-flex"} h-8 min-w-[32px] px-2 text-xs sm:text-sm ${s.active?"bg-[#2c4370] hover:!bg-[#3d5583] text-white border-[#2c4370]":"border-[#2c4370] text-[#2c4370] hover:!bg-[#2c4370] hover:!text-white"}`,onClick:()=>s.url&&q(s.url),children:e.jsx("span",{dangerouslySetInnerHTML:{__html:s.label}})},t)})})]})]})]}),e.jsx(Be,{})]}),e.jsx(G,{open:Ne,onOpenChange:L,children:e.jsxs(K,{className:"sm:max-w-[425px]",children:[e.jsxs(Q,{children:[e.jsx(X,{children:"Eliminar Caso"}),e.jsxs(ge,{children:["¿Está seguro que desea eliminar el caso ",e.jsxs("strong",{children:["#",z?.id]}),"?",e.jsx("br",{}),e.jsx("span",{className:"text-gray-600",children:z?.name})]})]}),e.jsxs(pe,{className:"gap-2",children:[e.jsx(i,{variant:"outline",onClick:()=>L(!1),children:"Cancelar"}),e.jsx(i,{variant:"destructive",onClick:Ee,className:"bg-red-600 hover:bg-red-700",children:"Eliminar"})]})]})}),e.jsx(G,{open:be,onOpenChange:w,children:e.jsxs(K,{className:"sm:max-w-[600px] max-h-[90vh] overflow-y-auto",children:[e.jsx(Q,{children:e.jsxs(X,{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-[#2c4370]",children:["Caso #",r?.id]}),e.jsx("span",{className:`px-2 py-0.5 text-[10px] font-semibold ${r?me(r.status):""}`,children:r?.status_name})]})}),r&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{children:e.jsx("h3",{className:"text-sm font-semibold text-gray-900",children:r.name})}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-xs",children:[e.jsxs("div",{className:"bg-gray-50 p-2",children:[e.jsx("span",{className:"text-gray-500 block",children:"Prioridad"}),e.jsx("span",{className:"font-medium",children:r.priority_name})]}),e.jsxs("div",{className:"bg-gray-50 p-2",children:[e.jsx("span",{className:"text-gray-500 block",children:"Entidad"}),e.jsx("span",{className:"font-medium",children:r.entity_name||"-"})]}),e.jsxs("div",{className:"bg-gray-50 p-2",children:[e.jsx("span",{className:"text-gray-500 block",children:"Fecha de Apertura"}),e.jsx("span",{className:"font-medium",children:r.date?new Date(r.date).toLocaleDateString("es-CO",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"-"})]}),e.jsxs("div",{className:"bg-gray-50 p-2",children:[e.jsx("span",{className:"text-gray-500 block",children:"Última Actualización"}),e.jsx("span",{className:"font-medium",children:r.date_mod?new Date(r.date_mod).toLocaleDateString("es-CO",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"-"})]}),e.jsxs("div",{className:"bg-gray-50 p-2",children:[e.jsx("span",{className:"text-gray-500 block",children:"Solicitante"}),e.jsx("span",{className:"font-medium",children:r.requester_name||"-"})]}),e.jsxs("div",{className:"bg-gray-50 p-2",children:[e.jsx("span",{className:"text-gray-500 block",children:"Asignado a"}),e.jsx("span",{className:"font-medium",children:r.assigned_name||"-"})]}),e.jsxs("div",{className:"bg-gray-50 p-2 col-span-2",children:[e.jsx("span",{className:"text-gray-500 block",children:"Categoría"}),e.jsx("span",{className:"font-medium",children:r.category_name||"-"})]})]}),(r.status===5||r.status===6)&&e.jsxs("div",{className:"pt-3 border-t",children:[e.jsx("span",{className:"text-xs font-semibold text-green-700 block mb-2",children:"Solución"}),we?e.jsxs("div",{className:"bg-green-50 p-3 border border-green-200 flex items-center justify-center",children:[e.jsx(je,{className:"h-4 w-4 animate-spin text-green-600"}),e.jsx("span",{className:"ml-2 text-xs text-green-600",children:"Cargando solución..."})]}):S?e.jsxs("div",{className:"bg-green-50 p-3 border border-green-200",children:[e.jsx("div",{className:"text-xs text-gray-700 whitespace-pre-wrap",dangerouslySetInnerHTML:{__html:S.content}}),e.jsxs("div",{className:"mt-2 pt-2 border-t border-green-200 flex items-center justify-between text-[10px] text-green-700",children:[e.jsxs("span",{children:["Resuelto por: ",e.jsx("strong",{children:S.solved_by||"Usuario del sistema"})]}),e.jsx("span",{children:S.date_creation?new Date(S.date_creation).toLocaleString("es-CO"):"-"})]})]}):e.jsx("div",{className:"bg-gray-50 p-3 border border-gray-200 text-xs text-gray-500",children:"No se encontró solución registrada"})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2 border-t",children:[e.jsx(i,{variant:"outline",size:"sm",onClick:()=>w(!1),className:"h-8 text-xs",children:"Cerrar"}),ce(r)&&r.status!==5&&r.status!==6&&e.jsxs(i,{size:"sm",onClick:()=>{w(!1),de(r)},className:"bg-green-600 hover:bg-green-700 text-white h-8 text-xs",children:[e.jsx(V,{className:"h-3.5 w-3.5 mr-1"}),"Resolver"]}),k()&&e.jsx(i,{size:"sm",onClick:()=>{w(!1),d.visit(`/soporte/casos/${r.id}/editar`)},className:"bg-[#2c4370] hover:bg-[#3d5583] text-white h-8 text-xs",children:"Editar Caso"})]})]})]})}),e.jsx(G,{open:Ce,onOpenChange:A,children:e.jsxs(K,{className:"sm:max-w-[500px]",children:[e.jsxs(Q,{children:[e.jsxs(X,{className:"flex items-center gap-2",children:[e.jsx(V,{className:"h-5 w-5 text-green-600"}),"Resolver Caso"]}),e.jsxs(ge,{children:["Resolver el caso ",e.jsxs("strong",{children:["#",C?.id]}),": ",C?.name]})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Descripción de la solución ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{value:_,onChange:s=>P(s.target.value),placeholder:"Describe cómo se resolvió el problema...",className:"w-full px-3 py-2 border focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500 min-h-[120px] text-sm",autoFocus:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Fecha y hora de solución"}),e.jsx(O,{type:"datetime-local",value:se,onChange:s=>R(s.target.value),className:"w-full"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Por defecto se usa la fecha y hora actual. Puede modificarla si la solución fue en otro momento."})]})]}),e.jsxs(pe,{className:"gap-2",children:[e.jsx(i,{variant:"outline",onClick:()=>{A(!1),H(null),P(""),R("")},disabled:I,children:"Cancelar"}),e.jsx(i,{onClick:Te,disabled:!_.trim()||I,className:"bg-green-600 hover:bg-green-700 text-white",children:I?e.jsxs(e.Fragment,{children:[e.jsx(je,{className:"h-4 w-4 mr-1 animate-spin"}),"Resolviendo..."]}):e.jsxs(e.Fragment,{children:[e.jsx(V,{className:"h-4 w-4 mr-1"}),"Resolver"]})})]})]})})]})}export{fs as default};
