import{R as x,f as re,j as e,H as le,L as w,r as H}from"./app-CsF7FWnS.js";import{G as ne,a as ie}from"./glpi-footer-Bpj3MeiI.js";import{B as R}from"./button-DYyq9BIz.js";import{I as N}from"./input-CDvXVIyo.js";import{L as r}from"./label-Dw7o9MkI.js";import{T as oe}from"./textarea-BOQc3NWK.js";import{S as u,a as j,b as g,c as v,d as n}from"./select-DyrttEfh.js";import{S as F,U as de}from"./searchable-select-_HqUPzFi.js";import{X as y}from"./index-CVdlxaP_.js";/* empty css            */import"./dialog-BeGsvBeN.js";import"./file-text-C9YTzrsp.js";import"./monitor-DvEe2zsy.js";import"./index-CgEQomHf.js";import"./loader-circle-DqHmI99-.js";import"./index-BSjaQgjA.js";import"./index-DAVpEz9X.js";import"./check-BrpNMl4Q.js";function De({ticket:o,ticketUsers:_,ticketItems:U,users:f,locations:K,categories:X,itemTypes:A,attachments:J,solution:b,auth:ce}){const Q=_.find(s=>s.type===1)?.users_id,D=_.filter(s=>s.type===3).map(s=>s.users_id),q=_.filter(s=>s.type===2).map(s=>s.users_id),[B,me]=x.useState(J||[]),[S,E]=x.useState([]),[c,M]=x.useState(D),[m,T]=x.useState(q),[h,W]=x.useState(""),[L,V]=x.useState([]),[p,$]=x.useState(U.map(s=>({type:s.itemtype,id:s.items_id,name:s.item_name||`${s.itemtype}: ${s.items_id}`}))),[Y,z]=x.useState(!1),C=s=>s?new Date(s).toISOString().slice(0,16):"",{data:d,setData:i,processing:O,errors:P}=re({name:o.name||"",content:o.content||"",date:C(o.date),time_to_resolve:C(o.time_to_resolve),internal_time_to_resolve:C(o.internal_time_to_resolve),status:o.status?.toString()||"1",priority:o.priority?.toString()||"3",locations_id:o.locations_id?.toString()||"",itilcategories_id:o.itilcategories_id?.toString()||"",requester_id:Q?.toString()||"",observer_ids:D,assigned_ids:q}),Z=s=>{if(s.target.files){const t=Array.from(s.target.files);E(a=>[...a,...t])}},k=s=>{E(t=>t.filter((a,l)=>l!==s))},ee=async s=>{if(W(s),V([]),s){z(!0);try{const a=await(await fetch(`/soporte/items/${s}`,{credentials:"same-origin",headers:{Accept:"application/json"}})).json();V(a)}catch(t){console.error("Error loading items:",t)}finally{z(!1)}}},se=s=>{const t=L.find(l=>l.id===parseInt(s)),a=A.find(l=>l.value===h)?.label||h;t&&!p.some(l=>l.type===h&&l.id===t.id)&&$([...p,{type:h,id:t.id,name:`${a}: ${t.name}`}])},te=(s,t)=>{$(p.filter(a=>!(a.type===s&&a.id===t)))},ae=s=>{s.preventDefault();const t={...d,requester_id:d.requester_id||null,observer_ids:c.length>0?c:[],assigned_ids:m.length>0?m:[],items:p.map(a=>({type:a.type,id:a.id})),attachments:S,_method:"PUT"};H.post(`/soporte/casos/${o.id}`,t,{forceFormData:!0,onSuccess:()=>{}})},G=s=>{if(s===0)return"0 Bytes";const t=1024,a=["Bytes","KB","MB","GB"],l=Math.floor(Math.log(s)/Math.log(t));return Math.round(s/Math.pow(t,l)*100)/100+" "+a[l]};return e.jsxs(e.Fragment,{children:[e.jsx(le,{title:`Editar Caso #${o.id} - HelpDesk HUV`}),e.jsxs("div",{className:"min-h-screen flex flex-col bg-gray-50",children:[e.jsx(ne,{breadcrumb:e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(w,{href:"/dashboard",className:"text-gray-600 hover:text-[#2c4370] hover:underline",children:"Inicio"}),e.jsx("span",{className:"text-gray-400",children:"/"}),e.jsx(w,{href:"/soporte/casos",className:"text-gray-600 hover:text-[#2c4370] hover:underline",children:"Soporte"}),e.jsx("span",{className:"text-gray-400",children:"/"}),e.jsx(w,{href:"/soporte/casos",className:"text-gray-600 hover:text-[#2c4370] hover:underline",children:"Casos"}),e.jsx("span",{className:"text-gray-400",children:"/"}),e.jsxs("span",{className:"font-medium text-gray-900",children:["Editar #",o.id]})]})}),e.jsx("main",{className:"flex-1 px-6 py-6",children:e.jsx("div",{className:"max-w-5xl mx-auto",children:e.jsxs("div",{className:"bg-white rounded-lg shadow",children:[e.jsxs("div",{className:"px-6 py-4 border-b",children:[e.jsxs("h1",{className:"text-xl font-semibold text-gray-900",children:["Editar Caso #",o.id]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Modifique los datos del caso"})]}),e.jsxs("form",{onSubmit:ae,className:"p-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"md:col-span-4",children:[e.jsx(r,{htmlFor:"name",className:"text-xs",children:"Título *"}),e.jsx(N,{id:"name",name:"name",autoComplete:"off",value:d.name,onChange:s=>i("name",s.target.value),placeholder:"Título del caso",required:!0,className:"mt-1 h-8 text-sm"}),P.name&&e.jsx("p",{className:"text-red-600 text-xs mt-0.5",children:P.name})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"date",className:"text-xs",children:"Fecha Apertura *"}),e.jsx(N,{id:"date",name:"date",autoComplete:"off",type:"datetime-local",value:d.date,onChange:s=>i("date",s.target.value),required:!0,className:"mt-1 h-8 text-xs"})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"status",className:"text-xs",children:"Estado *"}),e.jsxs(u,{value:d.status,onValueChange:s=>i("status",s),name:"status",children:[e.jsx(j,{id:"status",className:"mt-1 h-8 text-xs",children:e.jsx(g,{})}),e.jsxs(v,{children:[e.jsx(n,{value:"1",children:"Nuevo"}),e.jsx(n,{value:"2",children:"En curso (asignado)"}),e.jsx(n,{value:"3",children:"En curso (planificado)"}),e.jsx(n,{value:"4",children:"En espera"}),e.jsx(n,{value:"5",children:"Resuelto"}),e.jsx(n,{value:"6",children:"Cerrado"})]})]})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"priority",className:"text-xs",children:"Prioridad *"}),e.jsxs(u,{value:d.priority,onValueChange:s=>i("priority",s),name:"priority",children:[e.jsx(j,{id:"priority",className:"mt-1 h-8 text-xs",children:e.jsx(g,{})}),e.jsxs(v,{children:[e.jsx(n,{value:"1",children:"Muy baja"}),e.jsx(n,{value:"2",children:"Baja"}),e.jsx(n,{value:"3",children:"Media"}),e.jsx(n,{value:"4",children:"Alta"}),e.jsx(n,{value:"5",children:"Muy alta"}),e.jsx(n,{value:"6",children:"Urgente"})]})]})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"locations_id",className:"text-xs",children:"Localización"}),e.jsx(F,{options:K.map(s=>({value:s.id.toString(),label:s.short_name||s.completename})),value:d.locations_id,onValueChange:s=>i("locations_id",s),placeholder:"Seleccione...",searchPlaceholder:"Buscar ubicación...",className:"mt-1"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(r,{htmlFor:"itilcategories_id",className:"text-xs",children:"Categoría *"}),e.jsx(F,{options:X.map(s=>({value:s.id.toString(),label:s.completename})),value:d.itilcategories_id,onValueChange:s=>i("itilcategories_id",s),placeholder:"Seleccione categoría...",searchPlaceholder:"Buscar categoría...",className:"mt-1"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(r,{htmlFor:"requester_id",className:"text-xs",children:"Solicitante"}),e.jsxs(u,{value:d.requester_id,onValueChange:s=>i("requester_id",s),name:"requester_id",children:[e.jsx(j,{id:"requester_id",className:"mt-1 h-8 text-xs",children:e.jsx(g,{placeholder:"Buscar solicitante..."})}),e.jsx(v,{children:f.map(s=>e.jsx(n,{value:s.id.toString(),children:s.name},s.id))})]})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"observer",className:"text-xs",children:"Observador"}),e.jsxs(u,{onValueChange:s=>{const t=parseInt(s);c.includes(t)||(M([...c,t]),i("observer_ids",[...c,t]))},name:"observer",children:[e.jsx(j,{id:"observer",className:"mt-1 h-8 text-xs",children:e.jsx(g,{placeholder:"Agregar..."})}),e.jsx(v,{children:f.filter(s=>!c.includes(s.id)).map(s=>e.jsx(n,{value:s.id.toString(),children:s.name},s.id))})]}),c.length>0&&e.jsx("div",{className:"mt-1 flex flex-wrap gap-1",children:c.map(s=>{const t=f.find(a=>a.id===s);return t?e.jsxs("span",{className:"inline-flex items-center gap-1 px-1.5 py-0.5 bg-blue-50 text-blue-700 text-[10px] rounded border border-blue-100",children:[t.name,e.jsx("button",{type:"button",onClick:a=>{a.preventDefault();const l=c.filter(I=>I!==s);M(l),i("observer_ids",l)},className:"hover:text-blue-900",children:e.jsx(y,{className:"h-2.5 w-2.5"})})]},s):null})})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"assigned",className:"text-xs",children:"Asignado a *"}),e.jsxs(u,{onValueChange:s=>{const t=parseInt(s);m.includes(t)||(T([...m,t]),i("assigned_ids",[...m,t]))},name:"assigned",children:[e.jsx(j,{id:"assigned",className:"mt-1 h-8 text-xs",children:e.jsx(g,{placeholder:"Asignar..."})}),e.jsx(v,{children:f.filter(s=>!m.includes(s.id)).map(s=>e.jsx(n,{value:s.id.toString(),children:s.name},s.id))})]}),m.length>0&&e.jsx("div",{className:"mt-1 flex flex-wrap gap-1",children:m.map(s=>{const t=f.find(a=>a.id===s);return t?e.jsxs("span",{className:"inline-flex items-center gap-1 px-1.5 py-0.5 bg-green-50 text-green-700 text-[10px] rounded border border-green-100",children:[t.name,e.jsx("button",{type:"button",onClick:a=>{a.preventDefault();const l=m.filter(I=>I!==s);T(l),i("assigned_ids",l)},className:"hover:text-green-900",children:e.jsx(y,{className:"h-2.5 w-2.5"})})]},s):null})})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(r,{htmlFor:"item_type",className:"text-xs",children:"Elementos Asociados"}),e.jsxs(u,{value:h,onValueChange:ee,name:"item_type",children:[e.jsx(j,{id:"item_type",className:"mt-1 h-8 text-xs",children:e.jsx(g,{placeholder:"Tipo de elemento..."})}),e.jsx(v,{children:A.map(s=>e.jsx(n,{value:s.value,children:s.label},s.value))})]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(r,{htmlFor:"item_id",className:"text-xs text-gray-500",children:"Seleccionar elemento"}),e.jsx(F,{options:L.map(s=>({value:s.id.toString(),label:s.name})),onValueChange:se,placeholder:"Buscar elemento...",searchPlaceholder:"Escriba para buscar...",disabled:!h,loading:Y,className:"mt-1"})]}),p.length>0&&e.jsx("div",{className:"md:col-span-4 flex flex-wrap gap-1",children:p.map((s,t)=>e.jsxs("span",{className:"inline-flex items-center gap-1 px-1.5 py-0.5 bg-purple-50 text-purple-700 text-[10px] rounded border border-purple-100",children:[s.name,e.jsx("button",{type:"button",onClick:a=>{a.preventDefault(),te(s.type,s.id)},className:"hover:text-purple-900",children:e.jsx(y,{className:"h-2.5 w-2.5"})})]},`${s.type}-${s.id}-${t}`))}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(r,{htmlFor:"time_to_resolve",className:"text-xs text-gray-500",children:"Tiempo Solución (Opcional)"}),e.jsx(N,{id:"time_to_resolve",name:"time_to_resolve",autoComplete:"off",type:"datetime-local",value:d.time_to_resolve,onChange:s=>i("time_to_resolve",s.target.value),className:"mt-1 h-8 text-xs"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(r,{htmlFor:"internal_time_to_resolve",className:"text-xs text-gray-500",children:"Tiempo Interno (Opcional)"}),e.jsx(N,{id:"internal_time_to_resolve",name:"internal_time_to_resolve",autoComplete:"off",type:"datetime-local",value:d.internal_time_to_resolve,onChange:s=>i("internal_time_to_resolve",s.target.value),className:"mt-1 h-8 text-xs"})]}),b&&e.jsxs("div",{className:"md:col-span-4",children:[e.jsx(r,{className:"text-xs flex items-center gap-1 text-green-700",children:"Solución del Caso"}),e.jsxs("div",{className:"mt-1 p-3 bg-green-50 rounded border border-green-200",children:[e.jsx("div",{className:"text-sm whitespace-pre-wrap text-gray-700",dangerouslySetInnerHTML:{__html:b.content}}),e.jsxs("div",{className:"mt-2 pt-2 border-t border-green-200 flex items-center justify-between text-xs text-green-700",children:[e.jsxs("span",{children:["Resuelto por: ",e.jsx("strong",{children:b.solved_by||"Usuario del sistema"})]}),e.jsx("span",{children:b.date_creation?new Date(b.date_creation).toLocaleDateString("es-CO",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}):"-"})]})]})]}),e.jsxs("div",{className:"md:col-span-3",children:[e.jsx(r,{htmlFor:"content",className:"text-xs",children:"Descripción *"}),e.jsx(oe,{id:"content",name:"content",autoComplete:"off",value:d.content,onChange:s=>i("content",s.target.value),placeholder:"Detalle el caso...",required:!0,rows:4,className:"mt-1 text-sm resize-none"})]}),e.jsxs("div",{className:"md:col-span-1 flex flex-col",children:[e.jsx(r,{className:"text-xs mb-1",children:"Adjuntos"}),e.jsxs("div",{className:"flex-1 border-2 border-dashed border-gray-200 rounded-lg flex flex-col items-center justify-center p-2 hover:border-gray-400 transition-colors bg-gray-50/50",children:[e.jsx(de,{className:"h-6 w-6 text-gray-400 mb-1"}),e.jsxs("label",{htmlFor:"file-upload",className:"cursor-pointer text-center",children:[e.jsx("span",{className:"text-xs font-medium text-[#2c4370] hover:underline block",children:"Subir archivos"}),e.jsx("span",{className:"text-[10px] text-gray-400 block leading-tight",children:"Máx 100MB"}),e.jsx("input",{id:"file-upload",type:"file",multiple:!0,onChange:Z,className:"sr-only"})]})]})]}),B.length>0&&e.jsxs("div",{className:"md:col-span-4",children:[e.jsx(r,{className:"text-xs mb-1 block",children:"Archivos existentes"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:B.map((s,t)=>e.jsx("a",{href:s.url,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 bg-blue-50 px-2 py-1 rounded border border-blue-200 hover:bg-blue-100 transition-colors",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[10px] font-medium text-blue-700 truncate max-w-[150px]",children:s.name}),e.jsx("span",{className:"text-[9px] text-blue-500",children:G(s.size)})]})},t))})]}),S.length>0&&e.jsxs("div",{className:"md:col-span-4",children:[e.jsx(r,{className:"text-xs mb-1 block",children:"Archivos nuevos"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:S.map((s,t)=>e.jsxs("div",{className:"flex items-center gap-2 bg-gray-100 px-2 py-1 rounded border border-gray-200",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[10px] font-medium text-gray-700 truncate max-w-[150px]",children:s.name}),e.jsx("span",{className:"text-[9px] text-gray-500",children:G(s.size)})]}),e.jsx("button",{type:"button",onClick:()=>k(t),className:"text-gray-400 hover:text-red-600",children:e.jsx(y,{className:"h-3 w-3"})})]},t))})]})]}),e.jsxs("div",{className:"mt-4 flex items-center justify-end gap-2 pt-2 border-t",children:[e.jsx(R,{type:"button",variant:"ghost",size:"sm",onClick:()=>H.visit("/soporte/casos"),className:"h-8 text-xs",children:"Cancelar"}),e.jsx(R,{type:"submit",disabled:O,size:"sm",className:"bg-[#2c4370] hover:bg-[#3d5583] text-white h-8 text-xs px-6",children:O?"Guardando...":"Guardar Cambios"})]})]})]})})}),e.jsx(ie,{})]})]})}export{De as default};
