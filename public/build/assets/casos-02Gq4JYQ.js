import{R as i,j as e,H as Be,L as K,r as x}from"./app-UQ1QY_D_.js";import{G as Ue,S as Ge,c as Ke,a as Qe}from"./glpi-footer-DKoEu3Bi.js";import{F as je,e as Xe,a as Ye,b as Q,T as d,d as Je,c as o}from"./table-BqKWTfs4.js";import{B as c}from"./button-CIkAoHeE.js";import{I as H}from"./input-B-oNOrXs.js";import{e as X,d as Y,b as J,D as W,a as ve,c as ye}from"./dialog-ZNJ7wiLB.js";import{S as E,a as k,b as L,c as O,d as l}from"./select-73k2kEr2.js";import{X as be}from"./x-BSGLFk_J.js";import{P as We}from"./plus-CimQ8SU5.js";import{S as I}from"./square-check-big-DAbl7j9f.js";import{S as Ze}from"./square-pen-YUMQxDyo.js";import{C as es,A as ss,a as as}from"./chevron-left-CfONwkMq.js";import{a as ts,C as rs}from"./chevrons-up-down-CziUZWu7.js";import{L as Ne}from"./loader-circle-Cj7Q8pT0.js";/* empty css            */import"./index-BU6TyM6S.js";import"./index-zAl5CuM7.js";import"./index-B-wMIL5j.js";import"./file-text-DLEHSKEM.js";import"./monitor-D0CNp6wM.js";import"./index-BIrONb-Z.js";import"./check-BaV38CgM.js";import"./sun-DybtkZ-g.js";function Ts({tickets:m,categories:fe,technicians:we,filters:a,auth:j}){const[C,Z]=i.useState(a.search||""),[Se,z]=i.useState(!1),[A,ee]=i.useState(null),[Ce,_]=i.useState(!1),[r,_e]=i.useState(null),[D,se]=i.useState(null),[De,ae]=i.useState(!1),[te,Te]=i.useState(!1),[Fe,P]=i.useState(!1),[v,q]=i.useState(null),[N,R]=i.useState(""),[f,$]=i.useState(""),[B,M]=i.useState(!1),[re,T]=i.useState(null),[h,le]=i.useState(a.status||"all"),[g,ne]=i.useState(a.priority||"all"),[p,ie]=i.useState(a.category||"all"),[u,ce]=i.useState(a.assigned||"all"),[w,oe]=i.useState(a.date_from||""),[S,de]=i.useState(a.date_to||""),[F,xe]=i.useState(a.exclude_maintenance==="1"),U=h&&h!=="all"||g&&g!=="all"||p&&p!=="all"||u&&u!=="all"||w||S||a.filter||F,me=()=>{switch(a.filter){case"unassigned":return"Sin asignar";case"my_cases":return"Mis casos";case"my_pending":return"Sin resolver";case"my_resolved":return"Resueltos";default:return null}},Ee=()=>{const s={per_page:a.per_page,sort:a.sort,direction:a.direction};F&&(s.exclude_maintenance="1"),x.get("/soporte/casos",s,{preserveState:!1})},ke=s=>j.user.role==="Administrador"?!0:j.user.role==="Técnico"?s.assigned_user_id===j.user.id||s.requester_user_id===j.user.id:!1,V=()=>j.user.role==="Administrador"||j.user.role==="Técnico",he=s=>j.user.role==="Administrador"?!0:s.assigned_user_id===j.user.id&&s.status!==5&&s.status!==6,ge=s=>{q(s),R(""),T(null);const t=new Date,n=t.getFullYear(),Me=String(t.getMonth()+1).padStart(2,"0"),Ve=String(t.getDate()).padStart(2,"0"),He=String(t.getHours()).padStart(2,"0"),Ie=String(t.getMinutes()).padStart(2,"0"),qe=`${n}-${Me}-${Ve}T${He}:${Ie}`;$(qe),P(!0)},Le=()=>{if(console.log("confirmSolve called",{ticketToSolve:v,solution:N,solveDate:f}),!v||!N.trim()){alert("Debe ingresar una solución");return}if(f&&v.date){const t=new Date(f),n=new Date(v.date);if(t<n){T("La fecha de solución no puede ser anterior a la fecha de creación del caso.");return}}M(!0),T(null);const s=f?f.replace("T"," ")+":00":null;console.log("Sending POST to:",`/dashboard/solve-ticket/${v.id}`,{solution:N.trim(),solve_date:s}),x.post(`/dashboard/solve-ticket/${v.id}`,{solution:N.trim(),solve_date:s},{preserveState:!0,onSuccess:t=>{if(console.log("onSuccess called",t.props?.flash),M(!1),t.props?.flash?.error){T(t.props.flash.error);return}P(!1),q(null),R(""),$("")},onError:t=>{console.log("onError called",t),M(!1);const n=typeof t=="object"?Object.values(t).join(", "):"Error al resolver";T(n)},onFinish:()=>{console.log("onFinish called"),M(!1)}})},Oe=s=>{ee(s),z(!0)},ze=()=>{A&&x.delete(`/soporte/casos/${A.id}`,{preserveScroll:!0,onSuccess:()=>{z(!1),ee(null)}})},y=s=>{const t=a.sort===s&&a.direction==="asc"?"desc":"asc",n={per_page:a.per_page,sort:s,direction:t};a.search&&(n.search=a.search),a.status&&(n.status=a.status),a.priority&&(n.priority=a.priority),a.category&&(n.category=a.category),a.assigned&&(n.assigned=a.assigned),a.date_from&&(n.date_from=a.date_from),a.date_to&&(n.date_to=a.date_to),a.filter&&(n.filter=a.filter),a.exclude_maintenance==="1"&&(n.exclude_maintenance="1"),x.get("/soporte/casos",n,{preserveState:!1,preserveScroll:!0})},G=s=>{s&&x.visit(s,{preserveScroll:!0})},pe=()=>{const s={per_page:a.per_page,sort:a.sort,direction:a.direction,page:1};C&&(s.search=C),h&&h!=="all"&&(s.status=h),g&&g!=="all"&&(s.priority=g),p&&p!=="all"&&(s.category=p),u&&u!=="all"&&(s.assigned=u),w&&(s.date_from=w),S&&(s.date_to=S),F&&(s.exclude_maintenance="1"),x.get("/soporte/casos",s,{preserveState:!1,preserveScroll:!1,replace:!0})},Ae=s=>{const t={per_page:s,sort:a.sort,direction:a.direction,page:1};a.search&&(t.search=a.search),a.status&&(t.status=a.status),a.priority&&(t.priority=a.priority),a.category&&(t.category=a.category),a.assigned&&(t.assigned=a.assigned),a.date_from&&(t.date_from=a.date_from),a.date_to&&(t.date_to=a.date_to),a.filter&&(t.filter=a.filter),a.exclude_maintenance==="1"&&(t.exclude_maintenance="1"),x.get("/soporte/casos",t,{preserveState:!1,preserveScroll:!0})},Pe=()=>{const s={per_page:a.per_page,sort:a.sort,direction:a.direction,page:1};C&&(s.search=C),h&&h!=="all"&&(s.status=h),g&&g!=="all"&&(s.priority=g),p&&p!=="all"&&(s.category=p),u&&u!=="all"&&(s.assigned=u),w&&(s.date_from=w),S&&(s.date_to=S),F&&(s.exclude_maintenance="1"),console.log("Applying filters:",s),x.get("/soporte/casos",s,{preserveState:!1,preserveScroll:!1,replace:!0})},Re=()=>{le("all"),ne("all"),ie("all"),ce("all"),oe(""),de(""),Z(""),xe(!1),x.get("/soporte/casos",{per_page:a.per_page,sort:a.sort,direction:a.direction,page:1},{preserveState:!1,preserveScroll:!1,replace:!0})},$e=()=>{const s=new URLSearchParams;s.append("sort",a.sort),s.append("direction",a.direction),a.search&&s.append("search",a.search),a.status&&a.status!=="all"&&s.append("status",a.status),a.priority&&a.priority!=="all"&&s.append("priority",a.priority),a.category&&a.category!=="all"&&s.append("category",a.category),a.assigned&&a.assigned!=="all"&&s.append("assigned",a.assigned),a.date_from&&s.append("date_from",a.date_from),a.date_to&&s.append("date_to",a.date_to),a.filter&&s.append("filter",a.filter),a.exclude_maintenance==="1"&&s.append("exclude_maintenance","1"),window.location.href=`/soporte/casos/export?${s}`},b=s=>a.sort!==s?e.jsx(rs,{className:"h-3 w-3 ml-1 text-gray-400"}):a.direction==="asc"?e.jsx(ss,{className:"h-3 w-3 ml-1 text-[#2c4370]"}):e.jsx(as,{className:"h-3 w-3 ml-1 text-[#2c4370]"}),ue=s=>{switch(s){case 1:return"bg-blue-100 text-blue-800";case 2:return"bg-yellow-100 text-yellow-800";case 3:return"bg-yellow-100 text-yellow-800";case 4:return"bg-orange-100 text-orange-800";case 5:return"bg-green-100 text-green-800";case 6:return"bg-gray-100 text-gray-800";default:return"bg-gray-100 text-gray-800"}};return e.jsxs(e.Fragment,{children:[e.jsx(Be,{title:"HelpDesk HUV - Casos"}),e.jsxs("div",{className:"min-h-screen flex flex-col bg-gray-50",children:[e.jsx(Ue,{breadcrumb:e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(K,{href:"/dashboard",className:"text-gray-600 hover:text-[#2c4370] hover:underline",children:"Inicio"}),e.jsx("span",{className:"text-gray-400",children:"/"}),e.jsx(K,{href:"/soporte/casos",className:"text-gray-600 hover:text-[#2c4370] hover:underline",children:"Soporte"}),e.jsx("span",{className:"text-gray-400",children:"/"}),e.jsx("span",{className:"font-medium text-gray-900",children:"Casos"})]})}),e.jsxs("main",{className:"flex-1 px-3 sm:px-6 py-4 sm:py-6",children:[a.filter&&e.jsxs("div",{className:"mb-4 bg-[#2c4370] text-white px-3 sm:px-4 py-2 sm:py-3 flex flex-col sm:flex-row items-start sm:items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm sm:text-base",children:[e.jsx(je,{className:"w-4 h-4 shrink-0"}),e.jsx("span",{className:"font-medium",children:me()}),e.jsxs("span",{className:"text-white/70",children:["(",m.total,")"]})]}),e.jsxs("button",{onClick:Ee,className:"flex items-center gap-1 hover:bg-white/20 px-2 py-1 transition-colors text-sm",children:[e.jsx(be,{className:"w-4 h-4"}),e.jsx("span",{children:"Quitar"})]})]}),e.jsxs("div",{className:"bg-white shadow border border-gray-200",children:[e.jsx("div",{className:"px-3 sm:px-6 py-3 sm:py-4 border-b",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[e.jsx("h1",{className:"text-lg sm:text-xl font-semibold text-gray-900",children:a.filter?me():"Casos"}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center gap-2 sm:gap-3",children:[e.jsxs("div",{className:"relative flex-1 sm:flex-initial",children:[e.jsx(H,{type:"text",placeholder:"Buscar...",className:"w-full sm:w-64 pr-10 h-9",value:C,onChange:s=>Z(s.target.value),onKeyDown:s=>{s.key==="Enter"&&pe()}}),e.jsx(c,{size:"sm",variant:"ghost",className:"absolute right-0 top-0 h-full px-3",onClick:pe,children:e.jsx(Ge,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(c,{variant:"outline",size:"sm",onClick:()=>Te(!te),className:`h-9 flex-1 sm:flex-initial ${U?"border-[#2c4370] text-[#2c4370]":""}`,children:[e.jsx(je,{className:"h-4 w-4 sm:mr-1"}),e.jsx("span",{className:"hidden sm:inline",children:"Filtros"}),U&&e.jsx("span",{className:"ml-1 bg-[#2c4370] text-white text-xs w-5 h-5 flex items-center justify-center",children:"!"})]}),e.jsxs(c,{size:"sm",className:"bg-[#2c4370] hover:bg-[#3d5583] text-white h-9 flex-1 sm:flex-initial",onClick:$e,children:[e.jsx("span",{className:"hidden sm:inline",children:"Exportar"}),e.jsx("span",{className:"sm:hidden",children:"Excel"})]}),e.jsx(K,{href:"/soporte/crear-caso",children:e.jsxs(c,{size:"sm",className:"bg-green-600 hover:bg-green-700 text-white h-9 flex-1 sm:flex-initial",children:[e.jsx(We,{className:"h-4 w-4 sm:mr-1"}),e.jsx("span",{className:"hidden sm:inline",children:"Crear Caso"})]})})]})]})]})}),te&&e.jsxs("div",{className:"px-3 sm:px-6 py-3 sm:py-4 bg-gray-50 border-b",children:[e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-6 gap-2 sm:gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600 mb-1 block",children:"Estado"}),e.jsxs(E,{value:h,onValueChange:le,children:[e.jsx(k,{className:"h-8 text-xs",children:e.jsx(L,{placeholder:"Todos"})}),e.jsxs(O,{children:[e.jsx(l,{value:"all",children:"Todos"}),e.jsx(l,{value:"1",children:"Nuevo"}),e.jsx(l,{value:"2",children:"En curso (asignado)"}),e.jsx(l,{value:"3",children:"En curso (planificado)"}),e.jsx(l,{value:"4",children:"En espera"}),e.jsx(l,{value:"5",children:"Resuelto"}),e.jsx(l,{value:"6",children:"Cerrado"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600 mb-1 block",children:"Prioridad"}),e.jsxs(E,{value:g,onValueChange:ne,children:[e.jsx(k,{className:"h-8 text-xs",children:e.jsx(L,{placeholder:"Todas"})}),e.jsxs(O,{children:[e.jsx(l,{value:"all",children:"Todas"}),e.jsx(l,{value:"1",children:"Muy baja"}),e.jsx(l,{value:"2",children:"Baja"}),e.jsx(l,{value:"3",children:"Media"}),e.jsx(l,{value:"4",children:"Alta"}),e.jsx(l,{value:"5",children:"Muy alta"}),e.jsx(l,{value:"6",children:"Urgente"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600 mb-1 block",children:"Asignado a"}),e.jsxs(E,{value:u,onValueChange:ce,children:[e.jsx(k,{className:"h-8 text-xs",children:e.jsx(L,{placeholder:"Todos"})}),e.jsxs(O,{children:[e.jsx(l,{value:"all",children:"Todos"}),we.map(s=>e.jsx(l,{value:s.id.toString(),children:s.fullname},s.id))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600 mb-1 block",children:"Categoría"}),e.jsxs(E,{value:p,onValueChange:ie,children:[e.jsx(k,{className:"h-8 text-xs",children:e.jsx(L,{placeholder:"Todas"})}),e.jsxs(O,{children:[e.jsx(l,{value:"all",children:"Todas"}),fe.map(s=>e.jsx(l,{value:s.id.toString(),children:s.completename},s.id))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600 mb-1 block",children:"Desde"}),e.jsx(H,{type:"date",value:w,onChange:s=>oe(s.target.value),className:"h-8 text-xs"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600 mb-1 block",children:"Hasta"}),e.jsx(H,{type:"date",value:S,onChange:s=>de(s.target.value),className:"h-8 text-xs"})]}),e.jsxs("div",{className:"col-span-2 sm:col-span-3 md:col-span-6 flex items-center gap-2 pt-1",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer select-none",children:[e.jsx("input",{type:"checkbox",checked:F,onChange:s=>xe(s.target.checked),className:"w-4 h-4 rounded border-gray-300 text-[#2c4370] focus:ring-[#2c4370] cursor-pointer"}),e.jsx("span",{className:"text-xs text-gray-700 font-medium",children:"Excluir Mantenimientos"})]}),e.jsx("span",{className:"text-[10px] text-gray-400",children:"(Oculta casos de mantenimiento preventivo y correctivo)"})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-end gap-2 mt-3",children:[U&&e.jsxs(c,{variant:"ghost",size:"sm",onClick:Re,className:"h-8 text-xs text-gray-600",children:[e.jsx(be,{className:"h-3 w-3 mr-1"}),"Limpiar"]}),e.jsx(c,{size:"sm",onClick:Pe,className:"bg-[#2c4370] hover:bg-[#3d5583] text-white h-8 text-xs",children:"Aplicar"})]})]}),e.jsxs("div",{className:"px-3 sm:px-6 py-2 sm:py-3 bg-gray-50 border-b flex flex-col sm:flex-row items-start sm:items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[e.jsx("span",{className:"text-xs sm:text-sm text-gray-600",children:"Mostrar"}),e.jsxs(E,{value:a.per_page.toString(),onValueChange:Ae,children:[e.jsx(k,{className:"w-16 sm:w-20 h-7 sm:h-8 text-xs sm:text-sm",children:e.jsx(L,{placeholder:"15"})}),e.jsxs(O,{children:[e.jsx(l,{value:"15",children:"15"}),e.jsx(l,{value:"20",children:"20"}),e.jsx(l,{value:"50",children:"50"}),e.jsx(l,{value:"100",children:"100"})]})]}),e.jsx("span",{className:"text-xs sm:text-sm text-gray-600 hidden sm:inline",children:"elementos"})]}),e.jsxs("p",{className:"text-xs sm:text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:m.data.length})," de"," ",e.jsx("span",{className:"font-medium",children:m.total})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Xe,{children:[e.jsx(Ye,{children:e.jsxs(Q,{className:"bg-gray-50",children:[e.jsx(d,{className:"font-semibold text-gray-900 text-xs cursor-pointer hover:bg-gray-100 w-16",onClick:()=>y("id"),children:e.jsxs("div",{className:"flex items-center",children:["ID",b("id")]})}),e.jsx(d,{className:"font-semibold text-gray-900 text-xs cursor-pointer hover:bg-gray-100",onClick:()=>y("name"),children:e.jsxs("div",{className:"flex items-center",children:["Título",b("name")]})}),e.jsx(d,{className:"font-semibold text-gray-900 text-xs cursor-pointer hover:bg-gray-100",onClick:()=>y("status"),children:e.jsxs("div",{className:"flex items-center",children:["Estado",b("status")]})}),e.jsx(d,{className:"font-semibold text-gray-900 text-xs cursor-pointer hover:bg-gray-100",onClick:()=>y("priority"),children:e.jsxs("div",{className:"flex items-center",children:["Prioridad",b("priority")]})}),e.jsx(d,{className:"font-semibold text-gray-900 text-xs cursor-pointer hover:bg-gray-100",onClick:()=>y("entity_name"),children:e.jsxs("div",{className:"flex items-center",children:["Entidad",b("entity_name")]})}),e.jsx(d,{className:"font-semibold text-gray-900 text-xs cursor-pointer hover:bg-gray-100",onClick:()=>y("date"),children:e.jsxs("div",{className:"flex items-center",children:["Fecha de apertura",b("date")]})}),e.jsx(d,{className:"font-semibold text-gray-900 text-xs cursor-pointer hover:bg-gray-100",onClick:()=>y("date_mod"),children:e.jsxs("div",{className:"flex items-center",children:["Última actualización",b("date_mod")]})}),e.jsx(d,{className:"font-semibold text-gray-900 text-xs",children:"Solicitante"}),e.jsx(d,{className:"font-semibold text-gray-900 text-xs",children:"Asignado a"}),e.jsx(d,{className:"font-semibold text-gray-900 text-xs",children:"Categoría"}),e.jsx(d,{className:"font-semibold text-gray-900 text-xs",children:"Elemento"}),V()&&e.jsx(d,{className:"font-semibold text-gray-900 text-xs text-center w-24",children:"Acciones"})]})}),e.jsxs(Je,{children:[m.data.map(s=>e.jsxs(Q,{className:"hover:bg-gray-50",children:[e.jsx(o,{className:"text-xs font-medium",children:s.id}),e.jsx(o,{className:"font-medium text-xs",children:e.jsx("button",{onClick:async()=>{if(_e(s),se(null),_(!0),s.status===5||s.status===6){ae(!0);try{const t=await fetch(`/dashboard/ticket/${s.id}`);if(t.ok){const n=await t.json();n.solution&&se(n.solution)}}catch(t){console.error("Error fetching solution:",t)}finally{ae(!1)}}},className:"text-[#2c4370] hover:underline block truncate max-w-md text-left",title:s.name,children:s.name||"(Sin título)"})}),e.jsx(o,{className:"text-xs",children:e.jsx("span",{className:`px-2 py-1 text-[10px] font-semibold ${ue(s.status)}`,children:s.status_name})}),e.jsx(o,{className:"text-xs",children:s.priority_name}),e.jsx(o,{className:"text-xs",children:s.entity_name||"-"}),e.jsx(o,{className:"text-xs text-gray-600",children:s.date?new Date(s.date).toLocaleDateString("es-CO",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"-"}),e.jsx(o,{className:"text-xs text-gray-600",children:s.date_mod?new Date(s.date_mod).toLocaleDateString("es-CO",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"-"}),e.jsx(o,{className:"text-xs",children:s.requester_name||"-"}),e.jsx(o,{className:"text-xs",children:s.assigned_name||"-"}),e.jsx(o,{className:"text-xs",children:s.category_name||"-"}),e.jsx(o,{className:"text-xs text-gray-600",children:s.item_name||"-"}),V()&&e.jsx(o,{className:"text-xs",children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[he(s)&&s.status!==5&&s.status!==6&&e.jsx(c,{variant:"ghost",size:"sm",className:"h-7 w-7 p-0 text-green-600 hover:text-green-800 hover:bg-green-50",onClick:()=>ge(s),title:"Resolver",children:e.jsx(I,{className:"h-3.5 w-3.5"})}),e.jsx(c,{variant:"ghost",size:"sm",className:"h-7 w-7 p-0 text-blue-600 hover:text-blue-800 hover:bg-blue-50",onClick:()=>x.visit(`/soporte/casos/${s.id}/editar`),title:"Editar",children:e.jsx(Ze,{className:"h-3.5 w-3.5"})}),ke(s)&&e.jsx(c,{variant:"ghost",size:"sm",className:"h-7 w-7 p-0 text-red-600 hover:text-red-800 hover:bg-red-50",onClick:()=>Oe(s),title:"Eliminar",children:e.jsx(Ke,{className:"h-3.5 w-3.5"})})]})})]},s.id)),m.data.length===0&&e.jsx(Q,{children:e.jsx(o,{colSpan:V()?12:11,className:"text-center py-8 text-gray-500",children:"No se encontraron casos"})})]})]})}),e.jsxs("div",{className:"px-3 sm:px-6 py-3 sm:py-4 border-t flex flex-col sm:flex-row items-center justify-between gap-3",children:[e.jsxs("div",{className:"text-xs sm:text-sm text-gray-600 order-2 sm:order-1",children:["Página ",m.current_page," de ",m.last_page]}),e.jsx("div",{className:"flex items-center gap-1 sm:gap-2 order-1 sm:order-2 flex-wrap justify-center",children:m.links.map((s,t)=>{const n=t===0||t===m.links.length-1||s.active;return t===0?e.jsx(c,{variant:"outline",size:"sm",disabled:!s.url,className:"border-[#2c4370] text-[#2c4370] hover:!bg-[#2c4370] hover:!text-white disabled:opacity-50 h-8 w-8 p-0",onClick:()=>s.url&&G(s.url),children:e.jsx(es,{className:"h-4 w-4"})},t):t===m.links.length-1?e.jsx(c,{variant:"outline",size:"sm",disabled:!s.url,className:"border-[#2c4370] text-[#2c4370] hover:!bg-[#2c4370] hover:!text-white disabled:opacity-50 h-8 w-8 p-0",onClick:()=>s.url&&G(s.url),children:e.jsx(ts,{className:"h-4 w-4"})},t):e.jsx(c,{variant:s.active?"default":"outline",size:"sm",disabled:!s.url,className:`${n?"":"hidden sm:inline-flex"} h-8 min-w-[32px] px-2 text-xs sm:text-sm ${s.active?"bg-[#2c4370] hover:!bg-[#3d5583] text-white border-[#2c4370]":"border-[#2c4370] text-[#2c4370] hover:!bg-[#2c4370] hover:!text-white"}`,onClick:()=>s.url&&G(s.url),children:e.jsx("span",{dangerouslySetInnerHTML:{__html:s.label}})},t)})})]})]})]}),e.jsx(Qe,{})]}),e.jsx(X,{open:Se,onOpenChange:z,children:e.jsxs(Y,{className:"sm:max-w-[425px]",children:[e.jsxs(J,{children:[e.jsx(W,{children:"Eliminar Caso"}),e.jsxs(ve,{children:["¿Está seguro que desea eliminar el caso ",e.jsxs("strong",{children:["#",A?.id]}),"?",e.jsx("br",{}),e.jsx("span",{className:"text-gray-600",children:A?.name})]})]}),e.jsxs(ye,{className:"gap-2",children:[e.jsx(c,{variant:"outline",onClick:()=>z(!1),children:"Cancelar"}),e.jsx(c,{variant:"destructive",onClick:ze,className:"bg-red-600 hover:bg-red-700",children:"Eliminar"})]})]})}),e.jsx(X,{open:Ce,onOpenChange:_,children:e.jsxs(Y,{className:"sm:max-w-[600px] max-h-[90vh] overflow-y-auto",children:[e.jsx(J,{children:e.jsxs(W,{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-[#2c4370]",children:["Caso #",r?.id]}),e.jsx("span",{className:`px-2 py-0.5 text-[10px] font-semibold ${r?ue(r.status):""}`,children:r?.status_name})]})}),r&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{children:e.jsx("h3",{className:"text-sm font-semibold text-gray-900",children:r.name})}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-xs",children:[e.jsxs("div",{className:"bg-gray-50 p-2",children:[e.jsx("span",{className:"text-gray-500 block",children:"Prioridad"}),e.jsx("span",{className:"font-medium",children:r.priority_name})]}),e.jsxs("div",{className:"bg-gray-50 p-2",children:[e.jsx("span",{className:"text-gray-500 block",children:"Entidad"}),e.jsx("span",{className:"font-medium",children:r.entity_name||"-"})]}),e.jsxs("div",{className:"bg-gray-50 p-2",children:[e.jsx("span",{className:"text-gray-500 block",children:"Fecha de Apertura"}),e.jsx("span",{className:"font-medium",children:r.date?new Date(r.date).toLocaleDateString("es-CO",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"-"})]}),e.jsxs("div",{className:"bg-gray-50 p-2",children:[e.jsx("span",{className:"text-gray-500 block",children:"Última Actualización"}),e.jsx("span",{className:"font-medium",children:r.date_mod?new Date(r.date_mod).toLocaleDateString("es-CO",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"-"})]}),e.jsxs("div",{className:"bg-gray-50 p-2",children:[e.jsx("span",{className:"text-gray-500 block",children:"Solicitante"}),e.jsx("span",{className:"font-medium",children:r.requester_name||"-"})]}),e.jsxs("div",{className:"bg-gray-50 p-2",children:[e.jsx("span",{className:"text-gray-500 block",children:"Asignado a"}),e.jsx("span",{className:"font-medium",children:r.assigned_name||"-"})]}),e.jsxs("div",{className:"bg-gray-50 p-2 col-span-2",children:[e.jsx("span",{className:"text-gray-500 block",children:"Categoría"}),e.jsx("span",{className:"font-medium",children:r.category_name||"-"})]})]}),(r.status===5||r.status===6)&&e.jsxs("div",{className:"pt-3 border-t",children:[e.jsx("span",{className:"text-xs font-semibold text-green-700 block mb-2",children:"Solución"}),De?e.jsxs("div",{className:"bg-green-50 p-3 border border-green-200 flex items-center justify-center",children:[e.jsx(Ne,{className:"h-4 w-4 animate-spin text-green-600"}),e.jsx("span",{className:"ml-2 text-xs text-green-600",children:"Cargando solución..."})]}):D?e.jsxs("div",{className:"bg-green-50 p-3 border border-green-200",children:[e.jsx("div",{className:"text-xs text-gray-700 whitespace-pre-wrap",dangerouslySetInnerHTML:{__html:D.content}}),e.jsxs("div",{className:"mt-2 pt-2 border-t border-green-200 flex items-center justify-between text-[10px] text-green-700",children:[e.jsxs("span",{children:["Resuelto por: ",e.jsx("strong",{children:D.solved_by||"Usuario del sistema"})]}),e.jsx("span",{children:D.date_creation?new Date(D.date_creation).toLocaleString("es-CO"):"-"})]})]}):e.jsx("div",{className:"bg-gray-50 p-3 border border-gray-200 text-xs text-gray-500",children:"No se encontró solución registrada"})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2 border-t",children:[e.jsx(c,{variant:"outline",size:"sm",onClick:()=>_(!1),className:"h-8 text-xs",children:"Cerrar"}),he(r)&&r.status!==5&&r.status!==6&&e.jsxs(c,{size:"sm",onClick:()=>{_(!1),ge(r)},className:"bg-green-600 hover:bg-green-700 text-white h-8 text-xs",children:[e.jsx(I,{className:"h-3.5 w-3.5 mr-1"}),"Resolver"]}),V()&&e.jsx(c,{size:"sm",onClick:()=>{_(!1),x.visit(`/soporte/casos/${r.id}/editar`)},className:"bg-[#2c4370] hover:bg-[#3d5583] text-white h-8 text-xs",children:"Editar Caso"})]})]})]})}),e.jsx(X,{open:Fe,onOpenChange:P,children:e.jsxs(Y,{className:"sm:max-w-[500px]",children:[e.jsxs(J,{children:[e.jsxs(W,{className:"flex items-center gap-2",children:[e.jsx(I,{className:"h-5 w-5 text-green-600"}),"Resolver Caso"]}),e.jsxs(ve,{children:["Resolver el caso ",e.jsxs("strong",{children:["#",v?.id]}),": ",v?.name]})]}),re&&e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 text-sm rounded",children:re}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Descripción de la solución ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{value:N,onChange:s=>R(s.target.value),placeholder:"Describe cómo se resolvió el problema...",className:"w-full px-3 py-2 border focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500 min-h-[120px] text-sm",autoFocus:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Fecha y hora de solución"}),e.jsx(H,{type:"datetime-local",value:f,onChange:s=>$(s.target.value),className:"w-full"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Por defecto se usa la fecha y hora actual. Puede modificarla si la solución fue en otro momento."})]})]}),e.jsxs(ye,{className:"gap-2",children:[e.jsx(c,{variant:"outline",onClick:()=>{P(!1),q(null),R(""),$("")},disabled:B,children:"Cancelar"}),e.jsx(c,{type:"button",onClick:()=>{console.log("Resolve button clicked"),Le()},disabled:!N.trim()||B,className:"bg-green-600 hover:bg-green-700 text-white",children:B?e.jsxs(e.Fragment,{children:[e.jsx(Ne,{className:"h-4 w-4 mr-1 animate-spin"}),"Resolviendo..."]}):e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"h-4 w-4 mr-1"}),"Resolver"]})})]})]})})]})}export{Ts as default};
