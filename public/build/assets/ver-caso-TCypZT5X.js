import{a as p,j as e,H as T,L as x,r as y}from"./app-CuU36oDn.js";import{G as M,a as F}from"./glpi-footer-DSsUgFEp.js";import{a as g,B as m}from"./button-DVHRk4GT.js";import{L as r}from"./label-XRjXBRBn.js";import{T as D}from"./textarea-DMIO5dVW.js";import{S as E}from"./square-pen-yczYzE3M.js";import{M as A}from"./monitor-D1ZxVqpE.js";import{F as H}from"./file-text-DZsiBxAG.js";import{D as I}from"./download-BhrrRVvb.js";/* empty css            */import"./dialog-D4T8cPZV.js";import"./index-C1AcoXpV.js";import"./index-YHcrIevc.js";import"./index-Do5p7SCf.js";import"./x-DcKeYYSk.js";import"./input-BmvEjym_.js";import"./index-BXtJcT9j.js";import"./loader-circle-wGve2EE5.js";import"./check-D9BQAQZV.js";import"./sun-CqvURXGW.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["circle",{cx:"10",cy:"12",r:"2",key:"737tya"}],["path",{d:"m20 17-1.296-1.296a2.41 2.41 0 0 0-3.408 0L9 22",key:"wt3hpn"}]],z=g("FileImage",$);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q=[["path",{d:"M13.234 20.252 21 12.3",key:"1cbrk9"}],["path",{d:"m16 6-8.414 8.586a2 2 0 0 0 0 2.828 2 2 0 0 0 2.828 0l8.414-8.586a4 4 0 0 0 0-5.656 4 4 0 0 0-5.656 0l-8.415 8.585a6 6 0 1 0 8.486 8.486",key:"1pkts6"}]],R=g("Paperclip",q);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V=[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z",key:"cbrjhi"}]],f=g("Wrench",V),B={1:"bg-blue-100 text-blue-700",2:"bg-yellow-100 text-yellow-700",3:"bg-purple-100 text-purple-700",4:"bg-orange-100 text-orange-700",5:"bg-green-100 text-green-700",6:"bg-gray-100 text-gray-600"},G={1:"bg-gray-100 text-gray-600",2:"bg-blue-100 text-blue-600",3:"bg-yellow-100 text-yellow-700",4:"bg-orange-100 text-orange-600",5:"bg-red-100 text-red-600",6:"bg-red-200 text-red-700"},O={Computer:"Computador",Monitor:"Monitor",NetworkEquipment:"Dispositivo de Red",Peripheral:"Periférico",Printer:"Impresora",Phone:"Teléfono",Enclosure:"Gabinete"};function xe({ticket:s,requester:v,technician:w,ticketItems:j,attachments:i,solution:c}){const[o,_]=p.useState(!1),[n,C]=p.useState(""),[u,N]=p.useState(!1),b=a=>{const t=document.createElement("div");return t.innerHTML=a,t.textContent||t.innerText||""},d=a=>a?new Date(a).toLocaleDateString("es-CO",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}):"-",S=async()=>{if(!n.trim()||n.length<10){alert("La solución debe tener al menos 10 caracteres");return}N(!0);try{const a=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content"),t=await fetch(`/soporte/casos/${s.id}/solucion`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":a||"","X-Requested-With":"XMLHttpRequest"},credentials:"include",body:JSON.stringify({solution:n})});if(t.status===419){alert("Tu sesión ha expirado. La página se recargará."),window.location.reload();return}if(t.ok||t.redirected)y.visit("/dashboard",{preserveState:!1,replace:!0});else{const h=await t.json().catch(()=>({}));alert(h.message||"Error al cerrar el caso. Intenta de nuevo.")}}catch{alert("Error de conexión. Verifica tu internet e intenta de nuevo.")}finally{N(!1)}},L=s.status!==5&&s.status!==6;return e.jsxs(e.Fragment,{children:[e.jsx(T,{title:`Caso #${s.id} - HelpDesk HUV`}),e.jsxs("div",{className:"min-h-screen flex flex-col bg-gray-50",children:[e.jsx(M,{breadcrumb:e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(x,{href:"/dashboard",className:"text-gray-600 hover:text-[#2c4370] hover:underline",children:"Inicio"}),e.jsx("span",{className:"text-gray-400",children:"/"}),e.jsx(x,{href:"/soporte/casos",className:"text-gray-600 hover:text-[#2c4370] hover:underline",children:"Soporte"}),e.jsx("span",{className:"text-gray-400",children:"/"}),e.jsx(x,{href:"/soporte/casos",className:"text-gray-600 hover:text-[#2c4370] hover:underline",children:"Casos"}),e.jsx("span",{className:"text-gray-400",children:"/"}),e.jsxs("span",{className:"font-medium text-gray-900",children:["Ver #",s.id]})]})}),e.jsx("main",{className:"flex-1 px-6 py-6",children:e.jsx("div",{className:"max-w-5xl mx-auto",children:e.jsxs("div",{className:"bg-white rounded-lg shadow",children:[e.jsxs("div",{className:"px-6 py-4 border-b flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("h1",{className:"text-xl font-semibold text-gray-900",children:["Caso #",s.id]}),e.jsx("span",{className:`text-xs font-medium px-2 py-1 rounded ${B[s.status]}`,children:s.status_name}),e.jsx("span",{className:`text-xs font-medium px-2 py-1 rounded ${G[s.priority]}`,children:s.priority_name})]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:s.name})]}),e.jsxs("div",{className:"flex gap-2",children:[L&&e.jsxs(m,{size:"sm",onClick:()=>_(!o),className:`h-8 text-xs ${o?"bg-gray-500 hover:bg-gray-600":"bg-green-600 hover:bg-green-700"}`,children:[e.jsx(f,{className:"w-3.5 h-3.5 mr-1"}),o?"Cancelar":"Procesar caso"]}),e.jsx(x,{href:`/soporte/casos/${s.id}/editar`,children:e.jsxs(m,{size:"sm",className:"bg-[#2c4370] hover:bg-[#3d5583] h-8 text-xs",children:[e.jsx(E,{className:"w-3.5 h-3.5 mr-1"}),"Editar"]})})]})]}),e.jsxs("div",{className:"p-4",children:[o&&e.jsxs("div",{className:"mb-4 p-4 bg-green-50 border border-green-200 rounded-lg",children:[e.jsx(r,{className:"text-xs font-semibold text-green-800",children:"Solución *"}),e.jsx(D,{value:n,onChange:a=>C(a.target.value),placeholder:"Describe cómo se solucionó el problema (mínimo 10 caracteres)...",rows:3,className:"mt-1 text-sm bg-white"}),e.jsxs("div",{className:"mt-2 flex items-center justify-between",children:[e.jsx("p",{className:"text-xs text-green-700",children:"Al agregar la solución, el caso se cerrará automáticamente."}),e.jsx(m,{size:"sm",onClick:S,disabled:u||n.length<10,className:"bg-green-600 hover:bg-green-700 h-8 text-xs",children:u?"Cerrando...":"Cerrar Caso"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"md:col-span-2 space-y-3",children:[e.jsxs("div",{children:[e.jsx(r,{className:"text-xs text-gray-500",children:"Solicitante"}),e.jsx("p",{className:"text-sm font-medium",children:v?.fullname||"Reporte Público"})]}),e.jsxs("div",{children:[e.jsx(r,{className:"text-xs text-gray-500",children:"Técnico Asignado"}),e.jsx("p",{className:"text-sm font-medium",children:w?.fullname||e.jsx("span",{className:"text-orange-500",children:"Sin asignar"})})]}),s.category_name&&e.jsxs("div",{children:[e.jsx(r,{className:"text-xs text-gray-500",children:"Categoría"}),e.jsx("p",{className:"text-sm",children:s.category_name})]}),s.location_name&&e.jsxs("div",{children:[e.jsx(r,{className:"text-xs text-gray-500",children:"Ubicación"}),e.jsx("p",{className:"text-sm",children:s.location_name})]})]}),e.jsxs("div",{className:"md:col-span-2 space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(r,{className:"text-xs text-gray-500",children:"Fecha Apertura"}),e.jsx("p",{className:"text-sm",children:d(s.date)})]}),e.jsxs("div",{children:[e.jsx(r,{className:"text-xs text-gray-500",children:"Última Modificación"}),e.jsx("p",{className:"text-sm",children:d(s.date_mod)})]}),e.jsxs("div",{children:[e.jsx(r,{className:"text-xs text-gray-500",children:"Urgencia"}),e.jsx("p",{className:"text-sm",children:s.urgency_name})]}),e.jsxs("div",{children:[e.jsx(r,{className:"text-xs text-gray-500",children:"Impacto"}),e.jsx("p",{className:"text-sm",children:s.impact_name})]})]}),s.time_to_resolve&&e.jsxs("div",{children:[e.jsx(r,{className:"text-xs text-gray-500",children:"Fecha Límite"}),e.jsx("p",{className:"text-sm",children:d(s.time_to_resolve)})]})]}),e.jsxs("div",{className:"md:col-span-4",children:[e.jsx(r,{className:"text-xs text-gray-500",children:"Descripción del Problema"}),e.jsx("div",{className:"mt-1 p-3 bg-gray-50 rounded border text-sm whitespace-pre-wrap",children:b(s.content)})]}),c&&e.jsxs("div",{className:"md:col-span-4",children:[e.jsxs(r,{className:"text-xs text-gray-500 flex items-center gap-1",children:[e.jsx(f,{className:"w-3 h-3"}),"Solución del Caso"]}),e.jsxs("div",{className:"mt-1 p-3 bg-green-50 rounded border border-green-200",children:[e.jsx("div",{className:"text-sm whitespace-pre-wrap text-gray-700",children:b(c.content)}),e.jsxs("div",{className:"mt-2 pt-2 border-t border-green-200 flex items-center justify-between text-xs text-green-700",children:[e.jsxs("span",{children:["Resuelto por: ",e.jsx("strong",{children:c.solved_by||"Usuario del sistema"})]}),e.jsx("span",{children:d(c.date_creation)})]})]})]}),j.length>0&&e.jsxs("div",{className:"md:col-span-4",children:[e.jsx(r,{className:"text-xs text-gray-500",children:"Elementos Asociados"}),e.jsx("div",{className:"mt-1 flex flex-wrap gap-2",children:j.map((a,t)=>e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-blue-50 border border-blue-200 rounded text-sm",children:[e.jsx(A,{className:"w-3.5 h-3.5 text-blue-600"}),e.jsx("span",{children:a.name}),e.jsxs("span",{className:"text-xs text-blue-600",children:["(",O[a.itemtype]||a.itemtype,")"]})]},t))})]}),i&&i.length>0&&e.jsxs("div",{className:"md:col-span-4",children:[e.jsxs(r,{className:"text-xs text-gray-500 flex items-center gap-1",children:[e.jsx(R,{className:"w-3 h-3"}),"Archivos Adjuntos (",i.length,")"]}),e.jsx("div",{className:"mt-2 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2",children:i.map((a,t)=>{const h=/\.(jpg|jpeg|png|gif|webp|bmp)$/i.test(a.name),P=l=>l<1024?l+" B":l<1024*1024?(l/1024).toFixed(1)+" KB":(l/(1024*1024)).toFixed(1)+" MB";return e.jsxs("a",{href:a.url,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-3 p-2 bg-gray-50 hover:bg-gray-100 border rounded transition-colors",children:[h?e.jsx(z,{className:"w-5 h-5 text-green-600 flex-shrink-0"}):e.jsx(H,{className:"w-5 h-5 text-blue-600 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium truncate",children:a.name}),e.jsx("p",{className:"text-xs text-gray-500",children:P(a.size)})]}),e.jsx(I,{className:"w-4 h-4 text-gray-400"})]},t)})})]})]}),e.jsx("div",{className:"mt-4 flex items-center justify-end gap-2 pt-3 border-t",children:e.jsx(m,{variant:"ghost",size:"sm",onClick:()=>y.visit("/dashboard"),className:"h-8 text-xs",children:"Volver al Dashboard"})})]})]})})}),e.jsx(F,{})]})]})}export{xe as default};
