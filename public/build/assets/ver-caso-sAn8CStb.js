import{a as o,j as e,H as v,L as w,r as h}from"./app-BM4BJw06.js";import{G as C,a as S}from"./glpi-footer-CTCh5oxe.js";import{a as _,B as i}from"./button-CCTAvrTd.js";import{L as t}from"./label-_MUXGxLO.js";import{T as L}from"./textarea-C30Ftfqc.js";import{S as P}from"./square-pen-BMQoalaZ.js";import{M as T}from"./monitor-D1NhSTE4.js";/* empty css            */import"./input-RAbXhAdf.js";import"./index-DWc6qeyd.js";import"./index-DllRUzU9.js";import"./index-BueauBAi.js";import"./index-cgXawvYi.js";import"./refresh-cw-DGLahacD.js";import"./triangle-alert-DY9YEQez.js";import"./check-S3vZEq_4.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const E=[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z",key:"cbrjhi"}]],D=_("Wrench",E),H={1:"bg-blue-100 text-blue-700",2:"bg-yellow-100 text-yellow-700",3:"bg-purple-100 text-purple-700",4:"bg-orange-100 text-orange-700",5:"bg-green-100 text-green-700",6:"bg-gray-100 text-gray-600"},M={1:"bg-gray-100 text-gray-600",2:"bg-blue-100 text-blue-600",3:"bg-yellow-100 text-yellow-700",4:"bg-orange-100 text-orange-600",5:"bg-red-100 text-red-600",6:"bg-red-200 text-red-700"},A={Computer:"Computador",Monitor:"Monitor",NetworkEquipment:"Dispositivo de Red",Peripheral:"Periférico",Printer:"Impresora",Phone:"Teléfono",Enclosure:"Gabinete"};function Y({ticket:s,requester:p,technician:g,ticketItems:d}){const[l,j]=o.useState(!1),[n,u]=o.useState(""),[x,m]=o.useState(!1),N=a=>{const r=document.createElement("div");return r.innerHTML=a,r.textContent||r.innerText||""},c=a=>a?new Date(a).toLocaleDateString("es-CO",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}):"-",b=async()=>{if(!n.trim()||n.length<10){alert("La solución debe tener al menos 10 caracteres");return}m(!0);try{const a=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content"),r=await fetch(`/soporte/casos/${s.id}/solucion`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":a||"","X-Requested-With":"XMLHttpRequest"},credentials:"include",body:JSON.stringify({solution:n})});if(r.status===419){alert("Tu sesión ha expirado. La página se recargará."),window.location.reload();return}if(r.ok||r.redirected)h.visit("/dashboard",{preserveState:!1,replace:!0});else{const f=await r.json().catch(()=>({}));alert(f.message||"Error al cerrar el caso. Intenta de nuevo.")}}catch{alert("Error de conexión. Verifica tu internet e intenta de nuevo.")}finally{m(!1)}},y=s.status!==5&&s.status!==6;return e.jsxs(e.Fragment,{children:[e.jsx(v,{title:`Caso #${s.id} - HelpDesk HUV`}),e.jsxs("div",{className:"min-h-screen flex flex-col bg-gray-50",children:[e.jsx(C,{breadcrumb:e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Inicio"}),e.jsx("span",{className:"text-gray-400",children:"/"}),e.jsx("span",{className:"text-gray-600",children:"Soporte"}),e.jsx("span",{className:"text-gray-400",children:"/"}),e.jsx("span",{className:"text-gray-600",children:"Casos"}),e.jsx("span",{className:"text-gray-400",children:"/"}),e.jsxs("span",{className:"font-medium text-gray-900",children:["Ver #",s.id]})]})}),e.jsx("main",{className:"flex-1 px-6 py-6",children:e.jsx("div",{className:"max-w-5xl mx-auto",children:e.jsxs("div",{className:"bg-white rounded-lg shadow",children:[e.jsxs("div",{className:"px-6 py-4 border-b flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("h1",{className:"text-xl font-semibold text-gray-900",children:["Caso #",s.id]}),e.jsx("span",{className:`text-xs font-medium px-2 py-1 rounded ${H[s.status]}`,children:s.status_name}),e.jsx("span",{className:`text-xs font-medium px-2 py-1 rounded ${M[s.priority]}`,children:s.priority_name})]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:s.name})]}),e.jsxs("div",{className:"flex gap-2",children:[y&&e.jsxs(i,{size:"sm",onClick:()=>j(!l),className:`h-8 text-xs ${l?"bg-gray-500 hover:bg-gray-600":"bg-green-600 hover:bg-green-700"}`,children:[e.jsx(D,{className:"w-3.5 h-3.5 mr-1"}),l?"Cancelar":"Procesar caso"]}),e.jsx(w,{href:`/soporte/casos/${s.id}/editar`,children:e.jsxs(i,{size:"sm",className:"bg-[#2c4370] hover:bg-[#3d5583] h-8 text-xs",children:[e.jsx(P,{className:"w-3.5 h-3.5 mr-1"}),"Editar"]})})]})]}),e.jsxs("div",{className:"p-4",children:[l&&e.jsxs("div",{className:"mb-4 p-4 bg-green-50 border border-green-200 rounded-lg",children:[e.jsx(t,{className:"text-xs font-semibold text-green-800",children:"Solución *"}),e.jsx(L,{value:n,onChange:a=>u(a.target.value),placeholder:"Describe cómo se solucionó el problema (mínimo 10 caracteres)...",rows:3,className:"mt-1 text-sm bg-white"}),e.jsxs("div",{className:"mt-2 flex items-center justify-between",children:[e.jsx("p",{className:"text-xs text-green-700",children:"Al agregar la solución, el caso se cerrará automáticamente."}),e.jsx(i,{size:"sm",onClick:b,disabled:x||n.length<10,className:"bg-green-600 hover:bg-green-700 h-8 text-xs",children:x?"Cerrando...":"Cerrar Caso"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"md:col-span-2 space-y-3",children:[e.jsxs("div",{children:[e.jsx(t,{className:"text-xs text-gray-500",children:"Solicitante"}),e.jsx("p",{className:"text-sm font-medium",children:p?.fullname||"Reporte Público"})]}),e.jsxs("div",{children:[e.jsx(t,{className:"text-xs text-gray-500",children:"Técnico Asignado"}),e.jsx("p",{className:"text-sm font-medium",children:g?.fullname||e.jsx("span",{className:"text-orange-500",children:"Sin asignar"})})]}),s.category_name&&e.jsxs("div",{children:[e.jsx(t,{className:"text-xs text-gray-500",children:"Categoría"}),e.jsx("p",{className:"text-sm",children:s.category_name})]}),s.location_name&&e.jsxs("div",{children:[e.jsx(t,{className:"text-xs text-gray-500",children:"Ubicación"}),e.jsx("p",{className:"text-sm",children:s.location_name})]})]}),e.jsxs("div",{className:"md:col-span-2 space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(t,{className:"text-xs text-gray-500",children:"Fecha Apertura"}),e.jsx("p",{className:"text-sm",children:c(s.date)})]}),e.jsxs("div",{children:[e.jsx(t,{className:"text-xs text-gray-500",children:"Última Modificación"}),e.jsx("p",{className:"text-sm",children:c(s.date_mod)})]}),e.jsxs("div",{children:[e.jsx(t,{className:"text-xs text-gray-500",children:"Urgencia"}),e.jsx("p",{className:"text-sm",children:s.urgency_name})]}),e.jsxs("div",{children:[e.jsx(t,{className:"text-xs text-gray-500",children:"Impacto"}),e.jsx("p",{className:"text-sm",children:s.impact_name})]})]}),s.time_to_resolve&&e.jsxs("div",{children:[e.jsx(t,{className:"text-xs text-gray-500",children:"Fecha Límite"}),e.jsx("p",{className:"text-sm",children:c(s.time_to_resolve)})]})]}),e.jsxs("div",{className:"md:col-span-4",children:[e.jsx(t,{className:"text-xs text-gray-500",children:"Descripción del Problema"}),e.jsx("div",{className:"mt-1 p-3 bg-gray-50 rounded border text-sm whitespace-pre-wrap",children:N(s.content)})]}),d.length>0&&e.jsxs("div",{className:"md:col-span-4",children:[e.jsx(t,{className:"text-xs text-gray-500",children:"Elementos Asociados"}),e.jsx("div",{className:"mt-1 flex flex-wrap gap-2",children:d.map((a,r)=>e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-blue-50 border border-blue-200 rounded text-sm",children:[e.jsx(T,{className:"w-3.5 h-3.5 text-blue-600"}),e.jsx("span",{children:a.name}),e.jsxs("span",{className:"text-xs text-blue-600",children:["(",A[a.itemtype]||a.itemtype,")"]})]},r))})]})]}),e.jsx("div",{className:"mt-4 flex items-center justify-end gap-2 pt-3 border-t",children:e.jsx(i,{variant:"ghost",size:"sm",onClick:()=>h.visit("/dashboard"),className:"h-8 text-xs",children:"Volver al Dashboard"})})]})]})})}),e.jsx(S,{})]})]})}export{Y as default};
