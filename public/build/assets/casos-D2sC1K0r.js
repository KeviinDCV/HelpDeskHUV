import{R as i,j as e,H as Me,L as X,r as m}from"./app-LlxLhdrF.js";import{G as qe,S as Be,c as Ue,a as Ge}from"./glpi-footer-CIBcBuBd.js";import{F as je,e as Ke,a as Xe,b as Q,T as d,d as Qe,c}from"./table-CkBBV64U.js";import{B as o}from"./button-XjCgWikp.js";import{I}from"./input-B3WadBH8.js";import{e as Y,d as J,b as W,D as Z,a as ve,c as ye}from"./dialog-KraiOEIA.js";import{S as E,a as k,b as A,c as L,d as l}from"./select-JxfR-ci6.js";import{X as be}from"./index-DqQDVyZu.js";import{P as Ye}from"./plus-oZW1Zyn3.js";import{S as M}from"./square-check-big-CWcKUeNG.js";import{S as Je}from"./square-pen-oZYenwva.js";import{C as We,A as Ze,a as es}from"./chevron-left-sBogzZCz.js";import{a as ss,C as as}from"./chevrons-up-down-Bl9TduYF.js";import{L as Ne}from"./loader-circle-aUW6eWiu.js";/* empty css            */import"./file-text-D0ILG4QV.js";import"./monitor-B27lQ6sj.js";import"./index-DWZTgA_w.js";import"./index-DE982IrC.js";import"./index-BwSu1JUP.js";import"./check-DswGVb6u.js";function Ss({tickets:x,categories:fe,technicians:we,filters:a,auth:j}){const[w,ee]=i.useState(a.search||""),[Se,O]=i.useState(!1),[R,se]=i.useState(null),[Ce,S]=i.useState(!1),[r,_e]=i.useState(null),[C,ae]=i.useState(null),[De,te]=i.useState(!1),[re,Te]=i.useState(!1),[Fe,z]=i.useState(!1),[v,q]=i.useState(null),[_,P]=i.useState(""),[D,$]=i.useState(""),[B,V]=i.useState(!1),[le,T]=i.useState(null),[h,ne]=i.useState(a.status||"all"),[g,ie]=i.useState(a.priority||"all"),[p,oe]=i.useState(a.category||"all"),[u,ce]=i.useState(a.assigned||"all"),[N,de]=i.useState(a.date_from||""),[f,xe]=i.useState(a.date_to||""),U=h&&h!=="all"||g&&g!=="all"||p&&p!=="all"||u&&u!=="all"||N||f||a.filter,me=()=>{switch(a.filter){case"unassigned":return"Sin asignar";case"my_cases":return"Mis casos";case"my_pending":return"Sin resolver";case"my_resolved":return"Resueltos";default:return null}},Ee=()=>{m.get("/soporte/casos",{per_page:a.per_page,sort:a.sort,direction:a.direction},{preserveState:!1})},ke=s=>j.user.role==="Administrador"?!0:j.user.role==="Técnico"?s.assigned_user_id===j.user.id||s.requester_user_id===j.user.id:!1,H=()=>j.user.role==="Administrador"||j.user.role==="Técnico",he=s=>j.user.role==="Administrador"?!0:s.assigned_user_id===j.user.id&&s.status!==5&&s.status!==6,ge=s=>{q(s),P(""),T(null);const t=new Date,n=t.getFullYear(),F=String(t.getMonth()+1).padStart(2,"0"),K=String(t.getDate()).padStart(2,"0"),Ve=String(t.getHours()).padStart(2,"0"),He=String(t.getMinutes()).padStart(2,"0"),Ie=`${n}-${F}-${K}T${Ve}:${He}`;$(Ie),z(!0)},Ae=async()=>{if(!v||!_.trim()){console.log("confirmSolve blocked:",{ticketToSolve:v,solution:_.trim()});return}if(D&&v.date){const t=new Date(D),n=new Date(v.date);if(t<n){T("La fecha de solución no puede ser anterior a la fecha de creación del caso.");return}}V(!0),T(null);const s=D?D.replace("T"," ")+":00":null;try{const t=new FormData;t.append("solution",_.trim()),s&&t.append("solve_date",s);const n=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||"",F=await fetch(`/dashboard/solve-ticket/${v.id}`,{method:"POST",headers:{"X-CSRF-TOKEN":n,Accept:"application/json"},body:t});if(F.ok||F.redirected)V(!1),z(!1),q(null),P(""),$(""),window.location.reload();else{const K=await F.text();console.error("Response error:",K),V(!1),T("Error al resolver el caso. Intente nuevamente.")}}catch(t){console.error("Fetch error:",t),V(!1),T("Error de conexión. Intente nuevamente.")}},Le=s=>{se(s),O(!0)},Oe=()=>{R&&m.delete(`/soporte/casos/${R.id}`,{preserveScroll:!0,onSuccess:()=>{O(!1),se(null)}})},y=s=>{const t=a.sort===s&&a.direction==="asc"?"desc":"asc",n={per_page:a.per_page,sort:s,direction:t};a.search&&(n.search=a.search),a.status&&(n.status=a.status),a.priority&&(n.priority=a.priority),a.category&&(n.category=a.category),a.assigned&&(n.assigned=a.assigned),a.date_from&&(n.date_from=a.date_from),a.date_to&&(n.date_to=a.date_to),a.filter&&(n.filter=a.filter),m.get("/soporte/casos",n,{preserveState:!1,preserveScroll:!0})},G=s=>{s&&m.visit(s,{preserveScroll:!0})},pe=()=>{const s={per_page:a.per_page,sort:a.sort,direction:a.direction,page:1};w&&(s.search=w),h&&h!=="all"&&(s.status=h),g&&g!=="all"&&(s.priority=g),p&&p!=="all"&&(s.category=p),u&&u!=="all"&&(s.assigned=u),N&&(s.date_from=N),f&&(s.date_to=f),m.get("/soporte/casos",s,{preserveState:!1,preserveScroll:!1,replace:!0})},Re=s=>{const t={per_page:s,sort:a.sort,direction:a.direction,page:1};a.search&&(t.search=a.search),a.status&&(t.status=a.status),a.priority&&(t.priority=a.priority),a.category&&(t.category=a.category),a.assigned&&(t.assigned=a.assigned),a.date_from&&(t.date_from=a.date_from),a.date_to&&(t.date_to=a.date_to),a.filter&&(t.filter=a.filter),m.get("/soporte/casos",t,{preserveState:!1,preserveScroll:!0})},ze=()=>{const s={per_page:a.per_page,sort:a.sort,direction:a.direction,page:1};w&&(s.search=w),h&&h!=="all"&&(s.status=h),g&&g!=="all"&&(s.priority=g),p&&p!=="all"&&(s.category=p),u&&u!=="all"&&(s.assigned=u),N&&(s.date_from=N),f&&(s.date_to=f),console.log("Applying filters:",s),m.get("/soporte/casos",s,{preserveState:!1,preserveScroll:!1,replace:!0})},Pe=()=>{ne("all"),ie("all"),oe("all"),ce("all"),de(""),xe(""),ee(""),m.get("/soporte/casos",{per_page:a.per_page,sort:a.sort,direction:a.direction,page:1},{preserveState:!1,preserveScroll:!1,replace:!0})},$e=()=>{const s=new URLSearchParams;s.append("sort",a.sort),s.append("direction",a.direction),a.search&&s.append("search",a.search),a.status&&a.status!=="all"&&s.append("status",a.status),a.priority&&a.priority!=="all"&&s.append("priority",a.priority),a.category&&a.category!=="all"&&s.append("category",a.category),a.assigned&&a.assigned!=="all"&&s.append("assigned",a.assigned),a.date_from&&s.append("date_from",a.date_from),a.date_to&&s.append("date_to",a.date_to),a.filter&&s.append("filter",a.filter),window.location.href=`/soporte/casos/export?${s}`},b=s=>a.sort!==s?e.jsx(as,{className:"h-3 w-3 ml-1 text-gray-400"}):a.direction==="asc"?e.jsx(Ze,{className:"h-3 w-3 ml-1 text-[#2c4370]"}):e.jsx(es,{className:"h-3 w-3 ml-1 text-[#2c4370]"}),ue=s=>{switch(s){case 1:return"bg-blue-100 text-blue-800";case 2:return"bg-yellow-100 text-yellow-800";case 3:return"bg-yellow-100 text-yellow-800";case 4:return"bg-orange-100 text-orange-800";case 5:return"bg-green-100 text-green-800";case 6:return"bg-gray-100 text-gray-800";default:return"bg-gray-100 text-gray-800"}};return e.jsxs(e.Fragment,{children:[e.jsx(Me,{title:"HelpDesk HUV - Casos"}),e.jsxs("div",{className:"min-h-screen flex flex-col bg-gray-50",children:[e.jsx(qe,{breadcrumb:e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(X,{href:"/dashboard",className:"text-gray-600 hover:text-[#2c4370] hover:underline",children:"Inicio"}),e.jsx("span",{className:"text-gray-400",children:"/"}),e.jsx(X,{href:"/soporte/casos",className:"text-gray-600 hover:text-[#2c4370] hover:underline",children:"Soporte"}),e.jsx("span",{className:"text-gray-400",children:"/"}),e.jsx("span",{className:"font-medium text-gray-900",children:"Casos"})]})}),e.jsxs("main",{className:"flex-1 px-3 sm:px-6 py-4 sm:py-6",children:[a.filter&&e.jsxs("div",{className:"mb-4 bg-[#2c4370] text-white px-3 sm:px-4 py-2 sm:py-3 flex flex-col sm:flex-row items-start sm:items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm sm:text-base",children:[e.jsx(je,{className:"w-4 h-4 shrink-0"}),e.jsx("span",{className:"font-medium",children:me()}),e.jsxs("span",{className:"text-white/70",children:["(",x.total,")"]})]}),e.jsxs("button",{onClick:Ee,className:"flex items-center gap-1 hover:bg-white/20 px-2 py-1 transition-colors text-sm",children:[e.jsx(be,{className:"w-4 h-4"}),e.jsx("span",{children:"Quitar"})]})]}),e.jsxs("div",{className:"bg-white shadow border border-gray-200",children:[e.jsx("div",{className:"px-3 sm:px-6 py-3 sm:py-4 border-b",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[e.jsx("h1",{className:"text-lg sm:text-xl font-semibold text-gray-900",children:a.filter?me():"Casos"}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center gap-2 sm:gap-3",children:[e.jsxs("div",{className:"relative flex-1 sm:flex-initial",children:[e.jsx(I,{type:"text",placeholder:"Buscar...",className:"w-full sm:w-64 pr-10 h-9",value:w,onChange:s=>ee(s.target.value),onKeyDown:s=>{s.key==="Enter"&&pe()}}),e.jsx(o,{size:"sm",variant:"ghost",className:"absolute right-0 top-0 h-full px-3",onClick:pe,children:e.jsx(Be,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(o,{variant:"outline",size:"sm",onClick:()=>Te(!re),className:`h-9 flex-1 sm:flex-initial ${U?"border-[#2c4370] text-[#2c4370]":""}`,children:[e.jsx(je,{className:"h-4 w-4 sm:mr-1"}),e.jsx("span",{className:"hidden sm:inline",children:"Filtros"}),U&&e.jsx("span",{className:"ml-1 bg-[#2c4370] text-white text-xs w-5 h-5 flex items-center justify-center",children:"!"})]}),e.jsxs(o,{size:"sm",className:"bg-[#2c4370] hover:bg-[#3d5583] text-white h-9 flex-1 sm:flex-initial",onClick:$e,children:[e.jsx("span",{className:"hidden sm:inline",children:"Exportar"}),e.jsx("span",{className:"sm:hidden",children:"Excel"})]}),e.jsx(X,{href:"/soporte/crear-caso",children:e.jsxs(o,{size:"sm",className:"bg-green-600 hover:bg-green-700 text-white h-9 flex-1 sm:flex-initial",children:[e.jsx(Ye,{className:"h-4 w-4 sm:mr-1"}),e.jsx("span",{className:"hidden sm:inline",children:"Crear Caso"})]})})]})]})]})}),re&&e.jsxs("div",{className:"px-3 sm:px-6 py-3 sm:py-4 bg-gray-50 border-b",children:[e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-6 gap-2 sm:gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600 mb-1 block",children:"Estado"}),e.jsxs(E,{value:h,onValueChange:ne,children:[e.jsx(k,{className:"h-8 text-xs",children:e.jsx(A,{placeholder:"Todos"})}),e.jsxs(L,{children:[e.jsx(l,{value:"all",children:"Todos"}),e.jsx(l,{value:"1",children:"Nuevo"}),e.jsx(l,{value:"2",children:"En curso (asignado)"}),e.jsx(l,{value:"3",children:"En curso (planificado)"}),e.jsx(l,{value:"4",children:"En espera"}),e.jsx(l,{value:"5",children:"Resuelto"}),e.jsx(l,{value:"6",children:"Cerrado"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600 mb-1 block",children:"Prioridad"}),e.jsxs(E,{value:g,onValueChange:ie,children:[e.jsx(k,{className:"h-8 text-xs",children:e.jsx(A,{placeholder:"Todas"})}),e.jsxs(L,{children:[e.jsx(l,{value:"all",children:"Todas"}),e.jsx(l,{value:"1",children:"Muy baja"}),e.jsx(l,{value:"2",children:"Baja"}),e.jsx(l,{value:"3",children:"Media"}),e.jsx(l,{value:"4",children:"Alta"}),e.jsx(l,{value:"5",children:"Muy alta"}),e.jsx(l,{value:"6",children:"Urgente"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600 mb-1 block",children:"Asignado a"}),e.jsxs(E,{value:u,onValueChange:ce,children:[e.jsx(k,{className:"h-8 text-xs",children:e.jsx(A,{placeholder:"Todos"})}),e.jsxs(L,{children:[e.jsx(l,{value:"all",children:"Todos"}),we.map(s=>e.jsx(l,{value:s.id.toString(),children:s.fullname},s.id))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600 mb-1 block",children:"Categoría"}),e.jsxs(E,{value:p,onValueChange:oe,children:[e.jsx(k,{className:"h-8 text-xs",children:e.jsx(A,{placeholder:"Todas"})}),e.jsxs(L,{children:[e.jsx(l,{value:"all",children:"Todas"}),fe.map(s=>e.jsx(l,{value:s.id.toString(),children:s.completename},s.id))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600 mb-1 block",children:"Desde"}),e.jsx(I,{type:"date",value:N,onChange:s=>de(s.target.value),className:"h-8 text-xs"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600 mb-1 block",children:"Hasta"}),e.jsx(I,{type:"date",value:f,onChange:s=>xe(s.target.value),className:"h-8 text-xs"})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-end gap-2 mt-3",children:[U&&e.jsxs(o,{variant:"ghost",size:"sm",onClick:Pe,className:"h-8 text-xs text-gray-600",children:[e.jsx(be,{className:"h-3 w-3 mr-1"}),"Limpiar"]}),e.jsx(o,{size:"sm",onClick:ze,className:"bg-[#2c4370] hover:bg-[#3d5583] text-white h-8 text-xs",children:"Aplicar"})]})]}),e.jsxs("div",{className:"px-3 sm:px-6 py-2 sm:py-3 bg-gray-50 border-b flex flex-col sm:flex-row items-start sm:items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[e.jsx("span",{className:"text-xs sm:text-sm text-gray-600",children:"Mostrar"}),e.jsxs(E,{value:a.per_page.toString(),onValueChange:Re,children:[e.jsx(k,{className:"w-16 sm:w-20 h-7 sm:h-8 text-xs sm:text-sm",children:e.jsx(A,{placeholder:"15"})}),e.jsxs(L,{children:[e.jsx(l,{value:"15",children:"15"}),e.jsx(l,{value:"20",children:"20"}),e.jsx(l,{value:"50",children:"50"}),e.jsx(l,{value:"100",children:"100"})]})]}),e.jsx("span",{className:"text-xs sm:text-sm text-gray-600 hidden sm:inline",children:"elementos"})]}),e.jsxs("p",{className:"text-xs sm:text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:x.data.length})," de"," ",e.jsx("span",{className:"font-medium",children:x.total})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Ke,{children:[e.jsx(Xe,{children:e.jsxs(Q,{className:"bg-gray-50",children:[e.jsx(d,{className:"font-semibold text-gray-900 text-xs cursor-pointer hover:bg-gray-100 w-16",onClick:()=>y("id"),children:e.jsxs("div",{className:"flex items-center",children:["ID",b("id")]})}),e.jsx(d,{className:"font-semibold text-gray-900 text-xs cursor-pointer hover:bg-gray-100",onClick:()=>y("name"),children:e.jsxs("div",{className:"flex items-center",children:["Título",b("name")]})}),e.jsx(d,{className:"font-semibold text-gray-900 text-xs cursor-pointer hover:bg-gray-100",onClick:()=>y("status"),children:e.jsxs("div",{className:"flex items-center",children:["Estado",b("status")]})}),e.jsx(d,{className:"font-semibold text-gray-900 text-xs cursor-pointer hover:bg-gray-100",onClick:()=>y("priority"),children:e.jsxs("div",{className:"flex items-center",children:["Prioridad",b("priority")]})}),e.jsx(d,{className:"font-semibold text-gray-900 text-xs cursor-pointer hover:bg-gray-100",onClick:()=>y("entity_name"),children:e.jsxs("div",{className:"flex items-center",children:["Entidad",b("entity_name")]})}),e.jsx(d,{className:"font-semibold text-gray-900 text-xs cursor-pointer hover:bg-gray-100",onClick:()=>y("date"),children:e.jsxs("div",{className:"flex items-center",children:["Fecha de apertura",b("date")]})}),e.jsx(d,{className:"font-semibold text-gray-900 text-xs cursor-pointer hover:bg-gray-100",onClick:()=>y("date_mod"),children:e.jsxs("div",{className:"flex items-center",children:["Última actualización",b("date_mod")]})}),e.jsx(d,{className:"font-semibold text-gray-900 text-xs",children:"Solicitante"}),e.jsx(d,{className:"font-semibold text-gray-900 text-xs",children:"Asignado a"}),e.jsx(d,{className:"font-semibold text-gray-900 text-xs",children:"Categoría"}),e.jsx(d,{className:"font-semibold text-gray-900 text-xs",children:"Elemento"}),H()&&e.jsx(d,{className:"font-semibold text-gray-900 text-xs text-center w-24",children:"Acciones"})]})}),e.jsxs(Qe,{children:[x.data.map(s=>e.jsxs(Q,{className:"hover:bg-gray-50",children:[e.jsx(c,{className:"text-xs font-medium",children:s.id}),e.jsx(c,{className:"font-medium text-xs",children:e.jsx("button",{onClick:async()=>{if(_e(s),ae(null),S(!0),s.status===5||s.status===6){te(!0);try{const t=await fetch(`/dashboard/ticket/${s.id}`);if(t.ok){const n=await t.json();n.solution&&ae(n.solution)}}catch(t){console.error("Error fetching solution:",t)}finally{te(!1)}}},className:"text-[#2c4370] hover:underline block truncate max-w-md text-left",title:s.name,children:s.name||"(Sin título)"})}),e.jsx(c,{className:"text-xs",children:e.jsx("span",{className:`px-2 py-1 text-[10px] font-semibold ${ue(s.status)}`,children:s.status_name})}),e.jsx(c,{className:"text-xs",children:s.priority_name}),e.jsx(c,{className:"text-xs",children:s.entity_name||"-"}),e.jsx(c,{className:"text-xs text-gray-600",children:s.date?new Date(s.date).toLocaleDateString("es-CO",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"-"}),e.jsx(c,{className:"text-xs text-gray-600",children:s.date_mod?new Date(s.date_mod).toLocaleDateString("es-CO",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"-"}),e.jsx(c,{className:"text-xs",children:s.requester_name||"-"}),e.jsx(c,{className:"text-xs",children:s.assigned_name||"-"}),e.jsx(c,{className:"text-xs",children:s.category_name||"-"}),e.jsx(c,{className:"text-xs text-gray-600",children:s.item_name||"-"}),H()&&e.jsx(c,{className:"text-xs",children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[he(s)&&s.status!==5&&s.status!==6&&e.jsx(o,{variant:"ghost",size:"sm",className:"h-7 w-7 p-0 text-green-600 hover:text-green-800 hover:bg-green-50",onClick:()=>ge(s),title:"Resolver",children:e.jsx(M,{className:"h-3.5 w-3.5"})}),e.jsx(o,{variant:"ghost",size:"sm",className:"h-7 w-7 p-0 text-blue-600 hover:text-blue-800 hover:bg-blue-50",onClick:()=>m.visit(`/soporte/casos/${s.id}/editar`),title:"Editar",children:e.jsx(Je,{className:"h-3.5 w-3.5"})}),ke(s)&&e.jsx(o,{variant:"ghost",size:"sm",className:"h-7 w-7 p-0 text-red-600 hover:text-red-800 hover:bg-red-50",onClick:()=>Le(s),title:"Eliminar",children:e.jsx(Ue,{className:"h-3.5 w-3.5"})})]})})]},s.id)),x.data.length===0&&e.jsx(Q,{children:e.jsx(c,{colSpan:H()?12:11,className:"text-center py-8 text-gray-500",children:"No se encontraron casos"})})]})]})}),e.jsxs("div",{className:"px-3 sm:px-6 py-3 sm:py-4 border-t flex flex-col sm:flex-row items-center justify-between gap-3",children:[e.jsxs("div",{className:"text-xs sm:text-sm text-gray-600 order-2 sm:order-1",children:["Página ",x.current_page," de ",x.last_page]}),e.jsx("div",{className:"flex items-center gap-1 sm:gap-2 order-1 sm:order-2 flex-wrap justify-center",children:x.links.map((s,t)=>{const n=t===0||t===x.links.length-1||s.active;return t===0?e.jsx(o,{variant:"outline",size:"sm",disabled:!s.url,className:"border-[#2c4370] text-[#2c4370] hover:!bg-[#2c4370] hover:!text-white disabled:opacity-50 h-8 w-8 p-0",onClick:()=>s.url&&G(s.url),children:e.jsx(We,{className:"h-4 w-4"})},t):t===x.links.length-1?e.jsx(o,{variant:"outline",size:"sm",disabled:!s.url,className:"border-[#2c4370] text-[#2c4370] hover:!bg-[#2c4370] hover:!text-white disabled:opacity-50 h-8 w-8 p-0",onClick:()=>s.url&&G(s.url),children:e.jsx(ss,{className:"h-4 w-4"})},t):e.jsx(o,{variant:s.active?"default":"outline",size:"sm",disabled:!s.url,className:`${n?"":"hidden sm:inline-flex"} h-8 min-w-[32px] px-2 text-xs sm:text-sm ${s.active?"bg-[#2c4370] hover:!bg-[#3d5583] text-white border-[#2c4370]":"border-[#2c4370] text-[#2c4370] hover:!bg-[#2c4370] hover:!text-white"}`,onClick:()=>s.url&&G(s.url),children:e.jsx("span",{dangerouslySetInnerHTML:{__html:s.label}})},t)})})]})]})]}),e.jsx(Ge,{})]}),e.jsx(Y,{open:Se,onOpenChange:O,children:e.jsxs(J,{className:"sm:max-w-[425px]",children:[e.jsxs(W,{children:[e.jsx(Z,{children:"Eliminar Caso"}),e.jsxs(ve,{children:["¿Está seguro que desea eliminar el caso ",e.jsxs("strong",{children:["#",R?.id]}),"?",e.jsx("br",{}),e.jsx("span",{className:"text-gray-600",children:R?.name})]})]}),e.jsxs(ye,{className:"gap-2",children:[e.jsx(o,{variant:"outline",onClick:()=>O(!1),children:"Cancelar"}),e.jsx(o,{variant:"destructive",onClick:Oe,className:"bg-red-600 hover:bg-red-700",children:"Eliminar"})]})]})}),e.jsx(Y,{open:Ce,onOpenChange:S,children:e.jsxs(J,{className:"sm:max-w-[600px] max-h-[90vh] overflow-y-auto",children:[e.jsx(W,{children:e.jsxs(Z,{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-[#2c4370]",children:["Caso #",r?.id]}),e.jsx("span",{className:`px-2 py-0.5 text-[10px] font-semibold ${r?ue(r.status):""}`,children:r?.status_name})]})}),r&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{children:e.jsx("h3",{className:"text-sm font-semibold text-gray-900",children:r.name})}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-xs",children:[e.jsxs("div",{className:"bg-gray-50 p-2",children:[e.jsx("span",{className:"text-gray-500 block",children:"Prioridad"}),e.jsx("span",{className:"font-medium",children:r.priority_name})]}),e.jsxs("div",{className:"bg-gray-50 p-2",children:[e.jsx("span",{className:"text-gray-500 block",children:"Entidad"}),e.jsx("span",{className:"font-medium",children:r.entity_name||"-"})]}),e.jsxs("div",{className:"bg-gray-50 p-2",children:[e.jsx("span",{className:"text-gray-500 block",children:"Fecha de Apertura"}),e.jsx("span",{className:"font-medium",children:r.date?new Date(r.date).toLocaleDateString("es-CO",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"-"})]}),e.jsxs("div",{className:"bg-gray-50 p-2",children:[e.jsx("span",{className:"text-gray-500 block",children:"Última Actualización"}),e.jsx("span",{className:"font-medium",children:r.date_mod?new Date(r.date_mod).toLocaleDateString("es-CO",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"-"})]}),e.jsxs("div",{className:"bg-gray-50 p-2",children:[e.jsx("span",{className:"text-gray-500 block",children:"Solicitante"}),e.jsx("span",{className:"font-medium",children:r.requester_name||"-"})]}),e.jsxs("div",{className:"bg-gray-50 p-2",children:[e.jsx("span",{className:"text-gray-500 block",children:"Asignado a"}),e.jsx("span",{className:"font-medium",children:r.assigned_name||"-"})]}),e.jsxs("div",{className:"bg-gray-50 p-2 col-span-2",children:[e.jsx("span",{className:"text-gray-500 block",children:"Categoría"}),e.jsx("span",{className:"font-medium",children:r.category_name||"-"})]})]}),(r.status===5||r.status===6)&&e.jsxs("div",{className:"pt-3 border-t",children:[e.jsx("span",{className:"text-xs font-semibold text-green-700 block mb-2",children:"Solución"}),De?e.jsxs("div",{className:"bg-green-50 p-3 border border-green-200 flex items-center justify-center",children:[e.jsx(Ne,{className:"h-4 w-4 animate-spin text-green-600"}),e.jsx("span",{className:"ml-2 text-xs text-green-600",children:"Cargando solución..."})]}):C?e.jsxs("div",{className:"bg-green-50 p-3 border border-green-200",children:[e.jsx("div",{className:"text-xs text-gray-700 whitespace-pre-wrap",dangerouslySetInnerHTML:{__html:C.content}}),e.jsxs("div",{className:"mt-2 pt-2 border-t border-green-200 flex items-center justify-between text-[10px] text-green-700",children:[e.jsxs("span",{children:["Resuelto por: ",e.jsx("strong",{children:C.solved_by||"Usuario del sistema"})]}),e.jsx("span",{children:C.date_creation?new Date(C.date_creation).toLocaleString("es-CO"):"-"})]})]}):e.jsx("div",{className:"bg-gray-50 p-3 border border-gray-200 text-xs text-gray-500",children:"No se encontró solución registrada"})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2 border-t",children:[e.jsx(o,{variant:"outline",size:"sm",onClick:()=>S(!1),className:"h-8 text-xs",children:"Cerrar"}),he(r)&&r.status!==5&&r.status!==6&&e.jsxs(o,{size:"sm",onClick:()=>{S(!1),ge(r)},className:"bg-green-600 hover:bg-green-700 text-white h-8 text-xs",children:[e.jsx(M,{className:"h-3.5 w-3.5 mr-1"}),"Resolver"]}),H()&&e.jsx(o,{size:"sm",onClick:()=>{S(!1),m.visit(`/soporte/casos/${r.id}/editar`)},className:"bg-[#2c4370] hover:bg-[#3d5583] text-white h-8 text-xs",children:"Editar Caso"})]})]})]})}),e.jsx(Y,{open:Fe,onOpenChange:z,children:e.jsxs(J,{className:"sm:max-w-[500px]",children:[e.jsxs(W,{children:[e.jsxs(Z,{className:"flex items-center gap-2",children:[e.jsx(M,{className:"h-5 w-5 text-green-600"}),"Resolver Caso"]}),e.jsxs(ve,{children:["Resolver el caso ",e.jsxs("strong",{children:["#",v?.id]}),": ",v?.name]})]}),le&&e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 text-sm rounded",children:le}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Descripción de la solución ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{value:_,onChange:s=>P(s.target.value),placeholder:"Describe cómo se resolvió el problema...",className:"w-full px-3 py-2 border focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500 min-h-[120px] text-sm",autoFocus:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Fecha y hora de solución"}),e.jsx(I,{type:"datetime-local",value:D,onChange:s=>$(s.target.value),className:"w-full"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Por defecto se usa la fecha y hora actual. Puede modificarla si la solución fue en otro momento."})]})]}),e.jsxs(ye,{className:"gap-2",children:[e.jsx(o,{variant:"outline",onClick:()=>{z(!1),q(null),P(""),$("")},disabled:B,children:"Cancelar"}),e.jsx(o,{onClick:Ae,disabled:!_.trim()||B,className:"bg-green-600 hover:bg-green-700 text-white",children:B?e.jsxs(e.Fragment,{children:[e.jsx(Ne,{className:"h-4 w-4 mr-1 animate-spin"}),"Resolviendo..."]}):e.jsxs(e.Fragment,{children:[e.jsx(M,{className:"h-4 w-4 mr-1"}),"Resolver"]})})]})]})})]})}export{Ss as default};
