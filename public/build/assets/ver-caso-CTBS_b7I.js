import{a as h,j as e,H as L,L as o,r as N}from"./app-Qi1XBDkg.js";import{G as P,a as T}from"./glpi-footer-D4gJ54XE.js";import{a as p,B as d}from"./button-BVaXXHP1.js";import{L as r}from"./label-CCK8gPLi.js";import{T as M}from"./textarea-Di8a5l7L.js";import{S as F}from"./square-pen-DOVmfJ0X.js";import{M as D}from"./monitor-BMk-qh-z.js";import{F as E}from"./file-text-JU4eq0cc.js";import{D as A}from"./download-Cd3_7t8b.js";/* empty css            */import"./input-Ker__V9Y.js";import"./index-B7L9lVdG.js";import"./index-kJMkupiB.js";import"./index-izPOfl6M.js";import"./index-DSOzwbqx.js";import"./refresh-cw-AD5Ig-Oi.js";import"./triangle-alert-BblC9sJq.js";import"./check-Bl-cESwx.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["circle",{cx:"10",cy:"12",r:"2",key:"737tya"}],["path",{d:"m20 17-1.296-1.296a2.41 2.41 0 0 0-3.408 0L9 22",key:"wt3hpn"}]],I=p("FileImage",H);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $=[["path",{d:"M13.234 20.252 21 12.3",key:"1cbrk9"}],["path",{d:"m16 6-8.414 8.586a2 2 0 0 0 0 2.828 2 2 0 0 0 2.828 0l8.414-8.586a4 4 0 0 0 0-5.656 4 4 0 0 0-5.656 0l-8.415 8.585a6 6 0 1 0 8.486 8.486",key:"1pkts6"}]],z=p("Paperclip",$);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q=[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z",key:"cbrjhi"}]],R=p("Wrench",q),V={1:"bg-blue-100 text-blue-700",2:"bg-yellow-100 text-yellow-700",3:"bg-purple-100 text-purple-700",4:"bg-orange-100 text-orange-700",5:"bg-green-100 text-green-700",6:"bg-gray-100 text-gray-600"},B={1:"bg-gray-100 text-gray-600",2:"bg-blue-100 text-blue-600",3:"bg-yellow-100 text-yellow-700",4:"bg-orange-100 text-orange-600",5:"bg-red-100 text-red-600",6:"bg-red-200 text-red-700"},G={Computer:"Computador",Monitor:"Monitor",NetworkEquipment:"Dispositivo de Red",Peripheral:"Periférico",Printer:"Impresora",Phone:"Teléfono",Enclosure:"Gabinete"};function ce({ticket:s,requester:b,technician:y,ticketItems:g,attachments:i}){const[c,f]=h.useState(!1),[n,v]=h.useState(""),[j,u]=h.useState(!1),w=a=>{const t=document.createElement("div");return t.innerHTML=a,t.textContent||t.innerText||""},x=a=>a?new Date(a).toLocaleDateString("es-CO",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}):"-",_=async()=>{if(!n.trim()||n.length<10){alert("La solución debe tener al menos 10 caracteres");return}u(!0);try{const a=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content"),t=await fetch(`/soporte/casos/${s.id}/solucion`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":a||"","X-Requested-With":"XMLHttpRequest"},credentials:"include",body:JSON.stringify({solution:n})});if(t.status===419){alert("Tu sesión ha expirado. La página se recargará."),window.location.reload();return}if(t.ok||t.redirected)N.visit("/dashboard",{preserveState:!1,replace:!0});else{const m=await t.json().catch(()=>({}));alert(m.message||"Error al cerrar el caso. Intenta de nuevo.")}}catch{alert("Error de conexión. Verifica tu internet e intenta de nuevo.")}finally{u(!1)}},C=s.status!==5&&s.status!==6;return e.jsxs(e.Fragment,{children:[e.jsx(L,{title:`Caso #${s.id} - HelpDesk HUV`}),e.jsxs("div",{className:"min-h-screen flex flex-col bg-gray-50",children:[e.jsx(P,{breadcrumb:e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(o,{href:"/dashboard",className:"text-gray-600 hover:text-[#2c4370] hover:underline",children:"Inicio"}),e.jsx("span",{className:"text-gray-400",children:"/"}),e.jsx(o,{href:"/soporte/casos",className:"text-gray-600 hover:text-[#2c4370] hover:underline",children:"Soporte"}),e.jsx("span",{className:"text-gray-400",children:"/"}),e.jsx(o,{href:"/soporte/casos",className:"text-gray-600 hover:text-[#2c4370] hover:underline",children:"Casos"}),e.jsx("span",{className:"text-gray-400",children:"/"}),e.jsxs("span",{className:"font-medium text-gray-900",children:["Ver #",s.id]})]})}),e.jsx("main",{className:"flex-1 px-6 py-6",children:e.jsx("div",{className:"max-w-5xl mx-auto",children:e.jsxs("div",{className:"bg-white rounded-lg shadow",children:[e.jsxs("div",{className:"px-6 py-4 border-b flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("h1",{className:"text-xl font-semibold text-gray-900",children:["Caso #",s.id]}),e.jsx("span",{className:`text-xs font-medium px-2 py-1 rounded ${V[s.status]}`,children:s.status_name}),e.jsx("span",{className:`text-xs font-medium px-2 py-1 rounded ${B[s.priority]}`,children:s.priority_name})]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:s.name})]}),e.jsxs("div",{className:"flex gap-2",children:[C&&e.jsxs(d,{size:"sm",onClick:()=>f(!c),className:`h-8 text-xs ${c?"bg-gray-500 hover:bg-gray-600":"bg-green-600 hover:bg-green-700"}`,children:[e.jsx(R,{className:"w-3.5 h-3.5 mr-1"}),c?"Cancelar":"Procesar caso"]}),e.jsx(o,{href:`/soporte/casos/${s.id}/editar`,children:e.jsxs(d,{size:"sm",className:"bg-[#2c4370] hover:bg-[#3d5583] h-8 text-xs",children:[e.jsx(F,{className:"w-3.5 h-3.5 mr-1"}),"Editar"]})})]})]}),e.jsxs("div",{className:"p-4",children:[c&&e.jsxs("div",{className:"mb-4 p-4 bg-green-50 border border-green-200 rounded-lg",children:[e.jsx(r,{className:"text-xs font-semibold text-green-800",children:"Solución *"}),e.jsx(M,{value:n,onChange:a=>v(a.target.value),placeholder:"Describe cómo se solucionó el problema (mínimo 10 caracteres)...",rows:3,className:"mt-1 text-sm bg-white"}),e.jsxs("div",{className:"mt-2 flex items-center justify-between",children:[e.jsx("p",{className:"text-xs text-green-700",children:"Al agregar la solución, el caso se cerrará automáticamente."}),e.jsx(d,{size:"sm",onClick:_,disabled:j||n.length<10,className:"bg-green-600 hover:bg-green-700 h-8 text-xs",children:j?"Cerrando...":"Cerrar Caso"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"md:col-span-2 space-y-3",children:[e.jsxs("div",{children:[e.jsx(r,{className:"text-xs text-gray-500",children:"Solicitante"}),e.jsx("p",{className:"text-sm font-medium",children:b?.fullname||"Reporte Público"})]}),e.jsxs("div",{children:[e.jsx(r,{className:"text-xs text-gray-500",children:"Técnico Asignado"}),e.jsx("p",{className:"text-sm font-medium",children:y?.fullname||e.jsx("span",{className:"text-orange-500",children:"Sin asignar"})})]}),s.category_name&&e.jsxs("div",{children:[e.jsx(r,{className:"text-xs text-gray-500",children:"Categoría"}),e.jsx("p",{className:"text-sm",children:s.category_name})]}),s.location_name&&e.jsxs("div",{children:[e.jsx(r,{className:"text-xs text-gray-500",children:"Ubicación"}),e.jsx("p",{className:"text-sm",children:s.location_name})]})]}),e.jsxs("div",{className:"md:col-span-2 space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(r,{className:"text-xs text-gray-500",children:"Fecha Apertura"}),e.jsx("p",{className:"text-sm",children:x(s.date)})]}),e.jsxs("div",{children:[e.jsx(r,{className:"text-xs text-gray-500",children:"Última Modificación"}),e.jsx("p",{className:"text-sm",children:x(s.date_mod)})]}),e.jsxs("div",{children:[e.jsx(r,{className:"text-xs text-gray-500",children:"Urgencia"}),e.jsx("p",{className:"text-sm",children:s.urgency_name})]}),e.jsxs("div",{children:[e.jsx(r,{className:"text-xs text-gray-500",children:"Impacto"}),e.jsx("p",{className:"text-sm",children:s.impact_name})]})]}),s.time_to_resolve&&e.jsxs("div",{children:[e.jsx(r,{className:"text-xs text-gray-500",children:"Fecha Límite"}),e.jsx("p",{className:"text-sm",children:x(s.time_to_resolve)})]})]}),e.jsxs("div",{className:"md:col-span-4",children:[e.jsx(r,{className:"text-xs text-gray-500",children:"Descripción del Problema"}),e.jsx("div",{className:"mt-1 p-3 bg-gray-50 rounded border text-sm whitespace-pre-wrap",children:w(s.content)})]}),g.length>0&&e.jsxs("div",{className:"md:col-span-4",children:[e.jsx(r,{className:"text-xs text-gray-500",children:"Elementos Asociados"}),e.jsx("div",{className:"mt-1 flex flex-wrap gap-2",children:g.map((a,t)=>e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-blue-50 border border-blue-200 rounded text-sm",children:[e.jsx(D,{className:"w-3.5 h-3.5 text-blue-600"}),e.jsx("span",{children:a.name}),e.jsxs("span",{className:"text-xs text-blue-600",children:["(",G[a.itemtype]||a.itemtype,")"]})]},t))})]}),i&&i.length>0&&e.jsxs("div",{className:"md:col-span-4",children:[e.jsxs(r,{className:"text-xs text-gray-500 flex items-center gap-1",children:[e.jsx(z,{className:"w-3 h-3"}),"Archivos Adjuntos (",i.length,")"]}),e.jsx("div",{className:"mt-2 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2",children:i.map((a,t)=>{const m=/\.(jpg|jpeg|png|gif|webp|bmp)$/i.test(a.name),S=l=>l<1024?l+" B":l<1024*1024?(l/1024).toFixed(1)+" KB":(l/(1024*1024)).toFixed(1)+" MB";return e.jsxs("a",{href:a.url,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-3 p-2 bg-gray-50 hover:bg-gray-100 border rounded transition-colors",children:[m?e.jsx(I,{className:"w-5 h-5 text-green-600 flex-shrink-0"}):e.jsx(E,{className:"w-5 h-5 text-blue-600 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium truncate",children:a.name}),e.jsx("p",{className:"text-xs text-gray-500",children:S(a.size)})]}),e.jsx(A,{className:"w-4 h-4 text-gray-400"})]},t)})})]})]}),e.jsx("div",{className:"mt-4 flex items-center justify-end gap-2 pt-3 border-t",children:e.jsx(d,{variant:"ghost",size:"sm",onClick:()=>N.visit("/dashboard"),className:"h-8 text-xs",children:"Volver al Dashboard"})})]})]})})}),e.jsx(T,{})]})]})}export{ce as default};
