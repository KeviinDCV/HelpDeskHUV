import{u as Z,R as c,f as ee,j as e,H as se,L,r as z}from"./app-UQ1QY_D_.js";import{G as ae,a as te}from"./glpi-footer-DKoEu3Bi.js";import{B as F}from"./button-CIkAoHeE.js";import{I as f}from"./input-B-oNOrXs.js";import{L as i}from"./label-Br5QRQwN.js";import{T as le}from"./textarea-C6G_sBJy.js";import{S as p,a as u,b as j,c as g,d as r}from"./select-73k2kEr2.js";import{e as re,d as ie,b as ne,D as oe,a as ce,c as de}from"./dialog-ZNJ7wiLB.js";import{S as D,U as me}from"./searchable-select-CylPwCCU.js";import{X as N}from"./x-BSGLFk_J.js";import{C as xe}from"./file-text-DLEHSKEM.js";/* empty css            */import"./index-BU6TyM6S.js";import"./index-zAl5CuM7.js";import"./index-B-wMIL5j.js";import"./monitor-D0CNp6wM.js";import"./index-BIrONb-Z.js";import"./loader-circle-Cj7Q8pT0.js";import"./check-BaV38CgM.js";import"./sun-DybtkZ-g.js";function Ee({users:v,locations:O,categories:P,itemTypes:B,auth:he}){const{flash:b}=Z().props,[y,C]=c.useState([]),[d,T]=c.useState([]),[m,M]=c.useState([]),[x,k]=c.useState(""),[A,_]=c.useState([]),[h,S]=c.useState([]),[H,E]=c.useState(!1),[$,w]=c.useState(!1);c.useEffect(()=>{b.success&&w(!0)},[b.success]);const G=()=>{const s=new Date,a=s.getTimezoneOffset();return new Date(s.getTime()-a*6e4).toISOString().slice(0,16)},{data:o,setData:n,post:pe,processing:V,errors:q,reset:R}=ee({name:"",content:"",date:G(),time_to_resolve:"",internal_time_to_resolve:"",status:"1",priority:"3",locations_id:"",itilcategories_id:"",requester_id:"",observer_ids:[],assigned_ids:[]}),U=s=>{if(s.target.files){const a=Array.from(s.target.files);C(t=>[...t,...a])}},K=s=>{C(a=>a.filter((t,l)=>l!==s))},X=async s=>{if(k(s),_([]),s){E(!0);try{const t=await(await fetch(`/soporte/items/${s}`,{credentials:"same-origin",headers:{Accept:"application/json"}})).json();_(t)}catch(a){console.error("Error loading items:",a)}finally{E(!1)}}},J=s=>{const a=A.find(l=>l.id===parseInt(s)),t=B.find(l=>l.value===x)?.label||x;a&&!h.some(l=>l.type===x&&l.id===a.id)&&S([...h,{type:x,id:a.id,name:`${t}: ${a.name}`}])},Q=(s,a)=>{S(h.filter(t=>!(t.type===s&&t.id===a)))},W=s=>{s.preventDefault();const a={...o,observer_ids:d,assigned_ids:m,items:h.map(t=>({type:t.type,id:t.id})),attachments:y};z.post("/soporte/casos",a,{forceFormData:!0,onSuccess:()=>{R("name","content"),C([]),S([]),k(""),_([])}})},Y=s=>{if(s===0)return"0 Bytes";const a=1024,t=["Bytes","KB","MB","GB"],l=Math.floor(Math.log(s)/Math.log(a));return Math.round(s/Math.pow(a,l)*100)/100+" "+t[l]};return e.jsxs(e.Fragment,{children:[e.jsx(se,{title:"Crear Caso - HelpDesk HUV"}),e.jsxs("div",{className:"min-h-screen flex flex-col bg-gray-50",children:[e.jsx(ae,{breadcrumb:e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(L,{href:"/dashboard",className:"text-gray-600 hover:text-[#2c4370] hover:underline",children:"Inicio"}),e.jsx("span",{className:"text-gray-400",children:"/"}),e.jsx(L,{href:"/soporte/casos",className:"text-gray-600 hover:text-[#2c4370] hover:underline",children:"Soporte"}),e.jsx("span",{className:"text-gray-400",children:"/"}),e.jsx("span",{className:"font-medium text-gray-900",children:"Crear Caso"})]})}),e.jsx("main",{className:"flex-1 px-6 py-6",children:e.jsx("div",{className:"max-w-5xl mx-auto",children:e.jsxs("div",{className:"bg-white shadow border border-gray-200",children:[e.jsxs("div",{className:"px-6 py-4 border-b",children:[e.jsx("h1",{className:"text-xl font-semibold text-gray-900",children:"Crear Nuevo Caso"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Complete el formulario para registrar un nuevo caso en el sistema"})]}),e.jsxs("form",{onSubmit:W,className:"p-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"md:col-span-4",children:[e.jsx(i,{htmlFor:"name",className:"text-xs",children:"Título *"}),e.jsx(f,{id:"name",name:"name",autoComplete:"off",value:o.name,onChange:s=>n("name",s.target.value),placeholder:"Título del caso",required:!0,className:"mt-1 h-8 text-sm"}),q.name&&e.jsx("p",{className:"text-red-600 text-xs mt-0.5",children:q.name})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"date",className:"text-xs",children:"Fecha Apertura *"}),e.jsx(f,{id:"date",name:"date",autoComplete:"off",type:"datetime-local",value:o.date,onChange:s=>n("date",s.target.value),required:!0,className:"mt-1 h-8 text-xs"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"status",className:"text-xs",children:"Estado *"}),e.jsxs(p,{value:o.status,onValueChange:s=>n("status",s),name:"status",children:[e.jsx(u,{id:"status",className:"mt-1 h-8 text-xs",children:e.jsx(j,{})}),e.jsxs(g,{children:[e.jsx(r,{value:"1",children:"Nuevo"}),e.jsx(r,{value:"2",children:"En curso (asignado)"}),e.jsx(r,{value:"3",children:"En curso (planificado)"}),e.jsx(r,{value:"4",children:"En espera"}),e.jsx(r,{value:"5",children:"Resuelto"}),e.jsx(r,{value:"6",children:"Cerrado"})]})]})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"priority",className:"text-xs",children:"Prioridad *"}),e.jsxs(p,{value:o.priority,onValueChange:s=>n("priority",s),name:"priority",children:[e.jsx(u,{id:"priority",className:"mt-1 h-8 text-xs",children:e.jsx(j,{})}),e.jsxs(g,{children:[e.jsx(r,{value:"1",children:"Muy baja"}),e.jsx(r,{value:"2",children:"Baja"}),e.jsx(r,{value:"3",children:"Media"}),e.jsx(r,{value:"4",children:"Alta"}),e.jsx(r,{value:"5",children:"Muy alta"}),e.jsx(r,{value:"6",children:"Urgente"})]})]})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"locations_id",className:"text-xs",children:"Localización"}),e.jsx(D,{options:O.map(s=>({value:s.id.toString(),label:s.short_name})),value:o.locations_id,onValueChange:s=>n("locations_id",s),placeholder:"Seleccione...",searchPlaceholder:"Buscar ubicación...",className:"mt-1"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(i,{htmlFor:"itilcategories_id",className:"text-xs",children:"Categoría *"}),e.jsx(D,{options:P.map(s=>({value:s.id.toString(),label:s.completename})),value:o.itilcategories_id,onValueChange:s=>n("itilcategories_id",s),placeholder:"Seleccione categoría...",searchPlaceholder:"Buscar categoría...",className:"mt-1"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(i,{htmlFor:"requester_id",className:"text-xs",children:"Solicitante"}),e.jsxs(p,{value:o.requester_id,onValueChange:s=>n("requester_id",s),name:"requester_id",children:[e.jsx(u,{id:"requester_id",className:"mt-1 h-8 text-xs",children:e.jsx(j,{placeholder:"Buscar solicitante..."})}),e.jsx(g,{children:v.map(s=>e.jsx(r,{value:s.id.toString(),children:s.name},s.id))})]})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"observer",className:"text-xs",children:"Observador"}),e.jsxs(p,{onValueChange:s=>{const a=parseInt(s);d.includes(a)||(T([...d,a]),n("observer_ids",[...d,a]))},name:"observer",children:[e.jsx(u,{id:"observer",className:"mt-1 h-8 text-xs",children:e.jsx(j,{placeholder:"Agregar..."})}),e.jsx(g,{children:v.filter(s=>!d.includes(s.id)).map(s=>e.jsx(r,{value:s.id.toString(),children:s.name},s.id))})]}),d.length>0&&e.jsx("div",{className:"mt-1 flex flex-wrap gap-1",children:d.map(s=>{const a=v.find(t=>t.id===s);return a?e.jsxs("span",{className:"inline-flex items-center gap-1 px-1.5 py-0.5 bg-blue-50 text-blue-700 text-[10px] border border-blue-100",children:[a.name,e.jsx("button",{type:"button",onClick:t=>{t.preventDefault();const l=d.filter(I=>I!==s);T(l),n("observer_ids",l)},className:"hover:text-blue-900",children:e.jsx(N,{className:"h-2.5 w-2.5"})})]},s):null})})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"assigned",className:"text-xs",children:"Asignado a *"}),e.jsxs(p,{onValueChange:s=>{const a=parseInt(s);m.includes(a)||(M([...m,a]),n("assigned_ids",[...m,a]))},name:"assigned",children:[e.jsx(u,{id:"assigned",className:"mt-1 h-8 text-xs",children:e.jsx(j,{placeholder:"Asignar..."})}),e.jsx(g,{children:v.filter(s=>!m.includes(s.id)).map(s=>e.jsx(r,{value:s.id.toString(),children:s.name},s.id))})]}),m.length>0&&e.jsx("div",{className:"mt-1 flex flex-wrap gap-1",children:m.map(s=>{const a=v.find(t=>t.id===s);return a?e.jsxs("span",{className:"inline-flex items-center gap-1 px-1.5 py-0.5 bg-green-50 text-green-700 text-[10px] border border-green-100",children:[a.name,e.jsx("button",{type:"button",onClick:t=>{t.preventDefault();const l=m.filter(I=>I!==s);M(l),n("assigned_ids",l)},className:"hover:text-green-900",children:e.jsx(N,{className:"h-2.5 w-2.5"})})]},s):null})})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(i,{htmlFor:"item_type",className:"text-xs",children:"Elementos Asociados"}),e.jsxs(p,{value:x,onValueChange:X,name:"item_type",children:[e.jsx(u,{id:"item_type",className:"mt-1 h-8 text-xs",children:e.jsx(j,{placeholder:"Tipo de elemento..."})}),e.jsx(g,{children:B.map(s=>e.jsx(r,{value:s.value,children:s.label},s.value))})]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(i,{htmlFor:"item_id",className:"text-xs text-gray-500",children:"Seleccionar elemento"}),e.jsx(D,{options:A.map(s=>({value:s.id.toString(),label:s.name})),onValueChange:J,placeholder:"Buscar elemento...",searchPlaceholder:"Escriba para buscar...",disabled:!x,loading:H,className:"mt-1"})]}),h.length>0&&e.jsx("div",{className:"md:col-span-4 flex flex-wrap gap-1",children:h.map((s,a)=>e.jsxs("span",{className:"inline-flex items-center gap-1 px-1.5 py-0.5 bg-purple-50 text-purple-700 text-[10px] border border-purple-100",children:[s.name,e.jsx("button",{type:"button",onClick:t=>{t.preventDefault(),Q(s.type,s.id)},className:"hover:text-purple-900",children:e.jsx(N,{className:"h-2.5 w-2.5"})})]},`${s.type}-${s.id}-${a}`))}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(i,{htmlFor:"time_to_resolve",className:"text-xs text-gray-500",children:"Tiempo Solución (Opcional)"}),e.jsx(f,{id:"time_to_resolve",name:"time_to_resolve",autoComplete:"off",type:"datetime-local",value:o.time_to_resolve,onChange:s=>n("time_to_resolve",s.target.value),className:"mt-1 h-8 text-xs"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(i,{htmlFor:"internal_time_to_resolve",className:"text-xs text-gray-500",children:"Tiempo Interno (Opcional)"}),e.jsx(f,{id:"internal_time_to_resolve",name:"internal_time_to_resolve",autoComplete:"off",type:"datetime-local",value:o.internal_time_to_resolve,onChange:s=>n("internal_time_to_resolve",s.target.value),className:"mt-1 h-8 text-xs"})]}),e.jsxs("div",{className:"md:col-span-3",children:[e.jsx(i,{htmlFor:"content",className:"text-xs",children:"Descripción *"}),e.jsx(le,{id:"content",name:"content",autoComplete:"off",value:o.content,onChange:s=>n("content",s.target.value),placeholder:"Detalle el caso...",required:!0,rows:4,className:"mt-1 text-sm resize-none"})]}),e.jsxs("div",{className:"md:col-span-1 flex flex-col",children:[e.jsx(i,{className:"text-xs mb-1",children:"Adjuntos"}),e.jsxs("div",{className:"flex-1 border-2 border-dashed border-gray-200 flex flex-col items-center justify-center p-2 hover:border-gray-400 transition-colors bg-gray-50/50",children:[e.jsx(me,{className:"h-6 w-6 text-gray-400 mb-1"}),e.jsxs("label",{htmlFor:"file-upload",className:"cursor-pointer text-center",children:[e.jsx("span",{className:"text-xs font-medium text-[#2c4370] hover:underline block",children:"Subir archivos"}),e.jsx("span",{className:"text-[10px] text-gray-400 block leading-tight",children:"Máx 100MB"}),e.jsx("input",{id:"file-upload",type:"file",multiple:!0,onChange:U,className:"sr-only"})]})]})]}),y.length>0&&e.jsx("div",{className:"md:col-span-4 flex flex-wrap gap-2",children:y.map((s,a)=>e.jsxs("div",{className:"flex items-center gap-2 bg-gray-100 px-2 py-1 border border-gray-200",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[10px] font-medium text-gray-700 truncate max-w-[150px]",children:s.name}),e.jsx("span",{className:"text-[9px] text-gray-500",children:Y(s.size)})]}),e.jsx("button",{type:"button",onClick:()=>K(a),className:"text-gray-400 hover:text-red-600",children:e.jsx(N,{className:"h-3 w-3"})})]},a))})]}),e.jsxs("div",{className:"mt-4 flex items-center justify-end gap-2 pt-2 border-t",children:[e.jsx(F,{type:"button",variant:"ghost",size:"sm",onClick:()=>z.visit("/soporte/casos"),className:"h-8 text-xs",children:"Cancelar"}),e.jsx(F,{type:"submit",disabled:V,size:"sm",className:"bg-[#2c4370] hover:bg-[#3d5583] text-white h-8 text-xs px-6",children:V?"Creando...":"Crear Caso"})]})]})]})})}),e.jsx(te,{}),e.jsx(re,{open:$,onOpenChange:w,children:e.jsxs(ie,{className:"sm:max-w-md",children:[e.jsxs(ne,{children:[e.jsxs(oe,{className:"flex items-center gap-2 text-green-600",children:[e.jsx(xe,{className:"h-6 w-6"}),"Caso Creado Exitosamente"]}),e.jsx(ce,{children:b.success||"El caso ha sido registrado correctamente."})]}),e.jsx("div",{className:"flex justify-center py-4 bg-gray-50 rounded-md border border-gray-100",children:e.jsx("p",{className:"text-sm text-gray-600 text-center px-4",children:"El formulario se ha limpiado parcialmente para que pueda registrar otro caso inmediatamente."})}),e.jsx(de,{className:"sm:justify-center",children:e.jsx(F,{onClick:()=>w(!1),className:"bg-[#2c4370] text-white hover:bg-[#1e2e4f] min-w-[100px]",children:"Aceptar"})})]})})]})]})}export{Ee as default};
