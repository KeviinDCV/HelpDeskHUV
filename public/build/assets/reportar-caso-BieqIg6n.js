import{a as r,j as e,u as z,H,r as R}from"./app-DJ846M1s.js";import{c as I,B as U}from"./button-DBuPdzRJ.js";import{I as C}from"./input-xyDL7NG3.js";import{L as m}from"./label-Oqa-ytWf.js";import{S as P,T as O}from"./searchable-select-DQjAvEac.js";import{S as D,a as B,b as V,c as A,d as N}from"./select-CRgn4Gsf.js";import{X as L}from"./x-BoPtZvy-.js";import{U as Q}from"./user-C_RuK19O.js";import{C as K}from"./circle-alert-8uIQ5K5U.js";import{M as G}from"./monitor-c7gC9iVl.js";/* empty css            */import"./index-BHhal7pV.js";import"./search-wjibDq7R.js";import"./check-NOQm1TA0.js";import"./index-DhGdLctL.js";import"./index-CVyY9cMl.js";import"./index-s5zazqYR.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=[["path",{d:"M12 8V4H8",key:"hb8ula"}],["rect",{width:"16",height:"12",x:"4",y:"8",rx:"2",key:"enze0r"}],["path",{d:"M2 14h2",key:"vft8re"}],["path",{d:"M20 14h2",key:"4cs60a"}],["path",{d:"M15 13v2",key:"1xurst"}],["path",{d:"M9 13v2",key:"rq6x2g"}]],X=I("Bot",J);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],$=I("CircleCheckBig",Z);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W=[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]],Y=I("MessageCircle",W);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],se=I("Send",ee);function te({onFillField:M,formData:T}){const[d,q]=r.useState(!1),[j,f]=r.useState([{role:"assistant",content:"Â¡Hola! ğŸ‘‹ Soy Evarisbot y estoy aquÃ­ para ayudarte a reportar tu problema. Para comenzar, Â¿me podrÃ­as decir tu nombre completo?"}]),[p,l]=r.useState(""),[b,x]=r.useState(!1),[E,w]=r.useState(!0),[u,g]=r.useState([]),y=r.useRef(null),k=()=>{y.current?.scrollIntoView({behavior:"smooth"})};r.useEffect(()=>{k()},[j]),r.useEffect(()=>{const t=setTimeout(()=>w(!1),5e3);return()=>clearTimeout(t)},[]);const S=async()=>{if(!p.trim()||b)return;const t=p.trim();l(""),f(a=>[...a,{role:"user",content:t}]),x(!0);try{const a=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content"),v=await(await fetch("/chatbot",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":a||""},credentials:"include",body:JSON.stringify({message:t,context:j.slice(-8).map(c=>({role:c.role,content:c.content})),currentFormData:T,filledFields:u})})).json();if(v.success){if(v.fields&&typeof v.fields=="object"){const c=[...u];Object.entries(v.fields).forEach(([_,s])=>{s&&typeof s=="string"&&s.trim()&&(M(_,s),c.includes(_)||c.push(_))}),g(c)}f(c=>[...c,{role:"assistant",content:v.message}])}else f(c=>[...c,{role:"assistant",content:"Lo siento, tuve un problema. Â¿Puedes intentar de nuevo?"}])}catch{f(F=>[...F,{role:"assistant",content:"Error de conexiÃ³n. Verifica tu internet e intenta de nuevo."}])}finally{x(!1)}},i=t=>{t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),S())};return e.jsxs(e.Fragment,{children:[E&&!d&&e.jsx("div",{className:"fixed bottom-24 right-6 z-40 animate-bounce",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg px-4 py-2 text-sm text-gray-700 max-w-[200px]",children:[e.jsx("div",{className:"absolute -bottom-2 right-6 w-0 h-0 border-l-8 border-r-8 border-t-8 border-l-transparent border-r-transparent border-t-white"}),"Â¿Necesitas ayuda? Â¡PregÃºntame! ğŸ¤–"]})}),e.jsx("button",{onClick:()=>{q(!d),w(!1)},className:`fixed bottom-6 right-6 z-50 w-14 h-14 rounded-full shadow-lg flex items-center justify-center transition-all duration-300 hover:scale-110 ${d?"bg-gray-600 hover:bg-gray-700":"bg-[#2c4370] hover:bg-[#3d5583]"}`,children:d?e.jsx(L,{className:"w-6 h-6 text-white"}):e.jsx(Y,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{className:`fixed bottom-24 right-6 z-40 w-80 sm:w-96 bg-white rounded-2xl shadow-2xl overflow-hidden transition-all duration-300 origin-bottom-right ${d?"opacity-100 scale-100 translate-y-0":"opacity-0 scale-75 translate-y-4 pointer-events-none"}`,children:[e.jsxs("div",{className:"bg-gradient-to-r from-[#2c4370] to-[#3d5583] px-4 py-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-white/20 rounded-full flex items-center justify-center",children:e.jsx(X,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-white font-semibold text-sm",children:"Evarisbot"}),e.jsx("p",{className:"text-white/70 text-xs",children:"Te ayudo a crear tu reporte"})]})]}),u.length>0&&e.jsxs("div",{className:"mt-2 flex items-center gap-1 text-xs text-white/80",children:[e.jsx($,{className:"w-3 h-3"}),e.jsxs("span",{children:[u.length," campo(s) completado(s)"]})]})]}),e.jsxs("div",{className:"h-80 overflow-y-auto p-4 space-y-3 bg-gray-50",children:[j.map((t,a)=>e.jsx("div",{className:`flex ${t.role==="user"?"justify-end":"justify-start"}`,children:e.jsx("div",{className:`max-w-[80%] px-3 py-2 rounded-2xl text-sm ${t.role==="user"?"bg-[#2c4370] text-white rounded-br-md":"bg-white text-gray-700 shadow-sm rounded-bl-md"}`,children:t.content})},a)),b&&e.jsx("div",{className:"flex justify-start",children:e.jsx("div",{className:"bg-white text-gray-500 px-4 py-2 rounded-2xl rounded-bl-md shadow-sm text-sm",children:e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0ms"}}),e.jsx("span",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"150ms"}}),e.jsx("span",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"300ms"}})]})})}),e.jsx("div",{ref:y})]}),e.jsx("div",{className:"p-3 bg-white border-t",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",value:p,onChange:t=>l(t.target.value),onKeyPress:i,placeholder:"Escribe tu mensaje...",className:"flex-1 px-3 py-2 text-sm border rounded-full focus:outline-none focus:ring-2 focus:ring-[#2c4370]/50",disabled:b}),e.jsx("button",{onClick:S,disabled:!p.trim()||b,className:"w-9 h-9 bg-[#2c4370] text-white rounded-full flex items-center justify-center hover:bg-[#3d5583] disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:e.jsx(se,{className:"w-4 h-4"})})]})})]})]})}function ve({locations:M,categories:T,itemTypes:d}){const{props:q}=z(),j=q.flash,[f,p]=r.useState(!1),[l,b]=r.useState({}),[x,E]=r.useState(""),[w,u]=r.useState([]),[g,y]=r.useState([]),[k,S]=r.useState(!1),[i,t]=r.useState({reporter_name:"",reporter_position:"",reporter_service:"",reporter_extension:"",reporter_email:"",name:"",content:"",priority:"3",locations_id:"",itilcategories_id:""}),a=(s,n)=>{t(o=>({...o,[s]:n})),l[s]&&b(o=>{const h={...o};return delete h[s],h})},F=async s=>{if(E(s),u([]),s){S(!0);try{const o=await(await fetch(`/soporte/items/${s}`,{credentials:"same-origin",headers:{Accept:"application/json"}})).json();u(o)}catch(n){console.error("Error loading items:",n)}finally{S(!1)}}},v=s=>{const n=w.find(h=>h.id===parseInt(s)),o=d?.find(h=>h.value===x)?.label||x;n&&!g.some(h=>h.type===x&&h.id===n.id)&&y([...g,{type:x,id:n.id,name:`${o}: ${n.name}`}])},c=(s,n)=>{y(g.filter(o=>!(o.type===s&&o.id===n)))},_=s=>{s.preventDefault(),p(!0);const n={...i,items:g.map(o=>({type:o.type,id:o.id}))};R.post("/reportar",n,{onSuccess:()=>{t({reporter_name:"",reporter_position:"",reporter_service:"",reporter_extension:"",reporter_email:"",name:"",content:"",priority:"3",locations_id:"",itilcategories_id:""}),y([]),E(""),u([]),p(!1)},onError:o=>{b(o),p(!1)}})};return e.jsxs(e.Fragment,{children:[e.jsx(H,{title:"Reportar Problema - HelpDesk HUV"}),e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-[#2c4370] to-[#1a2a4a] flex items-center justify-center p-4",children:[e.jsxs("div",{className:"w-full max-w-4xl",children:[j?.success&&e.jsxs("div",{className:"mb-6 bg-green-50 border border-green-200 rounded-lg p-4 flex items-start gap-3",children:[e.jsx($,{className:"w-5 h-5 text-green-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-green-800",children:j.success.message}),e.jsxs("p",{className:"text-green-700 text-sm mt-1",children:["Su nÃºmero de caso es: ",e.jsxs("strong",{children:["#",j.success.ticket_id]})]}),e.jsx("p",{className:"text-green-600 text-xs mt-2",children:"Guarde este nÃºmero para hacer seguimiento a su reporte."})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl overflow-hidden",children:[e.jsxs("div",{className:"bg-[#2c4370] px-5 py-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-white",children:"Â¿Tiene un problema con su equipo o sistema?"}),e.jsx("p",{className:"text-white/80 text-sm",children:"CuÃ©ntenos quÃ© sucede y lo ayudaremos a solucionarlo"})]}),e.jsxs("form",{onSubmit:_,className:"p-5",children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("h3",{className:"text-sm font-semibold text-gray-700 mb-2 flex items-center gap-2",children:[e.jsx(Q,{className:"w-4 h-4"}),"Â¿QuiÃ©n reporta?"]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 bg-gray-50 p-3 rounded-lg",children:[e.jsxs("div",{children:[e.jsx(m,{htmlFor:"reporter_name",className:"text-xs",children:"Nombre Completo *"}),e.jsx(C,{id:"reporter_name",value:i.reporter_name,onChange:s=>a("reporter_name",s.target.value),placeholder:"Ej: Juan PÃ©rez GarcÃ­a",required:!0,className:"mt-1 h-9 text-sm"}),l.reporter_name&&e.jsx("p",{className:"text-red-600 text-xs mt-1",children:l.reporter_name})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"reporter_position",className:"text-xs",children:"Cargo *"}),e.jsx(C,{id:"reporter_position",value:i.reporter_position,onChange:s=>a("reporter_position",s.target.value),placeholder:"Ej: Enfermero, MÃ©dico, Auxiliar",required:!0,className:"mt-1 h-9 text-sm"}),l.reporter_position&&e.jsx("p",{className:"text-red-600 text-xs mt-1",children:l.reporter_position})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"reporter_service",className:"text-xs",children:"Servicio / Ãrea *"}),e.jsx(C,{id:"reporter_service",value:i.reporter_service,onChange:s=>a("reporter_service",s.target.value),placeholder:"Ej: Urgencias, UCI, Farmacia",required:!0,className:"mt-1 h-9 text-sm"}),l.reporter_service&&e.jsx("p",{className:"text-red-600 text-xs mt-1",children:l.reporter_service})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"reporter_extension",className:"text-xs",children:"ExtensiÃ³n"}),e.jsx(C,{id:"reporter_extension",value:i.reporter_extension,onChange:s=>a("reporter_extension",s.target.value),placeholder:"Ej: 1234",className:"mt-1 h-8 text-sm"})]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("h3",{className:"text-sm font-semibold text-gray-700 mb-2 flex items-center gap-2",children:[e.jsx(K,{className:"w-4 h-4"}),"Â¿QuÃ© problema tiene?"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx(m,{htmlFor:"name",className:"text-xs",children:"Â¿QuÃ© estÃ¡ pasando? (resumen corto) *"}),e.jsx(C,{id:"name",value:i.name,onChange:s=>a("name",s.target.value),placeholder:"Ej: No puedo imprimir, El computador no enciende, No tengo internet",required:!0,className:"mt-1 h-9 text-sm"}),l.name&&e.jsx("p",{className:"text-red-600 text-xs mt-1",children:l.name})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsxs("div",{children:[e.jsx(m,{htmlFor:"priority",className:"text-xs",children:"Â¿QuÃ© tan urgente es? *"}),e.jsxs(D,{value:i.priority,onValueChange:s=>a("priority",s),children:[e.jsx(B,{className:"mt-1 h-9 text-sm",children:e.jsx(V,{})}),e.jsxs(A,{children:[e.jsx(N,{value:"1",children:"Muy baja"}),e.jsx(N,{value:"2",children:"Baja"}),e.jsx(N,{value:"3",children:"Media"}),e.jsx(N,{value:"4",children:"Alta"}),e.jsx(N,{value:"5",children:"Muy alta"}),e.jsx(N,{value:"6",children:"Urgente"})]})]})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"locations_id",className:"text-xs",children:"Â¿DÃ³nde estÃ¡ el problema?"}),e.jsx(P,{options:M.map(s=>({value:s.id.toString(),label:s.completename})),value:i.locations_id,onValueChange:s=>a("locations_id",s),placeholder:"Seleccione...",searchPlaceholder:"Buscar ubicaciÃ³n...",className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"itilcategories_id",className:"text-xs",children:"Tipo de problema"}),e.jsx(P,{options:T.map(s=>({value:s.id.toString(),label:s.completename})),value:i.itilcategories_id,onValueChange:s=>a("itilcategories_id",s),placeholder:"Seleccione...",searchPlaceholder:"Buscar categorÃ­a...",className:"mt-1"})]})]}),d&&d.length>0&&e.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg",children:[e.jsxs(m,{className:"text-xs flex items-center gap-1 mb-2",children:[e.jsx(G,{className:"w-3 h-3"}),"Â¿QuÃ© equipo tiene el problema? (opcional)"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs(D,{value:x,onValueChange:F,children:[e.jsx(B,{className:"h-8 text-xs",children:e.jsx(V,{placeholder:"Tipo de equipo"})}),e.jsx(A,{children:d.map(s=>e.jsx(N,{value:s.value,children:s.label},s.value))})]}),e.jsx(P,{options:w.map(s=>({value:s.id.toString(),label:s.name})),value:"",onValueChange:v,placeholder:k?"Cargando...":"Seleccionar equipo",searchPlaceholder:"Buscar...",disabled:!x||k})]}),g.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1 mt-2",children:g.map((s,n)=>e.jsxs("span",{className:"inline-flex items-center gap-1 bg-blue-100 text-blue-800 px-2 py-0.5 rounded text-xs",children:[s.name,e.jsx("button",{type:"button",onClick:()=>c(s.type,s.id),children:e.jsx(L,{className:"w-3 h-3"})})]},n))})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"content",className:"text-xs",children:"CuÃ©ntenos mÃ¡s detalles *"}),e.jsx(O,{id:"content",value:i.content,onChange:s=>a("content",s.target.value),placeholder:"CuÃ©ntenos con detalle quÃ© estÃ¡ pasando:\\n- Â¿QuÃ© estaba haciendo cuando ocurriÃ³?\\n- Â¿Aparece algÃºn mensaje de error?\\n- Â¿Desde cuÃ¡ndo tiene este problema?",required:!0,rows:3,className:"mt-1 text-sm"}),l.content&&e.jsx("p",{className:"text-red-600 text-xs mt-1",children:l.content})]})]})]}),e.jsx("div",{className:"flex justify-end pt-3 border-t",children:e.jsx(U,{type:"submit",disabled:f,className:"bg-[#2c4370] hover:bg-[#3d5583] text-white px-8",children:f?"Enviando...":"Enviar Reporte"})})]})]}),e.jsx("div",{className:"mt-4 text-center text-white/60 text-xs",children:e.jsx("p",{children:"Hospital Universitario del Valle - GestiÃ³n de la InformaciÃ³n"})})]}),e.jsx(te,{formData:i,onFillField:a})]})]})}export{ve as default};
