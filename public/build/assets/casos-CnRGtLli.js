import{R as i,j as e,H as Ie,L as G,r as x}from"./app-DYZsh_tz.js";import{G as qe,S as Be,c as Ue,a as Ge}from"./glpi-footer-BD_2EWZL.js";import{F as pe,e as Ke,a as Qe,b as K,T as d,d as Xe,c}from"./table-B5NydAd5.js";import{B as o}from"./button-CnUx2nln.js";import{I as H}from"./input-CLKOyNox.js";import{e as Q,d as X,b as Y,D as J,a as ue,c as je}from"./dialog-CJlYr-Bp.js";import{S as F,a as E,b as L,c as O,d as l}from"./select-C3YRx6vK.js";import{X as ve}from"./x-NH_7_baI.js";import{P as Ye}from"./plus-Bxc7-tv3.js";import{S as M}from"./square-check-big-6ekCRLnK.js";import{S as Je}from"./square-pen-D4eStQxt.js";import{C as We,A as Ze,a as es}from"./chevron-left-Dpob_V7g.js";import{a as ss,C as as}from"./chevrons-up-down-C5dOWHij.js";import{L as be}from"./loader-circle-CSk6SG3D.js";/* empty css            */import"./index-D0rCD2O7.js";import"./index-BDaPFnap.js";import"./index-D2XHaN9X.js";import"./file-text-DQlBOP0A.js";import"./monitor-Bmtbp4fk.js";import"./index-qmo7i0rp.js";import"./check-ZrnZYFU7.js";import"./sun-X6U4luDZ.js";function _s({tickets:m,categories:ye,technicians:Ne,filters:a,auth:j}){const[C,W]=i.useState(a.search||""),[fe,k]=i.useState(!1),[z,Z]=i.useState(null),[we,_]=i.useState(!1),[r,Se]=i.useState(null),[D,ee]=i.useState(null),[Ce,se]=i.useState(!1),[ae,_e]=i.useState(!1),[De,A]=i.useState(!1),[v,I]=i.useState(null),[N,P]=i.useState(""),[f,R]=i.useState(""),[q,$]=i.useState(!1),[te,T]=i.useState(null),[h,re]=i.useState(a.status||"all"),[g,le]=i.useState(a.priority||"all"),[p,ne]=i.useState(a.category||"all"),[u,ie]=i.useState(a.assigned||"all"),[w,oe]=i.useState(a.date_from||""),[S,ce]=i.useState(a.date_to||""),B=h&&h!=="all"||g&&g!=="all"||p&&p!=="all"||u&&u!=="all"||w||S||a.filter,de=()=>{switch(a.filter){case"unassigned":return"Sin asignar";case"my_cases":return"Mis casos";case"my_pending":return"Sin resolver";case"my_resolved":return"Resueltos";default:return null}},Te=()=>{x.get("/soporte/casos",{per_page:a.per_page,sort:a.sort,direction:a.direction},{preserveState:!1})},Fe=s=>j.user.role==="Administrador"?!0:j.user.role==="Técnico"?s.assigned_user_id===j.user.id||s.requester_user_id===j.user.id:!1,V=()=>j.user.role==="Administrador"||j.user.role==="Técnico",xe=s=>j.user.role==="Administrador"?!0:s.assigned_user_id===j.user.id&&s.status!==5&&s.status!==6,me=s=>{I(s),P(""),T(null);const t=new Date,n=t.getFullYear(),Re=String(t.getMonth()+1).padStart(2,"0"),$e=String(t.getDate()).padStart(2,"0"),Ve=String(t.getHours()).padStart(2,"0"),He=String(t.getMinutes()).padStart(2,"0"),Me=`${n}-${Re}-${$e}T${Ve}:${He}`;R(Me),A(!0)},Ee=()=>{if(console.log("confirmSolve called",{ticketToSolve:v,solution:N,solveDate:f}),!v||!N.trim()){alert("Debe ingresar una solución");return}if(f&&v.date){const t=new Date(f),n=new Date(v.date);if(t<n){T("La fecha de solución no puede ser anterior a la fecha de creación del caso.");return}}$(!0),T(null);const s=f?f.replace("T"," ")+":00":null;console.log("Sending POST to:",`/dashboard/solve-ticket/${v.id}`,{solution:N.trim(),solve_date:s}),x.post(`/dashboard/solve-ticket/${v.id}`,{solution:N.trim(),solve_date:s},{preserveState:!0,onSuccess:t=>{if(console.log("onSuccess called",t.props?.flash),$(!1),t.props?.flash?.error){T(t.props.flash.error);return}A(!1),I(null),P(""),R("")},onError:t=>{console.log("onError called",t),$(!1);const n=typeof t=="object"?Object.values(t).join(", "):"Error al resolver";T(n)},onFinish:()=>{console.log("onFinish called"),$(!1)}})},Le=s=>{Z(s),k(!0)},Oe=()=>{z&&x.delete(`/soporte/casos/${z.id}`,{preserveScroll:!0,onSuccess:()=>{k(!1),Z(null)}})},b=s=>{const t=a.sort===s&&a.direction==="asc"?"desc":"asc",n={per_page:a.per_page,sort:s,direction:t};a.search&&(n.search=a.search),a.status&&(n.status=a.status),a.priority&&(n.priority=a.priority),a.category&&(n.category=a.category),a.assigned&&(n.assigned=a.assigned),a.date_from&&(n.date_from=a.date_from),a.date_to&&(n.date_to=a.date_to),a.filter&&(n.filter=a.filter),x.get("/soporte/casos",n,{preserveState:!1,preserveScroll:!0})},U=s=>{s&&x.visit(s,{preserveScroll:!0})},he=()=>{const s={per_page:a.per_page,sort:a.sort,direction:a.direction,page:1};C&&(s.search=C),h&&h!=="all"&&(s.status=h),g&&g!=="all"&&(s.priority=g),p&&p!=="all"&&(s.category=p),u&&u!=="all"&&(s.assigned=u),w&&(s.date_from=w),S&&(s.date_to=S),x.get("/soporte/casos",s,{preserveState:!1,preserveScroll:!1,replace:!0})},ke=s=>{const t={per_page:s,sort:a.sort,direction:a.direction,page:1};a.search&&(t.search=a.search),a.status&&(t.status=a.status),a.priority&&(t.priority=a.priority),a.category&&(t.category=a.category),a.assigned&&(t.assigned=a.assigned),a.date_from&&(t.date_from=a.date_from),a.date_to&&(t.date_to=a.date_to),a.filter&&(t.filter=a.filter),x.get("/soporte/casos",t,{preserveState:!1,preserveScroll:!0})},ze=()=>{const s={per_page:a.per_page,sort:a.sort,direction:a.direction,page:1};C&&(s.search=C),h&&h!=="all"&&(s.status=h),g&&g!=="all"&&(s.priority=g),p&&p!=="all"&&(s.category=p),u&&u!=="all"&&(s.assigned=u),w&&(s.date_from=w),S&&(s.date_to=S),console.log("Applying filters:",s),x.get("/soporte/casos",s,{preserveState:!1,preserveScroll:!1,replace:!0})},Ae=()=>{re("all"),le("all"),ne("all"),ie("all"),oe(""),ce(""),W(""),x.get("/soporte/casos",{per_page:a.per_page,sort:a.sort,direction:a.direction,page:1},{preserveState:!1,preserveScroll:!1,replace:!0})},Pe=()=>{const s=new URLSearchParams;s.append("sort",a.sort),s.append("direction",a.direction),a.search&&s.append("search",a.search),a.status&&a.status!=="all"&&s.append("status",a.status),a.priority&&a.priority!=="all"&&s.append("priority",a.priority),a.category&&a.category!=="all"&&s.append("category",a.category),a.assigned&&a.assigned!=="all"&&s.append("assigned",a.assigned),a.date_from&&s.append("date_from",a.date_from),a.date_to&&s.append("date_to",a.date_to),a.filter&&s.append("filter",a.filter),window.location.href=`/soporte/casos/export?${s}`},y=s=>a.sort!==s?e.jsx(as,{className:"h-3 w-3 ml-1 text-gray-400"}):a.direction==="asc"?e.jsx(Ze,{className:"h-3 w-3 ml-1 text-[#2c4370]"}):e.jsx(es,{className:"h-3 w-3 ml-1 text-[#2c4370]"}),ge=s=>{switch(s){case 1:return"bg-blue-100 text-blue-800";case 2:return"bg-yellow-100 text-yellow-800";case 3:return"bg-yellow-100 text-yellow-800";case 4:return"bg-orange-100 text-orange-800";case 5:return"bg-green-100 text-green-800";case 6:return"bg-gray-100 text-gray-800";default:return"bg-gray-100 text-gray-800"}};return e.jsxs(e.Fragment,{children:[e.jsx(Ie,{title:"HelpDesk HUV - Casos"}),e.jsxs("div",{className:"min-h-screen flex flex-col bg-gray-50",children:[e.jsx(qe,{breadcrumb:e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(G,{href:"/dashboard",className:"text-gray-600 hover:text-[#2c4370] hover:underline",children:"Inicio"}),e.jsx("span",{className:"text-gray-400",children:"/"}),e.jsx(G,{href:"/soporte/casos",className:"text-gray-600 hover:text-[#2c4370] hover:underline",children:"Soporte"}),e.jsx("span",{className:"text-gray-400",children:"/"}),e.jsx("span",{className:"font-medium text-gray-900",children:"Casos"})]})}),e.jsxs("main",{className:"flex-1 px-3 sm:px-6 py-4 sm:py-6",children:[a.filter&&e.jsxs("div",{className:"mb-4 bg-[#2c4370] text-white px-3 sm:px-4 py-2 sm:py-3 flex flex-col sm:flex-row items-start sm:items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm sm:text-base",children:[e.jsx(pe,{className:"w-4 h-4 shrink-0"}),e.jsx("span",{className:"font-medium",children:de()}),e.jsxs("span",{className:"text-white/70",children:["(",m.total,")"]})]}),e.jsxs("button",{onClick:Te,className:"flex items-center gap-1 hover:bg-white/20 px-2 py-1 transition-colors text-sm",children:[e.jsx(ve,{className:"w-4 h-4"}),e.jsx("span",{children:"Quitar"})]})]}),e.jsxs("div",{className:"bg-white shadow border border-gray-200",children:[e.jsx("div",{className:"px-3 sm:px-6 py-3 sm:py-4 border-b",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[e.jsx("h1",{className:"text-lg sm:text-xl font-semibold text-gray-900",children:a.filter?de():"Casos"}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center gap-2 sm:gap-3",children:[e.jsxs("div",{className:"relative flex-1 sm:flex-initial",children:[e.jsx(H,{type:"text",placeholder:"Buscar...",className:"w-full sm:w-64 pr-10 h-9",value:C,onChange:s=>W(s.target.value),onKeyDown:s=>{s.key==="Enter"&&he()}}),e.jsx(o,{size:"sm",variant:"ghost",className:"absolute right-0 top-0 h-full px-3",onClick:he,children:e.jsx(Be,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(o,{variant:"outline",size:"sm",onClick:()=>_e(!ae),className:`h-9 flex-1 sm:flex-initial ${B?"border-[#2c4370] text-[#2c4370]":""}`,children:[e.jsx(pe,{className:"h-4 w-4 sm:mr-1"}),e.jsx("span",{className:"hidden sm:inline",children:"Filtros"}),B&&e.jsx("span",{className:"ml-1 bg-[#2c4370] text-white text-xs w-5 h-5 flex items-center justify-center",children:"!"})]}),e.jsxs(o,{size:"sm",className:"bg-[#2c4370] hover:bg-[#3d5583] text-white h-9 flex-1 sm:flex-initial",onClick:Pe,children:[e.jsx("span",{className:"hidden sm:inline",children:"Exportar"}),e.jsx("span",{className:"sm:hidden",children:"Excel"})]}),e.jsx(G,{href:"/soporte/crear-caso",children:e.jsxs(o,{size:"sm",className:"bg-green-600 hover:bg-green-700 text-white h-9 flex-1 sm:flex-initial",children:[e.jsx(Ye,{className:"h-4 w-4 sm:mr-1"}),e.jsx("span",{className:"hidden sm:inline",children:"Crear Caso"})]})})]})]})]})}),ae&&e.jsxs("div",{className:"px-3 sm:px-6 py-3 sm:py-4 bg-gray-50 border-b",children:[e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-6 gap-2 sm:gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600 mb-1 block",children:"Estado"}),e.jsxs(F,{value:h,onValueChange:re,children:[e.jsx(E,{className:"h-8 text-xs",children:e.jsx(L,{placeholder:"Todos"})}),e.jsxs(O,{children:[e.jsx(l,{value:"all",children:"Todos"}),e.jsx(l,{value:"1",children:"Nuevo"}),e.jsx(l,{value:"2",children:"En curso (asignado)"}),e.jsx(l,{value:"3",children:"En curso (planificado)"}),e.jsx(l,{value:"4",children:"En espera"}),e.jsx(l,{value:"5",children:"Resuelto"}),e.jsx(l,{value:"6",children:"Cerrado"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600 mb-1 block",children:"Prioridad"}),e.jsxs(F,{value:g,onValueChange:le,children:[e.jsx(E,{className:"h-8 text-xs",children:e.jsx(L,{placeholder:"Todas"})}),e.jsxs(O,{children:[e.jsx(l,{value:"all",children:"Todas"}),e.jsx(l,{value:"1",children:"Muy baja"}),e.jsx(l,{value:"2",children:"Baja"}),e.jsx(l,{value:"3",children:"Media"}),e.jsx(l,{value:"4",children:"Alta"}),e.jsx(l,{value:"5",children:"Muy alta"}),e.jsx(l,{value:"6",children:"Urgente"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600 mb-1 block",children:"Asignado a"}),e.jsxs(F,{value:u,onValueChange:ie,children:[e.jsx(E,{className:"h-8 text-xs",children:e.jsx(L,{placeholder:"Todos"})}),e.jsxs(O,{children:[e.jsx(l,{value:"all",children:"Todos"}),Ne.map(s=>e.jsx(l,{value:s.id.toString(),children:s.fullname},s.id))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600 mb-1 block",children:"Categoría"}),e.jsxs(F,{value:p,onValueChange:ne,children:[e.jsx(E,{className:"h-8 text-xs",children:e.jsx(L,{placeholder:"Todas"})}),e.jsxs(O,{children:[e.jsx(l,{value:"all",children:"Todas"}),ye.map(s=>e.jsx(l,{value:s.id.toString(),children:s.completename},s.id))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600 mb-1 block",children:"Desde"}),e.jsx(H,{type:"date",value:w,onChange:s=>oe(s.target.value),className:"h-8 text-xs"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600 mb-1 block",children:"Hasta"}),e.jsx(H,{type:"date",value:S,onChange:s=>ce(s.target.value),className:"h-8 text-xs"})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-end gap-2 mt-3",children:[B&&e.jsxs(o,{variant:"ghost",size:"sm",onClick:Ae,className:"h-8 text-xs text-gray-600",children:[e.jsx(ve,{className:"h-3 w-3 mr-1"}),"Limpiar"]}),e.jsx(o,{size:"sm",onClick:ze,className:"bg-[#2c4370] hover:bg-[#3d5583] text-white h-8 text-xs",children:"Aplicar"})]})]}),e.jsxs("div",{className:"px-3 sm:px-6 py-2 sm:py-3 bg-gray-50 border-b flex flex-col sm:flex-row items-start sm:items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[e.jsx("span",{className:"text-xs sm:text-sm text-gray-600",children:"Mostrar"}),e.jsxs(F,{value:a.per_page.toString(),onValueChange:ke,children:[e.jsx(E,{className:"w-16 sm:w-20 h-7 sm:h-8 text-xs sm:text-sm",children:e.jsx(L,{placeholder:"15"})}),e.jsxs(O,{children:[e.jsx(l,{value:"15",children:"15"}),e.jsx(l,{value:"20",children:"20"}),e.jsx(l,{value:"50",children:"50"}),e.jsx(l,{value:"100",children:"100"})]})]}),e.jsx("span",{className:"text-xs sm:text-sm text-gray-600 hidden sm:inline",children:"elementos"})]}),e.jsxs("p",{className:"text-xs sm:text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:m.data.length})," de"," ",e.jsx("span",{className:"font-medium",children:m.total})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Ke,{children:[e.jsx(Qe,{children:e.jsxs(K,{className:"bg-gray-50",children:[e.jsx(d,{className:"font-semibold text-gray-900 text-xs cursor-pointer hover:bg-gray-100 w-16",onClick:()=>b("id"),children:e.jsxs("div",{className:"flex items-center",children:["ID",y("id")]})}),e.jsx(d,{className:"font-semibold text-gray-900 text-xs cursor-pointer hover:bg-gray-100",onClick:()=>b("name"),children:e.jsxs("div",{className:"flex items-center",children:["Título",y("name")]})}),e.jsx(d,{className:"font-semibold text-gray-900 text-xs cursor-pointer hover:bg-gray-100",onClick:()=>b("status"),children:e.jsxs("div",{className:"flex items-center",children:["Estado",y("status")]})}),e.jsx(d,{className:"font-semibold text-gray-900 text-xs cursor-pointer hover:bg-gray-100",onClick:()=>b("priority"),children:e.jsxs("div",{className:"flex items-center",children:["Prioridad",y("priority")]})}),e.jsx(d,{className:"font-semibold text-gray-900 text-xs cursor-pointer hover:bg-gray-100",onClick:()=>b("entity_name"),children:e.jsxs("div",{className:"flex items-center",children:["Entidad",y("entity_name")]})}),e.jsx(d,{className:"font-semibold text-gray-900 text-xs cursor-pointer hover:bg-gray-100",onClick:()=>b("date"),children:e.jsxs("div",{className:"flex items-center",children:["Fecha de apertura",y("date")]})}),e.jsx(d,{className:"font-semibold text-gray-900 text-xs cursor-pointer hover:bg-gray-100",onClick:()=>b("date_mod"),children:e.jsxs("div",{className:"flex items-center",children:["Última actualización",y("date_mod")]})}),e.jsx(d,{className:"font-semibold text-gray-900 text-xs",children:"Solicitante"}),e.jsx(d,{className:"font-semibold text-gray-900 text-xs",children:"Asignado a"}),e.jsx(d,{className:"font-semibold text-gray-900 text-xs",children:"Categoría"}),e.jsx(d,{className:"font-semibold text-gray-900 text-xs",children:"Elemento"}),V()&&e.jsx(d,{className:"font-semibold text-gray-900 text-xs text-center w-24",children:"Acciones"})]})}),e.jsxs(Xe,{children:[m.data.map(s=>e.jsxs(K,{className:"hover:bg-gray-50",children:[e.jsx(c,{className:"text-xs font-medium",children:s.id}),e.jsx(c,{className:"font-medium text-xs",children:e.jsx("button",{onClick:async()=>{if(Se(s),ee(null),_(!0),s.status===5||s.status===6){se(!0);try{const t=await fetch(`/dashboard/ticket/${s.id}`);if(t.ok){const n=await t.json();n.solution&&ee(n.solution)}}catch(t){console.error("Error fetching solution:",t)}finally{se(!1)}}},className:"text-[#2c4370] hover:underline block truncate max-w-md text-left",title:s.name,children:s.name||"(Sin título)"})}),e.jsx(c,{className:"text-xs",children:e.jsx("span",{className:`px-2 py-1 text-[10px] font-semibold ${ge(s.status)}`,children:s.status_name})}),e.jsx(c,{className:"text-xs",children:s.priority_name}),e.jsx(c,{className:"text-xs",children:s.entity_name||"-"}),e.jsx(c,{className:"text-xs text-gray-600",children:s.date?new Date(s.date).toLocaleDateString("es-CO",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"-"}),e.jsx(c,{className:"text-xs text-gray-600",children:s.date_mod?new Date(s.date_mod).toLocaleDateString("es-CO",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"-"}),e.jsx(c,{className:"text-xs",children:s.requester_name||"-"}),e.jsx(c,{className:"text-xs",children:s.assigned_name||"-"}),e.jsx(c,{className:"text-xs",children:s.category_name||"-"}),e.jsx(c,{className:"text-xs text-gray-600",children:s.item_name||"-"}),V()&&e.jsx(c,{className:"text-xs",children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[xe(s)&&s.status!==5&&s.status!==6&&e.jsx(o,{variant:"ghost",size:"sm",className:"h-7 w-7 p-0 text-green-600 hover:text-green-800 hover:bg-green-50",onClick:()=>me(s),title:"Resolver",children:e.jsx(M,{className:"h-3.5 w-3.5"})}),e.jsx(o,{variant:"ghost",size:"sm",className:"h-7 w-7 p-0 text-blue-600 hover:text-blue-800 hover:bg-blue-50",onClick:()=>x.visit(`/soporte/casos/${s.id}/editar`),title:"Editar",children:e.jsx(Je,{className:"h-3.5 w-3.5"})}),Fe(s)&&e.jsx(o,{variant:"ghost",size:"sm",className:"h-7 w-7 p-0 text-red-600 hover:text-red-800 hover:bg-red-50",onClick:()=>Le(s),title:"Eliminar",children:e.jsx(Ue,{className:"h-3.5 w-3.5"})})]})})]},s.id)),m.data.length===0&&e.jsx(K,{children:e.jsx(c,{colSpan:V()?12:11,className:"text-center py-8 text-gray-500",children:"No se encontraron casos"})})]})]})}),e.jsxs("div",{className:"px-3 sm:px-6 py-3 sm:py-4 border-t flex flex-col sm:flex-row items-center justify-between gap-3",children:[e.jsxs("div",{className:"text-xs sm:text-sm text-gray-600 order-2 sm:order-1",children:["Página ",m.current_page," de ",m.last_page]}),e.jsx("div",{className:"flex items-center gap-1 sm:gap-2 order-1 sm:order-2 flex-wrap justify-center",children:m.links.map((s,t)=>{const n=t===0||t===m.links.length-1||s.active;return t===0?e.jsx(o,{variant:"outline",size:"sm",disabled:!s.url,className:"border-[#2c4370] text-[#2c4370] hover:!bg-[#2c4370] hover:!text-white disabled:opacity-50 h-8 w-8 p-0",onClick:()=>s.url&&U(s.url),children:e.jsx(We,{className:"h-4 w-4"})},t):t===m.links.length-1?e.jsx(o,{variant:"outline",size:"sm",disabled:!s.url,className:"border-[#2c4370] text-[#2c4370] hover:!bg-[#2c4370] hover:!text-white disabled:opacity-50 h-8 w-8 p-0",onClick:()=>s.url&&U(s.url),children:e.jsx(ss,{className:"h-4 w-4"})},t):e.jsx(o,{variant:s.active?"default":"outline",size:"sm",disabled:!s.url,className:`${n?"":"hidden sm:inline-flex"} h-8 min-w-[32px] px-2 text-xs sm:text-sm ${s.active?"bg-[#2c4370] hover:!bg-[#3d5583] text-white border-[#2c4370]":"border-[#2c4370] text-[#2c4370] hover:!bg-[#2c4370] hover:!text-white"}`,onClick:()=>s.url&&U(s.url),children:e.jsx("span",{dangerouslySetInnerHTML:{__html:s.label}})},t)})})]})]})]}),e.jsx(Ge,{})]}),e.jsx(Q,{open:fe,onOpenChange:k,children:e.jsxs(X,{className:"sm:max-w-[425px]",children:[e.jsxs(Y,{children:[e.jsx(J,{children:"Eliminar Caso"}),e.jsxs(ue,{children:["¿Está seguro que desea eliminar el caso ",e.jsxs("strong",{children:["#",z?.id]}),"?",e.jsx("br",{}),e.jsx("span",{className:"text-gray-600",children:z?.name})]})]}),e.jsxs(je,{className:"gap-2",children:[e.jsx(o,{variant:"outline",onClick:()=>k(!1),children:"Cancelar"}),e.jsx(o,{variant:"destructive",onClick:Oe,className:"bg-red-600 hover:bg-red-700",children:"Eliminar"})]})]})}),e.jsx(Q,{open:we,onOpenChange:_,children:e.jsxs(X,{className:"sm:max-w-[600px] max-h-[90vh] overflow-y-auto",children:[e.jsx(Y,{children:e.jsxs(J,{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-[#2c4370]",children:["Caso #",r?.id]}),e.jsx("span",{className:`px-2 py-0.5 text-[10px] font-semibold ${r?ge(r.status):""}`,children:r?.status_name})]})}),r&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{children:e.jsx("h3",{className:"text-sm font-semibold text-gray-900",children:r.name})}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-xs",children:[e.jsxs("div",{className:"bg-gray-50 p-2",children:[e.jsx("span",{className:"text-gray-500 block",children:"Prioridad"}),e.jsx("span",{className:"font-medium",children:r.priority_name})]}),e.jsxs("div",{className:"bg-gray-50 p-2",children:[e.jsx("span",{className:"text-gray-500 block",children:"Entidad"}),e.jsx("span",{className:"font-medium",children:r.entity_name||"-"})]}),e.jsxs("div",{className:"bg-gray-50 p-2",children:[e.jsx("span",{className:"text-gray-500 block",children:"Fecha de Apertura"}),e.jsx("span",{className:"font-medium",children:r.date?new Date(r.date).toLocaleDateString("es-CO",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"-"})]}),e.jsxs("div",{className:"bg-gray-50 p-2",children:[e.jsx("span",{className:"text-gray-500 block",children:"Última Actualización"}),e.jsx("span",{className:"font-medium",children:r.date_mod?new Date(r.date_mod).toLocaleDateString("es-CO",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"-"})]}),e.jsxs("div",{className:"bg-gray-50 p-2",children:[e.jsx("span",{className:"text-gray-500 block",children:"Solicitante"}),e.jsx("span",{className:"font-medium",children:r.requester_name||"-"})]}),e.jsxs("div",{className:"bg-gray-50 p-2",children:[e.jsx("span",{className:"text-gray-500 block",children:"Asignado a"}),e.jsx("span",{className:"font-medium",children:r.assigned_name||"-"})]}),e.jsxs("div",{className:"bg-gray-50 p-2 col-span-2",children:[e.jsx("span",{className:"text-gray-500 block",children:"Categoría"}),e.jsx("span",{className:"font-medium",children:r.category_name||"-"})]})]}),(r.status===5||r.status===6)&&e.jsxs("div",{className:"pt-3 border-t",children:[e.jsx("span",{className:"text-xs font-semibold text-green-700 block mb-2",children:"Solución"}),Ce?e.jsxs("div",{className:"bg-green-50 p-3 border border-green-200 flex items-center justify-center",children:[e.jsx(be,{className:"h-4 w-4 animate-spin text-green-600"}),e.jsx("span",{className:"ml-2 text-xs text-green-600",children:"Cargando solución..."})]}):D?e.jsxs("div",{className:"bg-green-50 p-3 border border-green-200",children:[e.jsx("div",{className:"text-xs text-gray-700 whitespace-pre-wrap",dangerouslySetInnerHTML:{__html:D.content}}),e.jsxs("div",{className:"mt-2 pt-2 border-t border-green-200 flex items-center justify-between text-[10px] text-green-700",children:[e.jsxs("span",{children:["Resuelto por: ",e.jsx("strong",{children:D.solved_by||"Usuario del sistema"})]}),e.jsx("span",{children:D.date_creation?new Date(D.date_creation).toLocaleString("es-CO"):"-"})]})]}):e.jsx("div",{className:"bg-gray-50 p-3 border border-gray-200 text-xs text-gray-500",children:"No se encontró solución registrada"})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2 border-t",children:[e.jsx(o,{variant:"outline",size:"sm",onClick:()=>_(!1),className:"h-8 text-xs",children:"Cerrar"}),xe(r)&&r.status!==5&&r.status!==6&&e.jsxs(o,{size:"sm",onClick:()=>{_(!1),me(r)},className:"bg-green-600 hover:bg-green-700 text-white h-8 text-xs",children:[e.jsx(M,{className:"h-3.5 w-3.5 mr-1"}),"Resolver"]}),V()&&e.jsx(o,{size:"sm",onClick:()=>{_(!1),x.visit(`/soporte/casos/${r.id}/editar`)},className:"bg-[#2c4370] hover:bg-[#3d5583] text-white h-8 text-xs",children:"Editar Caso"})]})]})]})}),e.jsx(Q,{open:De,onOpenChange:A,children:e.jsxs(X,{className:"sm:max-w-[500px]",children:[e.jsxs(Y,{children:[e.jsxs(J,{className:"flex items-center gap-2",children:[e.jsx(M,{className:"h-5 w-5 text-green-600"}),"Resolver Caso"]}),e.jsxs(ue,{children:["Resolver el caso ",e.jsxs("strong",{children:["#",v?.id]}),": ",v?.name]})]}),te&&e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 text-sm rounded",children:te}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Descripción de la solución ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{value:N,onChange:s=>P(s.target.value),placeholder:"Describe cómo se resolvió el problema...",className:"w-full px-3 py-2 border focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500 min-h-[120px] text-sm",autoFocus:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Fecha y hora de solución"}),e.jsx(H,{type:"datetime-local",value:f,onChange:s=>R(s.target.value),className:"w-full"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Por defecto se usa la fecha y hora actual. Puede modificarla si la solución fue en otro momento."})]})]}),e.jsxs(je,{className:"gap-2",children:[e.jsx(o,{variant:"outline",onClick:()=>{A(!1),I(null),P(""),R("")},disabled:q,children:"Cancelar"}),e.jsx(o,{type:"button",onClick:()=>{console.log("Resolve button clicked"),Ee()},disabled:!N.trim()||q,className:"bg-green-600 hover:bg-green-700 text-white",children:q?e.jsxs(e.Fragment,{children:[e.jsx(be,{className:"h-4 w-4 mr-1 animate-spin"}),"Resolviendo..."]}):e.jsxs(e.Fragment,{children:[e.jsx(M,{className:"h-4 w-4 mr-1"}),"Resolver"]})})]})]})})]})}export{_s as default};
